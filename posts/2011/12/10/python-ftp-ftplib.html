<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="google-site-verification" content="SzE6WCs23qFevgBzRIuG9vcfLU0lW_Vd5hFT-cJOLBE" />
    <title>Python实现ftp常用操作[ftplib]</title>
    <meta charset="utf-8" />
    <meta name="description" content="">
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

        <link rel="shortcut icon" href="/favicon.ico"/>
        <link rel="stylesheet" href="http://wklken.me/theme/css/style.css" media="all" />
        <link rel="stylesheet" href="http://wklken.me/theme/css/pygment.css" media="all" />
        <link rel="stylesheet" href="http://wklken.me/theme/css/mobile.css" media="all" />
        <link href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,300italic,600italic,400,600,700,800' rel='stylesheet' type='text/css">

        <link rel="stylesheet" href="http://wklken.me/theme/css/font-awesome.min.css">
        <!--[if IE 7]>
            <link rel="stylesheet" href="http://wklken.me/theme/css/font-awesome-ie7.min.css">
        <![endif]-->

        <link href="http://wklken.me/" type="application/atom+xml" rel="alternate" title="wklken's blog ATOM Feed" />
        <link href="http://wklken.me/feed.xml" type="application/atom+xml" rel="alternate" title="wklken's blog RSS Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="http://wklken.me/css/ie.css"/>
                <script src="http://wklken.me/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="http://wklken.me/css/ie6.css"/><![endif]-->
        <script src="http://upcdn.b0.upaiyun.com/libs/jquery/jquery-1.9.1.min.js"></script>
        <script src="http://wklken.me/theme/js/jquery.scrollToTop.js"></script>
        <script type="text/javascript">
            $(function() {
                $("#toTop").scrollToTop(1000);
            });
        </script>

</head>

<body id="index" class="home">
  <header id="header">
     <div class="constraint">

       <div class="o"> 
   <a href="/"><h1>Wklken <span class="red"> Python</span></h1></a>

    <div class="social">
                <a href="https://github.com/wklken" target='_blank'><i class="icon-github-sign icon-2x"></i></a>
                <a href="http://weibo.com/wklken" target='_blank'><i class="icon-weibo icon-2x"></i></a>
                <a href="mailto:wklken@yeah.net"><i class="icon-envelope icon-2x"></i></a>
                <a href="/feed.xml" target='_blank'><i class="icon-rss-sign icon-2x"></i></a>
    </div>

		<div class="nav">
                    <a href="/">首页</a>
                    <a href="/categories.html">分类</a>
                    <a href="/archives.html">归档</a>
                    <a href="/pages/projects.html">项目</a>
                    <a href="/pages/tools.html">工具</a>
                    <a href="/pages/books.html">书单</a>
                    <a href="/pages/aboutme.html">关于</a>

           </div>
         </div>
         </div>
         </header><!-- /#banner -->

<section class="content blog">
<div class="constraint">
<div class="posts">
<article>
<aside class="sidebar">
<h3 class="published" title="2011-12-10T00:00:00">
               2011年12月10日
</h3>

<p>
<div class="tag">
    分类: <a href="/category/python-practice.html">python-practice</a>

    </div>


<div class="tag">
    标签: <a href="http://wklken.me/tag/python.html">python</a><a href="http://wklken.me/tag/ftplib.html">ftplib</a>
   </div>


</p>

</aside><!-- /.post-info -->        <header> <h1 class="blog-title"><a href=""
        rel="bookmark" title="Permalink to Python实现ftp常用操作[ftplib]">Python实现ftp常用操作[ftplib]</a></h1> 
        </header>


        <div class="entry-content">
        <p>使用到的模块  <a href="http://docs.python.org/2/library/ftplib.html">ftplib</a></p>
<p>代码托管位置 <a href="https://github.com/wklken/pytools">github-pytools</a></p>
<h3>需求</h3>
<p>快速进行ftp上传 ，下载，查询文件</p>
<p>原来直接在shell下操作：需要【连接，输用户名，输密码，单文件操作，存在超时限制】</p>
<p>太过于繁琐，容易操作失败</p>
<h3>改进</h3>
<p>一句命令，搞定多文件上传，下载，查询，列表等操作</p>
<p>后期可以加入更强大的功能</p>
<h3>源代码</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/usr/bin/python</span>
<span class="c"># -*- coding:utf-8 -*-</span>
<span class="c">#ftp.py</span>
<span class="c">#    wklken@yeah.net</span>
<span class="c">#this script is used to do some operations more convenient via ftp</span>
  <span class="c">#1.[p]upload many files in the same time,show md5s</span>
  <span class="c">#2.[g]download many files in the same time,show md5s</span>
  <span class="c">#3.[l]list all the files on ftp site</span>
  <span class="c">#4.[f]search a file on ftp site,return True or Flase</span>
  <span class="c">#5.[h]show help info</span>

<span class="c">#add upload and download operations  20111210 version0.1</span>
<span class="c">#add md5sum after ops 20120308 version0.2</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">os</span><span class="o">,</span><span class="nn">ftplib</span><span class="o">,</span><span class="nn">socket</span>

<span class="n">CONST_HOST</span> <span class="o">=</span> <span class="s">&quot;ip&quot;</span>
<span class="n">CONST_USERNAME</span> <span class="o">=</span> <span class="s">&quot;username&quot;</span>
<span class="n">CONST_PWD</span> <span class="o">=</span> <span class="s">&quot;pwd&quot;</span>
<span class="n">CONST_BUFFER_SIZE</span> <span class="o">=</span> <span class="mi">8192</span>

<span class="n">COLOR_NONE</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\033</span><span class="s">[m&quot;</span>
<span class="n">COLOR_GREEN</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\033</span><span class="s">[01;32m&quot;</span>
<span class="n">COLOR_RED</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\033</span><span class="s">[01;31m&quot;</span>
<span class="n">COLOR_YELLOW</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\033</span><span class="s">[01;33m&quot;</span>

<span class="k">def</span> <span class="nf">connect</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ftp</span> <span class="o">=</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">FTP</span><span class="p">(</span><span class="n">CONST_HOST</span><span class="p">)</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">CONST_USERNAME</span><span class="p">,</span><span class="n">CONST_PWD</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ftp</span>
    <span class="k">except</span> <span class="n">socket</span><span class="o">.</span><span class="n">error</span><span class="p">,</span><span class="n">socket</span><span class="o">.</span><span class="n">gaierror</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;FTP is unavailable,please check the host,username and password!&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="n">ftp</span><span class="p">):</span>
    <span class="n">ftp</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">upload</span><span class="p">(</span><span class="n">ftp</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">)</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filepath</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">storbinary</span><span class="p">(</span><span class="s">&#39;STOR </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="n">file_name</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">CONST_BUFFER_SIZE</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">error_perm</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="n">ftp</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&quot;wb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">retrbinary</span><span class="p">(</span><span class="s">&quot;RETR </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">filename</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">CONST_BUFFER_SIZE</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ftplib</span><span class="o">.</span><span class="n">error_perm</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="n">ftp</span><span class="p">):</span>
    <span class="n">ftp</span><span class="o">.</span><span class="n">dir</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">ftp</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">ftp_f_list</span> <span class="o">=</span> <span class="n">ftp</span><span class="o">.</span><span class="n">nlst</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">ftp_f_list</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">help</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;help info:&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;[./ftp.py l]</span><span class="se">\t</span><span class="s"> show the file list of the ftp site &quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;[./ftp.py f filenamA filenameB]</span><span class="se">\t</span><span class="s"> check if the file is in the ftp site&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;[./ftp.py p filenameA filenameB]</span><span class="se">\t</span><span class="s"> upload file into ftp site&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;[./ftp.py g filenameA filenameB]</span><span class="se">\t</span><span class="s"> get file from ftp site&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;[./ftp.py h]</span><span class="se">\t</span><span class="s"> show help info&quot;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;other params are invalid&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Params needed!&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">ftp</span> <span class="o">=</span> <span class="n">connect</span><span class="p">()</span>

    <span class="n">success_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">failed_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;p&quot;</span><span class="p">:</span>
        <span class="n">f_list</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">for</span> <span class="n">up_file</span> <span class="ow">in</span> <span class="n">f_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">up_file</span><span class="p">):</span>
            <span class="k">print</span><span class="p">((</span><span class="s">&quot;UPLOAD: </span><span class="si">%s</span><span class="s"> &quot;</span><span class="o">+</span><span class="n">COLOR_RED</span><span class="o">+</span><span class="s">&quot;FAILED&quot;</span><span class="o">+</span><span class="n">COLOR_NONE</span><span class="o">+</span><span class="s">&quot;  :file not exist&quot;</span><span class="p">)</span><span class="o">%</span><span class="n">up_file</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">up_file</span><span class="p">):</span>
            <span class="k">print</span><span class="p">((</span><span class="s">&quot;UPLOAD: </span><span class="si">%s</span><span class="s"> &quot;</span><span class="o">+</span><span class="n">COLOR_RED</span><span class="o">+</span><span class="s">&quot;FAILED&quot;</span><span class="o">+</span><span class="n">COLOR_NONE</span><span class="o">+</span><span class="s">&quot;  :</span><span class="si">%s</span><span class="s"> is not a file&quot;</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="n">up_file</span><span class="p">,</span><span class="n">up_file</span><span class="p">))</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">upload</span><span class="p">(</span><span class="n">ftp</span><span class="p">,</span> <span class="n">up_file</span><span class="p">):</span>
            <span class="n">success_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">up_file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">failed_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">up_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">success_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
        <span class="k">print</span><span class="p">((</span><span class="n">COLOR_GREEN</span> <span class="o">+</span> <span class="s">&quot;UPLOAD SUCCESS: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">COLOR_NONE</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">success_list</span><span class="p">)))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;md5sum:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">success_list</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;md5sum &quot;</span> <span class="o">+</span> <span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">failed_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">((</span><span class="n">COLOR_RED</span> <span class="o">+</span> <span class="s">&quot;UPLOAD FAILED: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">COLOR_NONE</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">failed_list</span><span class="p">)))</span>

    <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;g&quot;</span><span class="p">:</span>
        <span class="n">f_list</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">for</span> <span class="n">down_file</span> <span class="ow">in</span> <span class="n">f_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">find</span><span class="p">(</span><span class="n">ftp</span><span class="p">,</span><span class="n">down_file</span><span class="p">):</span>
            <span class="k">print</span><span class="p">((</span><span class="s">&quot;DOWNLOAD: </span><span class="si">%s</span><span class="s"> &quot;</span><span class="o">+</span><span class="n">COLOR_RED</span><span class="o">+</span><span class="s">&quot;FAILED&quot;</span><span class="o">+</span><span class="n">COLOR_NONE</span><span class="o">+</span><span class="s">&quot;  :</span><span class="si">%s</span><span class="s"> is not in the ftp site&quot;</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="n">down_file</span><span class="p">,</span><span class="n">down_file</span><span class="p">))</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">download</span><span class="p">(</span><span class="n">ftp</span><span class="p">,</span> <span class="n">down_file</span><span class="p">):</span>
            <span class="n">success_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">down_file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">failed_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">down_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">success_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">:</span>
        <span class="k">print</span><span class="p">((</span><span class="n">COLOR_GREEN</span> <span class="o">+</span> <span class="s">&quot;DOWNLOAD SUCCESS: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">COLOR_NONE</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">success_list</span><span class="p">)))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;md5sum:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">success_list</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s">&quot;md5sum &quot;</span> <span class="o">+</span> <span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">failed_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">((</span><span class="n">COLOR_RED</span> <span class="o">+</span> <span class="s">&quot;DOWNLOAD FAILED: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">COLOR_NONE</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">failed_list</span><span class="p">)))</span>

    <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;l&quot;</span><span class="p">:</span>
        <span class="nb">list</span><span class="p">(</span><span class="n">ftp</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;f&quot;</span><span class="p">:</span>
        <span class="n">f_list</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">f_file</span> <span class="ow">in</span> <span class="n">f_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">find</span><span class="p">(</span><span class="n">ftp</span><span class="p">,</span><span class="n">f_file</span><span class="p">):</span>
            <span class="k">print</span><span class="p">((</span><span class="s">&quot;SEARCH: </span><span class="si">%s</span><span class="s"> &quot;</span><span class="o">+</span><span class="n">COLOR_GREEN</span><span class="o">+</span><span class="s">&quot;EXIST&quot;</span><span class="o">+</span><span class="n">COLOR_NONE</span><span class="p">)</span><span class="o">%</span><span class="n">f_file</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">((</span><span class="s">&quot;SEARCH: </span><span class="si">%s</span><span class="s"> &quot;</span><span class="o">+</span><span class="n">COLOR_RED</span><span class="o">+</span><span class="s">&quot;NOT EXIST&quot;</span><span class="o">+</span><span class="n">COLOR_NONE</span><span class="p">)</span><span class="o">%</span><span class="n">f_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">f_file</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Similar File List:&quot;</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">ftp</span><span class="o">.</span><span class="n">nlst</span><span class="p">()</span>
            <span class="k">print</span>  <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">s</span> <span class="k">if</span> <span class="n">f_file</span> <span class="ow">in</span> <span class="n">k</span><span class="p">])</span>

    <span class="k">elif</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;h&quot;</span><span class="p">:</span>
        <span class="n">help</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;args are invalid!&quot;</span><span class="p">)</span>
        <span class="n">help</span><span class="p">()</span>

    <span class="n">disconnect</span><span class="p">(</span><span class="n">ftp</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
  <span class="n">main</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<h3>常用函数</h3>
<p>用手册查看，以下只是简略，因为没用用到，[待整理]：</p>
<div class="highlight"><pre><span class="n">login</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="err">&#39;&#39;</span><span class="p">,</span><span class="n">passwd</span><span class="o">=</span><span class="err">&#39;&#39;</span><span class="p">,</span> <span class="n">acct</span><span class="o">=</span><span class="err">&#39;&#39;</span><span class="p">)</span>     <span class="err">登录到</span><span class="n">FTP</span> <span class="err">服务器，所有的参数都是可选的</span>
<span class="n">pwd</span><span class="p">()</span>                       <span class="err">当前工作目录</span>
<span class="n">cwd</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>                   <span class="err">把当前工作目录设置为</span><span class="n">path</span>
<span class="n">dir</span><span class="p">([</span><span class="n">path</span><span class="p">[,...[,</span><span class="n">cb</span><span class="p">]])</span>       <span class="err">显示</span><span class="n">path</span> <span class="err">目录里的内容，可选的参数</span><span class="n">cb</span> <span class="err">是一个回调函数，会被传给</span><span class="n">retrlines</span><span class="p">()</span><span class="err">方法</span>
<span class="n">nlst</span><span class="p">([</span><span class="n">path</span><span class="p">[,...])</span>           <span class="err">与</span><span class="n">dir</span><span class="p">()</span><span class="err">类似，但返回一个文件名的列表，而不是显示这些文件名</span>
<span class="n">retrlines</span><span class="p">(</span><span class="n">cmd</span> <span class="p">[,</span> <span class="n">cb</span><span class="p">])</span>       <span class="err">给定</span><span class="n">FTP</span> <span class="err">命令（如“</span><span class="n">RETR</span> <span class="n">filename</span><span class="err">”），用于下载文本文件。可选的回调函数</span><span class="n">cb</span> <span class="err">用于处理文件的每一行</span>
<span class="n">retrbinary</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">cb</span><span class="p">[,</span><span class="n">bs</span><span class="o">=</span><span class="mi">8192</span><span class="p">[,</span> <span class="n">ra</span><span class="p">]])</span>     <span class="err">与</span><span class="n">retrlines</span><span class="p">()</span><span class="err">类似，只是这个指令处理二进制文件。回调函数</span><span class="n">cb</span> <span class="err">用于处理每一块（块大小默认为</span><span class="mi">8</span><span class="n">K</span><span class="err">）下载的数据。</span>
<span class="n">storlines</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>   <span class="err">给定</span><span class="n">FTP</span> <span class="err">命令（如“</span><span class="n">STOR</span> <span class="n">filename</span><span class="err">”），以上传文本文件。要给定一个文件对象</span><span class="n">f</span>
<span class="n">storbinary</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">f</span><span class="p">[,</span><span class="n">bs</span><span class="o">=</span><span class="mi">8192</span><span class="p">])</span>    <span class="err">与</span><span class="n">storlines</span><span class="p">()</span><span class="err">类似，只是这个指令处理二进制文件。要给定一个文件对象</span><span class="n">f</span><span class="err">，上传块大小</span><span class="n">bs</span> <span class="err">默认为</span><span class="mi">8</span><span class="n">Kbs</span><span class="o">=</span><span class="mi">8192</span><span class="p">])</span>
<span class="n">rename</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>    <span class="err">把远程文件</span><span class="n">old</span> <span class="err">改名为</span><span class="n">new</span>
<span class="n">delete</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>     <span class="err">删除位于</span><span class="n">path</span> <span class="err">的远程文件</span>
<span class="n">mkd</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>  <span class="err">创建远程目录</span>
</pre></div>
        </div><!-- /.entry-content -->
        <div class="comments">
            如果文章对你有帮助，欢迎对wklken进行无负担小额赞助 <a href="https://me.alipay.com/wklken" target="_blank"> 支付宝 </a> <br>
            版权声明：自由转载-非商用-非衍生-保持署名 | <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank" >Creative Commons BY-NC-ND 3.0</a>
        <h2>Comments !</h2>
            <div id="disqus_thread"></div>
            <script type="text/javascript">
               var disqus_identifier = "posts/2011/12/10/python-ftp-ftplib.html";
               (function() {
               var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
               dsq.src = 'http://wklken.disqus.com/embed.js';
               (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
              })();
            </script>
        </div>

        </article>
</div>


</div>
</section>
<script type="text/javascript">
    var disqus_shortname = 'wklken';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>


<!-- JiaThis Button BEGIN -->
<script type="text/javascript" >
var jiathis_config={
    siteNum:15,
    sm:"fav,copy,ishare,tsina,googleplus,fb,twitter,evernote,ydnote,sdonote,xianguo,digg,qingbiji,weixin",
    summary:"",
    boldNum:3,
    showClose:false,
    hideMore:true
}
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code_mini/jiathis_r.js?btn=r2.gif&move=0" charset="utf-8"></script>
<!-- JiaThis Button END -->
<a href="#top" id="toTop" style="display: inline;"></a>



        <section id="extras" class="body">
        </section><!-- /#extras -->

		<footer id="footer">
		<p class="copyright">
                <address id="about" class="vcard body">
                    Powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Theme by <a href="https://github.com/daker">Adnane Belmadiaf</a> and modify by <a href="https://github.com/wklken">wklken</a> Social Icons by <a href="http://fortawesome.github.io/Font-Awesome/">Font-Awesome</a>.

                    <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">Theme licensed under <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0</a>.
             </address><!-- /#about -->

			 </p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-42275748-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>


<!-- 先停掉，感觉有丢页,需要仔细学习用法排查问题
<script src="http://wklken.me/theme/js/instantclick.min.js" data-no-instant></script>
<script data-no-instant>InstantClick.init();</script>
-->

</body>
</html>