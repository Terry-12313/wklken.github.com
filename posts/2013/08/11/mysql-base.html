<!DOCTYPE html>
<html lang="en">

<!--[if IE 8]> <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

<head>
    <meta name="google-site-verification" content="SzE6WCs23qFevgBzRIuG9vcfLU0lW_Vd5hFT-cJOLBE" />
    <title>Mysql基础笔记</title>
    <meta charset="utf-8" />
    <meta name="description" content="">
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

        <link rel="shortcut icon" href="/favicon.ico"/>
        <link rel="stylesheet" href="/theme/css/styles.css" media="all" />
        <link rel="stylesheet" href="/theme/css/ui.totop.css" media="all" />

        <!--
        <link href='http://fonts.googleapis.com/css?family=Gentium+Basic:400,700,400italic,700italic|Gentium+Book+Basic:400,700|PT+Sans+Narrow|Source+Code+Pro' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="/theme/css/normalize.css" media="all" />
        -->

        <link rel="stylesheet" href="/theme/css/font-awesome.min.css">
        <!--[if IE 7]>
            <link rel="stylesheet" href="/theme/css/font-awesome-ie7.min.css">
        <![endif]-->

        <link href="/" type="application/atom+xml" rel="alternate" title="wklken's blog ATOM Feed" />
        <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="wklken's blog RSS Feed" />

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie.css"/>
                <script src="/js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="/css/ie6.css"/><![endif]-->

<script src="/theme/js/jquery.ui.totop.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $().UItoTop({ easingType: 'easeOutQuart' });
    });
</script>

</head>

<body id="index" class="home">
    <div id="page" class="row">
        <div class="large-8 large-centered columns">

        <header id="header">
            <div class="constraint">
                <div class="o"> 
                    <a href="/"><h1 class="banner">Wklken <span class="blue"> Python</span></h1></a>

                <div class="social">
                            <a href="https://github.com/wklken" target='_blank'><i class="icon-github-sign icon-2x"></i></a>
                            <a href="http://weibo.com/wklken" target='_blank'><i class="icon-weibo icon-2x"></i></a>
                            <a href="mailto:wklken@yeah.net"><i class="icon-envelope icon-2x"></i></a>
                            <a href="/feed.xml" target='_blank'><i class="icon-rss-sign icon-2x"></i></a>
                </div>
                <div class="nav">
                            <a href="/">首页</a>
                            <a href="/categories.html">分类</a>
                            <a href="/archives.html">归档</a>
                            <a href="/pages/projects.html">项目</a>
                            <a href="/pages/tools.html">工具</a>
                            <a href="/pages/books.html">书单</a>
                            <a href="/pages/aboutme.html">关于</a>

                </div>

                </div>
            </div>
        </header><!-- /#banner -->

        <section id="main">

<article id="article">
    <section id="header">
        <!--
        <div class="meta">2013年08月11日</div>
        <h1 id="title"> Mysql基础笔记 </h1>
        -->
        <div class="meta"> &nbsp; </div>
        <h1> Mysql基础笔记 </h1>
    </section>
    <section id="content">
        <p>update: 2013-08-11, 笔记录了一半不到，还没码完....&gt;&lt;
update: 2013-11-23, DONE</p>
<p>mysql速查</p>
<p>参考： Mysql必知必会,网络blog, stackoverflow</p>
<p>注； 基础部分sql参考 《mysql必知必会》, 还不错的一本书，菜鸟入门级，需要的话可以入手</p>
<p>在浏览器中使用查找</p>
<p>寻找一个好的mysql开源gui工具</p>
<h2>环境配置</h2>
<p>ubuntu安装mysql</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">mysql</span><span class="o">-</span><span class="n">server</span> <span class="n">mysql</span><span class="o">-</span><span class="n">client</span>
<span class="n">netstat</span> <span class="o">-</span><span class="n">nltp</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">mysql</span>
<span class="err">配置文件</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">mysql</span><span class="o">/</span><span class="n">my</span><span class="p">.</span><span class="n">conf</span>
</pre></div>


<h2>基本概念</h2>
<p>数据库基础：</p>
<div class="codehilite"><pre><span class="n">InnoDB</span><span class="err">是一个可靠地事务处理引擎，不支持全文本搜索</span>
<span class="n">MyISAM</span><span class="err">是一个性能极高的引擎，支持全文本搜索，不支持事务处理</span>
</pre></div>


<p>数据库-database</p>
<div class="codehilite"><pre><span class="err">保存有组织的数据的容器（通常是一个文件或一组文件）</span>
</pre></div>


<p>表-table</p>
<div class="codehilite"><pre><span class="err">某种特定类型数据的结构化清单</span>
</pre></div>


<p>模式-schema</p>
<div class="codehilite"><pre><span class="err">关于数据库和表的布局及特性的信息</span>
</pre></div>


<p>列-column</p>
<div class="codehilite"><pre><span class="err">表中的一个字段，所有表都是由一个或多个列组成的</span>
</pre></div>


<p>数据类型-datatype</p>
<div class="codehilite"><pre><span class="err">所容许的数据的类型。每个表列都有相应的数据类型，它限制（或容许）该列中存储的数据</span>
</pre></div>


<p>行-row</p>
<div class="codehilite"><pre><span class="err">表中的一个记录</span>
</pre></div>


<p>主键-primary key</p>
<div class="codehilite"><pre><span class="err">一列或一组列，其值能够唯一区分表中的每个行</span>
</pre></div>


<h2>mysql命令行</h2>
<h3>进入</h3>
<div class="codehilite"><pre><span class="err">输入：</span> <span class="n">mysql</span>
<span class="err">或者</span>   <span class="n">mysql</span> <span class="o">-</span><span class="n">u</span> <span class="n">ken</span>
       <span class="n">mysql</span> <span class="o">-</span><span class="n">u</span> <span class="n">ken</span> <span class="o">-</span><span class="n">p</span> <span class="o">-</span><span class="n">h</span> <span class="n">myserver</span> <span class="o">-</span><span class="n">P</span> <span class="mi">9999</span> <span class="err">【给出用户名，主机名，端口】</span>

<span class="err">获取帮助</span><span class="o">:</span> <span class="n">mysql</span> <span class="o">--</span><span class="n">help</span>
</pre></div>


<p>命令格式和说明：</p>
<div class="codehilite"><pre><span class="mf">1.</span><span class="err">命令必须；或\</span><span class="n">g</span><span class="err">结束，仅</span><span class="n">Enter</span><span class="err">不执行明林</span>
<span class="mf">2.</span><span class="n">help</span> <span class="err">或\</span><span class="n">h</span><span class="err">获得帮助</span>
<span class="mf">3.</span><span class="n">quit</span><span class="err">或</span><span class="n">exit</span><span class="err">退出</span>
</pre></div>


<p>可以用GUI工具</p>
<div class="codehilite"><pre><span class="n">MySQL</span> <span class="n">Administrator</span>
<span class="n">MySQL</span> <span class="n">Query</span> <span class="n">Browser</span>
</pre></div>


<h3>use</h3>
<p>创建库:</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">CREATE</span> <span class="n">DATABASE</span> <span class="n">MYSQLDATA</span>
</pre></div>


<p>使用某个库</p>
<div class="codehilite"><pre><span class="n">use</span> <span class="n">db_name</span>
</pre></div>


<h3>show</h3>
<p>查看所有数据库</p>
<div class="codehilite"><pre><span class="n">show</span> <span class="n">databases</span><span class="p">;</span>
</pre></div>


<p>列出库中所有表</p>
<div class="codehilite"><pre><span class="n">use</span> <span class="n">db_name</span><span class="p">;</span>
<span class="n">show</span> <span class="n">tables</span><span class="p">;</span>
</pre></div>


<p>列出表的所有列信息</p>
<div class="codehilite"><pre><span class="n">show</span> <span class="n">columns</span> <span class="n">from</span> <span class="n">table_name</span><span class="p">;</span>
<span class="n">or</span>
<span class="n">desc</span> <span class="n">table_name</span><span class="p">;</span>
</pre></div>


<p>显示创建的sql语句</p>
<div class="codehilite"><pre><span class="n">show</span> <span class="n">create</span> <span class="n">database</span> <span class="n">db_name</span><span class="p">;</span>
<span class="n">show</span> <span class="n">create</span> <span class="n">table</span> <span class="n">table_name</span><span class="p">;</span>
</pre></div>


<p>其他</p>
<div class="codehilite"><pre><span class="n">show</span> <span class="n">status</span>  <span class="err">服务器状态信息</span>
<span class="n">show</span> <span class="n">grants</span>  <span class="err">显示授权用户</span>
<span class="n">show</span> <span class="n">errors</span><span class="o">/</span><span class="n">show</span> <span class="n">warnings</span> <span class="err">显示服务器错误或警告信息</span>
</pre></div>


<h2>查询</h2>
<p>SELECT子句顺序</p>
<div class="codehilite"><pre><span class="n">SELECT</span>
<span class="n">FROM</span>
<span class="n">WHERE</span>
<span class="n">GROUP</span> <span class="n">BY</span>
<span class="n">HAVING</span>
<span class="n">ORDER</span> <span class="n">BY</span>
<span class="n">LIMIT</span>
</pre></div>


<h3>select</h3>
<p>检索单个列</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">col</span> <span class="n">FROM</span> <span class="n">tb_name</span><span class="p">;</span>
</pre></div>


<p>多个列</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
</pre></div>


<p>检索所有列</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="o">*</span>
 <span class="n">FROM</span> <span class="n">tb_name</span><span class="p">;</span>
<span class="cp">#除非确认要用到所有列</span>
</pre></div>


<p>检索去重</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">DISTINCT</span> <span class="n">col</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
</pre></div>


<p>限制结果数</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">col1</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
 <span class="n">LIMIT</span> <span class="mi">5</span><span class="p">;</span>
<span class="err">返回不多于五行</span>

<span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">col1</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
 <span class="n">LIMIT</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span>
 <span class="err">第一个为开始位置，初始为</span><span class="mf">0.</span><span class="err">第二个为显示个数</span>
<span class="err">等价于</span><span class="n">LIMIT</span> <span class="mi">5</span> <span class="n">OFFSET</span> <span class="mi">5</span>
</pre></div>


<h3>order by</h3>
<p>按某个字段排序</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">col1</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
 <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">col1</span>
</pre></div>


<p>按多列排序</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">,</span> <span class="n">col3</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
 <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span>
</pre></div>


<p>指定排序方向（升序降序）</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
 <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">col1</span> <span class="n">DESC</span><span class="p">;</span><span class="err">【默认</span><span class="n">ASC</span><span class="err">】</span>
<span class="err">注意：如果想在多个列上排序，必须对每个列使用</span><span class="n">DESC</span>
<span class="err">注意：</span><span class="n">ORDER</span> <span class="n">BY</span><span class="err">必须放在</span><span class="n">LIMIT</span><span class="err">之前</span>
</pre></div>


<h3>where</h3>
<p>过滤</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
 <span class="n">WHERE</span> <span class="n">col1</span> <span class="o">=</span> <span class="mf">2.5</span><span class="p">;</span>
</pre></div>


<p>过滤不匹配</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
 <span class="n">WHERE</span> <span class="n">col1</span> <span class="o">&lt;&gt;</span> <span class="mi">1000</span>
</pre></div>


<p>范围检查</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
 <span class="n">WHERE</span> <span class="n">col1</span> <span class="n">BETWEEN</span> <span class="mi">5</span> <span class="n">AND</span> <span class="mi">10</span>
</pre></div>


<p>空值检查</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">col1</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
 <span class="n">WHERE</span> <span class="n">col2</span> <span class="n">IS</span> <span class="nb">NULL</span>
<span class="nb">NULL</span><span class="p">,</span> <span class="err">无值，它与字段包含</span><span class="mi">0</span><span class="err">，空字符串或仅仅包含空格不同</span>
</pre></div>


<p>多条件，组合and</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">col1</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
 <span class="n">WHERE</span> <span class="n">col1</span><span class="o">=</span><span class="mi">100</span> <span class="n">AND</span> <span class="n">col2</span> <span class="o">&lt;=</span> <span class="mi">10</span>
</pre></div>


<p>多条件, 组合or</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">col1</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
 <span class="n">WHERE</span> <span class="n">col1</span><span class="o">=</span><span class="mi">100</span> <span class="n">OR</span> <span class="n">col2</span> <span class="o">&lt;=</span> <span class="mi">10</span>
</pre></div>


<p>优先级 and 大于 or, 先处理的and,所以应该适当使用括号</p>
<div class="codehilite"><pre><span class="n">select</span> <span class="n">prod_id</span> <span class="n">from</span> <span class="n">products</span> <span class="n">where</span> <span class="p">(</span><span class="n">prod_price</span> <span class="o">&lt;</span> <span class="mf">2.5</span> <span class="n">or</span> <span class="n">vend_id</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span> <span class="n">and</span> <span class="n">prod_price</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">;</span>
</pre></div>


<p>指定查询范围, in操作符</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">col1</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
 <span class="n">WHERE</span> <span class="n">col1</span> <span class="n">IN</span> <span class="p">(</span><span class="mi">1001</span><span class="p">,</span><span class="mi">1002</span><span class="p">)</span>
</pre></div>


<p>取反，not操作符</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">col1</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
 <span class="n">WHERE</span> <span class="n">col1</span> <span class="n">NOT</span> <span class="n">IN</span> <span class="p">(</span><span class="mi">1001</span><span class="p">,</span><span class="mi">1002</span><span class="p">)</span>
</pre></div>


<p>操作符</p>
<div class="codehilite"><pre><span class="o">=</span>
<span class="o">&lt;&gt;</span>
<span class="o">!=</span>
<span class="o">&lt;</span>
<span class="o">&lt;=</span>
<span class="o">&gt;</span>
<span class="o">&gt;=</span>
<span class="n">between</span> <span class="n">A</span> <span class="n">and</span> <span class="n">B</span>
</pre></div>


<h3>like</h3>
<p>通配</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">col1</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
 <span class="n">WHERE</span> <span class="n">col1</span> <span class="n">LIKE</span> <span class="err">‘</span><span class="n">jet</span><span class="o">%</span><span class="err">’</span>

<span class="o">%</span><span class="err">匹配</span><span class="mi">0</span><span class="err">个或多个字符</span>
</pre></div>


<p>单个字符</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">col1</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
 <span class="n">WHERE</span> <span class="n">col1</span> <span class="n">LIKE</span> <span class="err">‘</span><span class="n">_</span> <span class="n">ton</span> <span class="n">anvil</span><span class="err">’</span>
</pre></div>


<h3>数据过滤regexp</h3>
<p>正则搜索</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">col1</span>
<span class="n">FROM</span> <span class="n">tb_name</span>
<span class="n">WHERE</span> <span class="n">col1</span> <span class="n">REGEXP</span> <span class="err">‘</span><span class="mi">1000</span><span class="err">’</span>

<span class="n">REGEXP</span> <span class="err">‘</span><span class="mf">.000</span><span class="err">’</span>
<span class="n">REGEXP</span><span class="err">对列值匹配</span>
</pre></div>


<p>进行or匹配</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">col1</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
 <span class="n">WHERE</span> <span class="n">col1</span> <span class="n">REGEXP</span> <span class="err">‘</span><span class="mi">1000</span><span class="o">|</span><span class="mi">2000</span><span class="err">’</span>
</pre></div>


<p>几个之一</p>
<div class="codehilite"><pre><span class="n">select</span> <span class="n">prod_id</span> <span class="n">from</span> <span class="n">products</span> <span class="n">where</span> <span class="n">prod_name</span> <span class="n">regexp</span> <span class="err">&#39;</span><span class="p">[</span><span class="mi">1</span><span class="o">|</span><span class="mi">2</span><span class="p">]</span><span class="mo">000</span><span class="err">&#39;</span><span class="p">;</span>
</pre></div>


<p>匹配范围</p>
<div class="codehilite"><pre><span class="n">select</span> <span class="n">prod_id</span> <span class="n">from</span> <span class="n">products</span> <span class="n">where</span> <span class="n">prod_name</span> <span class="n">regexp</span> <span class="err">&#39;</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span><span class="mo">000</span><span class="err">&#39;</span><span class="p">;</span>
</pre></div>


<p>匹配特殊字符，\ 进行转义</p>
<div class="codehilite"><pre><span class="err">必须使用\\为前导。</span> <span class="err">\\</span><span class="o">-</span>
<span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">col1</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
 <span class="n">WHERE</span> <span class="n">col1</span> <span class="n">REGEXP</span> <span class="err">‘\\</span><span class="p">.</span><span class="err">’</span>
</pre></div>


<p>like和 regexp</p>
<div class="codehilite"><pre><span class="n">like</span><span class="err">整列匹配</span>
<span class="n">regexp</span> <span class="err">列值内匹配</span>
</pre></div>


<h3>concat</h3>
<p>拼接字符</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">Concat</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="err">‘</span> <span class="o">----</span><span class="err">‘</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
</pre></div>


<p>去除空白</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">Rtrim</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>

<span class="n">Ltrim</span><span class="p">()</span> <span class="n">Trim</span><span class="p">()</span>
</pre></div>


<p>使用列名</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">Concat</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="err">‘</span><span class="o">---</span><span class="err">‘</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="n">AS</span> <span class="n">info</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
</pre></div>


<p>算术计算</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">quantity</span> <span class="o">*</span> <span class="n">item_price</span> <span class="n">AS</span> <span class="n">total_price</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>

<span class="err">支持</span><span class="o">+</span> <span class="o">-</span> <span class="o">*</span> <span class="o">/</span>
</pre></div>


<h3>文本函数</h3>
<p>文本处理函数</p>
<div class="codehilite"><pre><span class="n">left</span><span class="p">()</span>  <span class="err">串左边字符</span>
<span class="n">length</span><span class="p">()</span> <span class="err">串长度</span>
<span class="n">locate</span><span class="p">()</span> <span class="err">找出串的一个子串</span>
<span class="n">lower</span><span class="p">()</span> <span class="err">转为小写</span>
<span class="n">ltrim</span><span class="p">()</span> <span class="err">去掉左边空格</span>
<span class="n">right</span><span class="p">()</span> <span class="err">返回串右边字符</span>
<span class="n">rtrim</span><span class="p">()</span> <span class="err">去掉串右边空格</span>
<span class="n">soundex</span><span class="p">()</span> <span class="err">返回字符串</span><span class="n">soundex</span><span class="err">值</span>
<span class="n">upper</span><span class="p">()</span> <span class="err">大写</span>
</pre></div>


<p>eg</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">Upper</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="n">FROM</span> <span class="n">tb_name</span>
</pre></div>


<h3>日期函数</h3>
<p>日期和时间处理函数</p>
<div class="codehilite"><pre><span class="n">adddate</span><span class="p">()</span> <span class="err">增加一个日期</span><span class="o">-</span><span class="err">天或周</span>
<span class="n">addtime</span><span class="p">()</span> <span class="err">增加一个时间</span>
<span class="n">curdate</span><span class="p">()</span> <span class="err">返回当前日期</span>
<span class="n">curtime</span><span class="p">()</span> <span class="err">返回当前时间</span>
<span class="n">date</span><span class="p">()</span> <span class="err">返回日期时间的日期部分</span>
<span class="n">datediff</span><span class="p">()</span> <span class="err">计算两个日期差</span>
<span class="n">date_add</span><span class="p">()</span> <span class="err">高度灵活的日期运算函数</span>
<span class="n">date_format</span><span class="p">()</span> <span class="err">返回一个格式化的日期或时间串</span>
<span class="n">day</span><span class="p">()</span> <span class="err">返回一个日期的天数部分</span>
<span class="n">dayofweek</span><span class="p">()</span> <span class="err">对于一个日期，返回对应的星期几</span>
<span class="n">hour</span><span class="p">()</span>
<span class="n">minute</span><span class="p">()</span>
<span class="n">month</span><span class="p">()</span>
<span class="n">now</span><span class="p">()</span> <span class="err">当前日期和时间</span>
<span class="n">second</span><span class="p">()</span>
<span class="n">time</span><span class="p">()</span> <span class="err">当前日期时间的时间部分</span>
<span class="n">year</span><span class="p">()</span>
</pre></div>


<p>eg</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">col1</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
 <span class="n">WHERE</span> <span class="n">Date</span><span class="p">(</span><span class="n">order_date</span><span class="p">)</span> <span class="o">=</span> <span class="err">‘</span><span class="mi">2005</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mo">01</span><span class="err">’</span>
</pre></div>


<p>常用日期和时间函数</p>
<div class="codehilite"><pre><span class="n">Date</span><span class="p">()</span><span class="err">返回日期时间的日期部分</span>
<span class="n">Day</span><span class="p">()</span><span class="err">返回日期的天数部分</span>
</pre></div>


<h3>数值函数</h3>
<p>数值处理函数</p>
<div class="codehilite"><pre><span class="n">abs</span><span class="p">()</span>
<span class="n">cos</span><span class="p">()</span>
<span class="n">exp</span><span class="p">()</span> <span class="err">指数</span>
<span class="n">mod</span><span class="p">()</span>
<span class="n">pi</span><span class="p">()</span> <span class="err">返回圆周率</span>
<span class="n">rand</span><span class="p">()</span> <span class="err">随机数</span>
<span class="n">sin</span><span class="p">()</span>
<span class="n">sqrt</span><span class="p">()</span>
<span class="n">tan</span><span class="p">()</span>
</pre></div>


<h3>聚集函数</h3>
<p>avg 平均</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">AVG</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="n">AS</span> <span class="n">avg_price</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
</pre></div>


<p>count 计数</p>
<div class="codehilite"><pre><span class="n">select</span> <span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">from</span> <span class="n">products</span><span class="p">;</span> <span class="err">#无论</span><span class="n">Null</span><span class="err">还是非空，均纳入计数</span>
<span class="n">select</span> <span class="n">count</span><span class="p">(</span><span class="n">prod_id</span><span class="p">)</span> <span class="n">from</span> <span class="n">products</span><span class="p">;</span> <span class="err">#计数有值记录，忽略</span><span class="nb">NULL</span><span class="err">值</span>
</pre></div>


<p>max 最大</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">MAX</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="n">AS</span> <span class="n">max_price</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
</pre></div>


<p>min 最小</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">MIN</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="n">AS</span> <span class="n">min_price</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
</pre></div>


<p>sum 求和</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">SUM</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span> <span class="n">AS</span> <span class="n">total</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
<span class="cp">#sum函数忽略值为NULL的行</span>
</pre></div>


<h3>group</h3>
<p>group</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="n">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">AS</span> <span class="n">num_prods</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
 <span class="n">GROUP</span> <span class="n">BY</span> <span class="n">id</span>
</pre></div>


<p>注意：</p>
<div class="codehilite"><pre><span class="mf">1.</span><span class="n">group</span> <span class="n">by</span> <span class="err">可以包含任意数目的列</span>
<span class="mf">2.</span><span class="n">group</span> <span class="n">by</span> <span class="err">中每个列都必须是检索列或有效的表达式（但不能使聚集函数）</span>
<span class="mf">3.</span><span class="err">除聚集函数外，</span><span class="n">select</span><span class="err">语句中的每个列都必须在</span><span class="n">group</span> <span class="n">by</span><span class="err">子句中出现</span>
<span class="mf">4.</span><span class="err">如果分组列有</span><span class="n">Null</span><span class="err">值，</span><span class="n">Null</span><span class="err">将作为一个分组返回</span>
<span class="mf">5.</span><span class="n">group</span> <span class="n">by</span> <span class="err">子句必须出现在</span><span class="n">where</span><span class="err">子句之后</span><span class="p">,</span> <span class="n">order</span> <span class="n">by</span> <span class="err">之前</span>
</pre></div>


<p>过滤分组</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">cust_id</span><span class="p">,</span> <span class="n">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">AS</span> <span class="n">orders</span>
 <span class="n">FROM</span> <span class="n">orders</span>
 <span class="n">GROUP</span> <span class="n">BY</span> <span class="n">cust_id</span>
 <span class="n">HAVING</span> <span class="n">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span>
</pre></div>


<p>where和having区别</p>
<div class="codehilite"><pre><span class="n">where</span><span class="err">在分组前过滤，</span><span class="n">having</span><span class="err">在分组后过滤</span>
</pre></div>


<h3>子查询</h3>
<p>1.用于过滤</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">cust_id</span>
 <span class="n">FROM</span> <span class="n">orders</span>
 <span class="n">WHERE</span> <span class="n">order_num</span> <span class="n">IN</span> <span class="p">(</span><span class="n">SELECT</span> <span class="n">order_num</span>
                    <span class="n">FROM</span> <span class="n">orderitems</span><span class="p">)</span>
</pre></div>


<p>2.作为字段</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">cust_name</span><span class="p">,</span>
       <span class="n">cust_state</span><span class="p">,</span>
       <span class="p">(</span><span class="n">SELECT</span> <span class="n">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
        <span class="n">FROM</span> <span class="n">orders</span>
        <span class="n">WHERE</span> <span class="n">orders</span><span class="p">.</span><span class="n">cust_id</span> <span class="o">=</span> <span class="n">customers</span><span class="p">.</span><span class="n">cust_id</span><span class="p">)</span> <span class="n">AS</span> <span class="n">orders</span>
 <span class="n">FROM</span> <span class="n">customers</span>
 <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">cust_name</span>
</pre></div>


<h3>联结表</h3>
<p>1.创建联结</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">vend_name</span><span class="p">,</span> <span class="n">prod_name</span><span class="p">,</span> <span class="n">prod_price</span>
 <span class="n">FROM</span> <span class="n">vendors</span><span class="p">,</span> <span class="n">products</span>
 <span class="n">WHERE</span> <span class="n">vendors</span><span class="p">.</span><span class="n">vend_id</span> <span class="o">=</span> <span class="n">products</span><span class="p">.</span><span class="n">vend_id</span>
 <span class="n">ORDER</span> <span class="n">BY</span> <span class="n">vend_name</span><span class="p">,</span> <span class="n">prod_name</span><span class="p">;</span>
</pre></div>


<p>可进行联结多个表</p>
<p>2.内部联结</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">vend_name</span><span class="p">,</span><span class="n">prod_name</span><span class="p">,</span><span class="n">prod_price</span>
 <span class="n">FROM</span> <span class="n">vendors</span> <span class="n">INNER</span> <span class="n">JOIN</span> <span class="n">products</span> <span class="n">ON</span> <span class="n">vendors</span><span class="p">.</span><span class="n">vend_id</span> <span class="o">=</span> <span class="n">products</span><span class="p">.</span><span class="n">vend_id</span>
</pre></div>


<h3>高级联结表</h3>
<p>1.自联结</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">prod_id</span><span class="p">,</span> <span class="n">prod_name</span>
 <span class="n">FROM</span> <span class="n">products</span>
 <span class="n">WHERE</span> <span class="n">vend_id</span> <span class="o">=</span> <span class="p">(</span><span class="n">SELECT</span> <span class="n">vend_id</span> <span class="n">FROM</span> <span class="n">products</span>
                <span class="n">WHERE</span> <span class="n">prod_id</span> <span class="o">=</span> <span class="err">‘</span><span class="n">DTNTR</span><span class="err">’</span><span class="p">)</span>
</pre></div>


<p>等价于</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">p1</span><span class="p">.</span><span class="n">prod_id</span><span class="p">,</span> <span class="n">p1</span><span class="p">.</span><span class="n">prod_name</span>
 <span class="n">FROM</span> <span class="n">products</span> <span class="n">AS</span> <span class="n">p1</span><span class="p">,</span> <span class="n">products</span> <span class="n">AS</span> <span class="n">p2</span>
 <span class="n">WHERE</span> <span class="n">p1</span><span class="p">.</span><span class="n">vend_id</span> <span class="o">=</span> <span class="n">p2</span><span class="p">.</span><span class="n">vend_id</span>
        <span class="n">AND</span> <span class="n">p2</span><span class="p">.</span><span class="n">prod_id</span> <span class="o">=</span> <span class="err">‘</span><span class="n">DTNTR</span><span class="err">’</span>
</pre></div>


<p>2.外部联结</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">customers</span><span class="p">.</span><span class="n">cust_id</span><span class="p">,</span> <span class="n">orders</span><span class="p">.</span><span class="n">order_num</span>
 <span class="n">FROM</span> <span class="n">customers</span> <span class="n">LEFT</span> <span class="n">OUTER</span> <span class="n">JOIN</span> <span class="n">orders</span>
      <span class="n">ON</span> <span class="n">customers</span><span class="p">.</span><span class="n">cust_id</span> <span class="o">=</span> <span class="n">orders</span><span class="p">.</span><span class="n">cust_id</span>
</pre></div>


<h3>组合查询</h3>
<p>1.UNION</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">vend_id</span><span class="p">,</span> <span class="n">prod_id</span><span class="p">,</span> <span class="n">prod_price</span>
 <span class="n">FROM</span> <span class="n">products</span>
 <span class="n">WHERE</span> <span class="n">prod_price</span> <span class="o">&lt;=</span><span class="mi">5</span>
 <span class="n">UNION</span>
 <span class="n">SELECT</span> <span class="n">vend_id</span><span class="p">,</span> <span class="n">prod_id</span><span class="p">,</span> <span class="n">prod_price</span>
 <span class="n">FROM</span> <span class="n">products</span>
 <span class="n">WHERE</span> <span class="n">vend_id</span> <span class="n">IN</span> <span class="p">(</span><span class="mi">1001</span><span class="p">,</span><span class="mi">1002</span><span class="p">)</span>

<span class="n">UNION</span><span class="err">自动去除重复行</span>
<span class="n">UNION</span> <span class="n">ALL</span> <span class="err">保留</span>
</pre></div>


<p>2.放在UNION后的排序语句</p>
<div class="codehilite"><pre><span class="err">对所有</span><span class="n">SELECT</span><span class="err">生效</span>
</pre></div>


<h3>全文本搜索</h3>
<p>MyISAM 支持全文本搜索</p>
<p>InnoDB不支持全文本搜索</p>
<p>1.启用</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">productnotes</span><span class="p">(</span>
 <span class="n">note_id</span> <span class="kt">int</span> <span class="n">NOT</span> <span class="nb">NULL</span> <span class="n">AUT_INCREMENT</span><span class="p">,</span>
 <span class="n">note_text</span> <span class="n">text</span> <span class="nb">NULL</span><span class="p">,</span>
 <span class="n">FULLTEXT</span><span class="p">(</span><span class="n">note_text</span><span class="p">)</span>
</pre></div>


<p>2.进行全文本搜索</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">note_text</span>
 <span class="n">FROM</span> <span class="n">tb_name</span>
 <span class="n">WHERE</span> <span class="n">Match</span><span class="p">(</span><span class="n">note_text</span><span class="p">)</span> <span class="n">Against</span><span class="p">(</span><span class="err">‘</span><span class="n">rabbit</span><span class="err">’</span><span class="p">)</span>
</pre></div>


<p>3.布尔文本搜索</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">note_text</span>
 <span class="n">FROM</span> <span class="n">productontes</span>
 <span class="n">WHERE</span> <span class="n">Match</span><span class="p">(</span><span class="n">note_text</span><span class="p">)</span> <span class="n">Against</span><span class="p">(</span><span class="err">‘</span><span class="n">heavy</span><span class="err">’</span> <span class="n">IN</span> <span class="n">BOOLEAN</span> <span class="n">MODE</span><span class="p">)</span>
</pre></div>


<h2>插入数据</h2>
<p>1.基本插入</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">customers</span><span class="p">(</span><span class="n">cust_name</span><span class="p">,</span>
                     <span class="n">cust_address</span><span class="p">)</span>
 <span class="n">VALUES</span><span class="p">(</span><span class="err">‘</span><span class="n">Pep</span><span class="err">’</span><span class="p">,</span> <span class="err">‘</span><span class="mi">100</span> <span class="n">main</span> <span class="n">street</span><span class="err">’</span><span class="p">)</span>
</pre></div>


<p>2.插入多行</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">customers</span><span class="p">(</span><span class="n">cust_name</span><span class="p">,</span>
                     <span class="n">cust_address</span><span class="p">)</span>
 <span class="n">VALUES</span><span class="p">(</span><span class="err">‘</span><span class="n">Pep</span><span class="err">’</span><span class="p">,</span> <span class="err">‘</span><span class="mi">100</span> <span class="n">main</span> <span class="n">street</span><span class="err">’</span><span class="p">),</span>
       <span class="p">(</span><span class="err">‘</span><span class="n">Tim</span><span class="err">’</span><span class="p">,</span> <span class="err">‘</span><span class="mi">200</span> <span class="n">main</span> <span class="n">Street</span><span class="err">’</span><span class="p">);</span>
</pre></div>


<p>3.插入检索出来的数据</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">customers</span><span class="p">(</span><span class="n">cust_name</span><span class="p">,</span>
                     <span class="n">cust_address</span><span class="p">)</span>
 <span class="n">SELECT</span> <span class="n">cust_name</span><span class="p">,</span> <span class="n">custaddress</span>
 <span class="n">FROM</span> <span class="n">custnew</span><span class="p">;</span>
</pre></div>


<h2>更新</h2>
<p>1.更新行</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">UPDATE</span> <span class="n">customers</span>
 <span class="n">SET</span> <span class="n">cust_email</span> <span class="o">=</span> <span class="err">‘</span><span class="n">a</span><span class="err">@</span><span class="n">fudd</span><span class="p">.</span><span class="n">com</span><span class="err">’</span>
 <span class="n">WHERE</span> <span class="n">cust_id</span> <span class="o">=</span> <span class="mi">10005</span>
</pre></div>


<p>2.即使发生错误也继续进行而不是退出</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">UPDATE</span> <span class="n">IGNORE</span> <span class="n">customers</span>
</pre></div>


<h2>删除</h2>
<p>1.删除数据</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">DELETE</span> <span class="n">FROM</span> <span class="n">customers</span>
 <span class="n">WHERE</span> <span class="n">cust_id</span> <span class="o">=</span> <span class="mi">10006</span>
</pre></div>


<h2>表操作</h2>
<p>1.创建表</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">customers</span><span class="p">(</span>
   <span class="n">cust_id</span> <span class="kt">int</span> <span class="n">NOT</span> <span class="nb">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
   <span class="n">cust_name</span> <span class="kt">char</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="n">NOT</span> <span class="nb">NULL</span><span class="p">,</span>
   <span class="n">vend_city</span> <span class="kt">char</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="nb">NULL</span><span class="p">,</span>
   <span class="n">quantity</span> <span class="kt">int</span> <span class="n">NOT</span> <span class="nb">NULL</span> <span class="n">DEFAULT</span> <span class="mi">1</span><span class="p">,</span>
   <span class="n">PRIMARY</span> <span class="n">KEY</span><span class="p">(</span><span class="n">cust_id</span><span class="p">)</span>
<span class="p">)</span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span>
</pre></div>


<p>2.更新表</p>
<p>加字段</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">vendors</span>
 <span class="n">ADD</span> <span class="n">vend_phone</span> <span class="n">CHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>


<p>删除某个字段</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">tb1</span> <span class="n">DROP</span> <span class="n">COLUMN</span> <span class="n">names</span><span class="p">;</span>
</pre></div>


<p>改变列类型</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">infos</span> <span class="n">CHANGE</span> <span class="n">list</span> <span class="n">list</span> <span class="n">tinyint</span> <span class="n">NOT</span> <span class="nb">NULL</span> <span class="n">DEFAULT</span> <span class="sc">&#39;0&#39;</span>
</pre></div>


<p>加主键</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">tb1</span> <span class="n">ADD</span> <span class="n">primary</span> <span class="n">key</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
</pre></div>


<p>删除一个字段</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">tb1</span> <span class="n">DROP</span> <span class="n">field_name</span>
</pre></div>


<p>增加自增长主键</p>
<div class="codehilite"><pre><span class="n">alter</span> <span class="n">table</span> <span class="n">customers</span> <span class="n">change</span> <span class="n">id</span> <span class="n">id</span> <span class="n">not</span> <span class="n">null</span> <span class="n">auto_increment</span> <span class="n">primary</span> <span class="n">key</span><span class="p">;</span>
</pre></div>


<p>增加新字段并设置为主键</p>
<div class="codehilite"><pre><span class="n">Alter</span> <span class="n">TABLE</span> <span class="n">tablename</span> <span class="n">ADD</span> <span class="n">new_field_id</span> <span class="kt">int</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">default</span> <span class="mi">0</span> <span class="n">not</span> <span class="n">null</span> <span class="n">auto_increment</span> <span class="n">ADD</span> <span class="n">primary</span> <span class="n">key</span><span class="p">(</span><span class="n">new_field_id</span><span class="p">)</span>

<span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">example</span> <span class="n">ADD</span> <span class="n">ID</span> <span class="n">INT</span> <span class="n">NOT</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">example</span> <span class="n">ADD</span> <span class="n">UNIQUE</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="o">&gt;</span><span class="n">ALTER</span> <span class="n">TABLE</span> <span class="n">vendors</span>
 <span class="n">DROP</span> <span class="n">COLUMN</span> <span class="n">vend_phone</span>
</pre></div>


<p>alter table syntax:
http://dev.mysql.com/doc/refman/5.1/en/alter-table.html</p>
<p>3.删除表</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">DROP</span> <span class="n">TABLE</span> <span class="n">customers2</span><span class="p">;</span>
</pre></div>


<p>4.清空表数据</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">DELETE</span> <span class="n">FROM</span> <span class="n">mytable</span><span class="p">;</span>
</pre></div>


<p>5.重命名表</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">RENAME</span> <span class="n">TABLE</span> <span class="n">customers2</span> <span class="n">TO</span> <span class="n">customers</span><span class="p">;</span>
 <span class="n">ALTER</span> <span class="n">TABLE</span> <span class="err">&#39;</span><span class="n">oldname</span><span class="err">&#39;</span> <span class="n">RENAME</span> <span class="n">TO</span> <span class="err">&#39;</span><span class="n">newname</span><span class="err">&#39;</span>
</pre></div>


<h2>视图操作</h2>
<p>1.创建视图</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">CREATE</span> <span class="n">VIEW</span> <span class="n">productcustomers</span> <span class="n">AS</span>
 <span class="n">SELECT</span> <span class="n">cust_name</span><span class="p">,</span> <span class="n">cust_contact</span>
 <span class="n">FROM</span> <span class="n">customers</span><span class="p">,</span> <span class="n">orders</span><span class="p">,</span> <span class="n">orderitems</span>
 <span class="n">WHERE</span> <span class="n">customers</span><span class="p">.</span><span class="n">cust_id</span> <span class="o">=</span> <span class="n">orders</span><span class="p">.</span><span class="n">cust_id</span>
</pre></div>


<p>2.使用视图</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SELECT</span> <span class="n">cust_name</span><span class="p">,</span> <span class="n">cust_contact</span>
 <span class="n">FROM</span> <span class="n">productcustomers</span>
 <span class="n">WHERE</span> <span class="n">prod_id</span> <span class="o">=</span> <span class="err">‘</span><span class="n">TNT2</span><span class="err">’</span>
</pre></div>


<h2>存储过程</h2>
<p>1.创建简单存储过程</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">CREATE</span> <span class="n">PROCEDURE</span> <span class="n">productpricing</span><span class="p">()</span>
 <span class="n">BEGIN</span>
<span class="n">SELECT</span> <span class="n">Avg</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="n">AS</span> <span class="n">priceavg</span>
<span class="n">FROM</span> <span class="n">products</span><span class="p">;</span>
 <span class="n">END</span><span class="p">;</span>
</pre></div>


<p>调用:CALL productpricing()</p>
<p>2.删除存储过程</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">DROP</span> <span class="n">PROCEDURE</span> <span class="n">productpricing</span>
</pre></div>


<p>3.使用参数</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">CREATE</span> <span class="n">PROCEDURE</span> <span class="n">ordertotal</span><span class="p">(</span>
<span class="n">IN</span> <span class="n">onumber</span> <span class="n">INT</span><span class="p">,</span>
<span class="n">OUT</span> <span class="n">ototal</span> <span class="n">DECIMAL</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">BEGIN</span>
<span class="n">SELECT</span> <span class="n">Sum</span><span class="p">(</span><span class="n">item_price</span><span class="o">*</span><span class="n">quality</span><span class="p">)</span>
<span class="n">FROM</span> <span class="n">orderitems</span>
<span class="n">WHERE</span> <span class="n">order_num</span> <span class="o">=</span> <span class="n">onumber</span>
<span class="n">INTO</span> <span class="n">ototal</span><span class="p">;</span>
<span class="n">END</span><span class="p">;</span>
</pre></div>


<p>调用:</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">CALL</span> <span class="n">ordertotal</span><span class="p">(</span><span class="mi">200005</span><span class="p">,</span> <span class="err">@</span><span class="n">total</span><span class="p">;</span>
<span class="o">&gt;</span><span class="n">SELECT</span> <span class="err">@</span><span class="n">total</span><span class="p">;</span>
</pre></div>


<p>3.检查存储过程</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SHOW</span> <span class="n">CREATE</span> <span class="n">PROCEDURE</span> <span class="n">ordertotal</span><span class="p">;</span>
</pre></div>


<h2>游标</h2>
<p>1.创建游标</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">CREATE</span> <span class="n">PROCEDURE</span> <span class="n">processorders</span><span class="p">()</span>
 <span class="n">BEGIN</span>
<span class="n">DECLARE</span> <span class="n">ordernumbers</span> <span class="n">CURSOR</span>
<span class="n">FOR</span>
<span class="n">SELECT</span> <span class="n">order_number</span> <span class="n">FROM</span> <span class="n">orders</span><span class="p">;</span>

<span class="n">BEGIN</span> <span class="n">ordernumbers</span><span class="p">;</span>

<span class="n">FETCH</span> <span class="n">ordernumbers</span> <span class="n">INTO</span> <span class="n">o</span><span class="p">;</span>

<span class="n">CLOSE</span> <span class="n">ordernumbers</span><span class="p">;</span>
 <span class="n">END</span><span class="p">;</span>

<span class="n">DECLARE</span> <span class="n">CONTINUE</span> <span class="n">HANDLER</span> <span class="n">FOR</span> <span class="n">SQLSTATE</span> <span class="err">‘</span><span class="mo">02000</span><span class="err">’</span> <span class="n">SET</span> <span class="n">done</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">REPEAT</span>
    <span class="n">FETCH</span> <span class="n">ordernumbers</span> <span class="n">INTO</span> <span class="n">o</span><span class="p">;</span>
<span class="n">END</span><span class="p">;</span>
</pre></div>


<h2>触发器</h2>
<p>1.创建触发器</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">CREATE</span> <span class="n">TRIGGER</span> <span class="n">newproduct</span> <span class="n">AFTER</span> <span class="n">INSERT</span> <span class="n">ON</span> <span class="n">products</span>
 <span class="n">FOR</span> <span class="n">EACH</span> <span class="n">ROW</span> <span class="n">SELECT</span> <span class="err">‘</span><span class="n">Product</span> <span class="n">added</span><span class="err">’</span>
</pre></div>


<p>2.删除触发器</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">DROP</span> <span class="n">TRIGGER</span> <span class="n">newproduct</span><span class="p">;</span>
</pre></div>


<p>3.INSERT触发器</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">CREATE</span> <span class="n">TRIGGER</span> <span class="n">neworder</span> <span class="n">AFTER</span> <span class="n">INSERT</span> <span class="n">ON</span> <span class="n">orders</span>
 <span class="n">FOR</span> <span class="n">EACH</span> <span class="n">ROW</span> <span class="n">SELECT</span> <span class="n">NEW</span><span class="p">.</span><span class="n">order_num</span>
</pre></div>


<p>4.DELETE触发器</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">CREATE</span> <span class="n">TRIGGER</span> <span class="n">deleteorder</span> <span class="n">BEFORE</span> <span class="n">DELETE</span> <span class="n">ON</span> <span class="n">orders</span>
 <span class="n">FOR</span> <span class="n">EACH</span> <span class="n">ROW</span>
 <span class="n">BEGIN</span>
<span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">archive_orders</span><span class="p">(</span><span class="n">order_num</span><span class="p">,</span> <span class="n">order_date</span><span class="p">,</span> <span class="n">cust_id</span><span class="p">)</span>
<span class="n">VALUES</span><span class="p">(</span><span class="n">OLD</span><span class="p">.</span><span class="n">order_num</span><span class="p">,</span> <span class="n">OLD</span><span class="p">.</span><span class="n">order_date</span><span class="p">,</span> <span class="n">OLD</span><span class="p">.</span><span class="n">cust_id</span><span class="p">);</span>
 <span class="n">END</span><span class="p">;</span>
</pre></div>


<p>5.UPDATE触发器</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">CREATE</span> <span class="n">TRIGGER</span> <span class="n">updatevendor</span> <span class="n">BEFORE</span> <span class="n">UPDATE</span> <span class="n">ON</span> <span class="n">vendors</span>
 <span class="n">FOR</span> <span class="n">EACH</span> <span class="n">ROW</span> <span class="n">SET</span> <span class="n">NEW</span><span class="p">.</span><span class="n">vend_state</span> <span class="o">=</span> <span class="n">Upper</span><span class="p">(</span><span class="n">NEW</span><span class="p">.</span><span class="n">vend_state</span><span class="p">);</span>
</pre></div>


<h2>事务</h2>
<p>基本概念</p>
<div class="codehilite"><pre><span class="n">ACID</span>
<span class="n">A</span><span class="p">,</span><span class="err">原子性，食物是一个原子操作单元，其对数据的修改，要么全执行，要么全不执行</span>
<span class="n">C</span><span class="p">.</span><span class="err">一致性，事务开始和完成的时候，数据必须都保持一致状态（所有相关数据规则和内部数据结构）</span>
<span class="n">I</span><span class="p">.</span><span class="err">隔离性，保证事务不受外部并发操作影响，即事务处理中间过程状态对外不可见</span>
<span class="n">D</span><span class="p">.</span><span class="err">持久性，事务完成后，对数据修改时永久性的，及时出现系统故障也能够保持</span>
</pre></div>


<p>1.事务</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">START</span> <span class="n">TRANSACTION</span>
 <span class="n">DELETE</span> <span class="n">FROM</span> <span class="n">ordertotals</span><span class="p">;</span>
 <span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">ordertotals</span><span class="p">;</span>

<span class="o">&gt;</span><span class="n">ROLLBACK</span>
<span class="err">回退</span>

<span class="o">&gt;</span><span class="n">COMMIT</span>
<span class="err">提交</span>
</pre></div>


<p>2.设立保留点</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SAVEPOINT</span> <span class="n">delete1</span><span class="p">;</span>

<span class="o">&gt;</span><span class="n">ROLLBACK</span> <span class="n">TO</span> <span class="n">delete1</span><span class="p">;</span>
</pre></div>


<h2>导入导出</h2>
<p>1.导入</p>
<p>用文本形式插入数据</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">LOAD</span> <span class="n">DATA</span> <span class="n">LOCAL</span> <span class="n">INFILE</span> <span class="err">&#39;</span><span class="n">d</span><span class="o">:/</span><span class="n">mysql</span><span class="p">.</span><span class="n">txt</span><span class="err">&#39;</span> <span class="n">INTO</span> <span class="n">TABLE</span> <span class="n">mytable</span><span class="p">;</span>
</pre></div>


<p>导入.sql</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">use</span> <span class="n">database</span><span class="p">;</span>
<span class="o">&gt;</span><span class="n">source</span> <span class="n">d</span><span class="o">:/</span><span class="n">mysql</span><span class="p">.</span><span class="n">sql</span>
</pre></div>


<p>从另外一张表往这张表插入</p>
<div class="codehilite"><pre><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">tab1</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">)</span>
<span class="n">SELECT</span> <span class="n">a</span><span class="p">.</span><span class="n">f1</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">f2</span>
<span class="n">FROM</span> <span class="n">a</span> <span class="n">WHERE</span> <span class="n">a</span><span class="p">.</span><span class="n">f1</span><span class="o">=</span><span class="sc">&#39;a&#39;</span>
</pre></div>


<p>2.备份</p>
<p>导出要用到MySQL的mysqldump工具，基本用法是：</p>
<div class="codehilite"><pre><span class="n">mysqldump</span> <span class="p">[</span><span class="n">OPTIONS</span><span class="p">]</span> <span class="n">database</span> <span class="p">[</span><span class="n">tables</span><span class="p">]</span>
</pre></div>


<p>备份MySQL数据库的命令</p>
<div class="codehilite"><pre><span class="n">mysqldump</span> <span class="o">-</span><span class="n">hhostname</span> <span class="o">-</span><span class="n">uusername</span> <span class="o">-</span><span class="n">ppassword</span> <span class="n">databasename</span> <span class="o">&gt;</span> <span class="n">backupfile</span><span class="p">.</span><span class="n">sql</span>
</pre></div>


<p>备份MySQL数据库为带删除表的格式，能够让该备份覆盖已有数据库而不需要手动删除原有数据库。</p>
<div class="codehilite"><pre><span class="n">mysqldump</span> <span class="o">-</span><span class="err">–</span><span class="n">add</span><span class="o">-</span><span class="n">drop</span><span class="o">-</span><span class="n">table</span> <span class="o">-</span><span class="n">uusername</span> <span class="o">-</span><span class="n">ppassword</span> <span class="n">databasename</span> <span class="o">&gt;</span> <span class="n">backupfile</span><span class="p">.</span><span class="n">sql</span>
</pre></div>


<p>直接将MySQL数据库压缩备份</p>
<div class="codehilite"><pre><span class="n">mysqldump</span> <span class="o">-</span><span class="n">hhostname</span> <span class="o">-</span><span class="n">uusername</span> <span class="o">-</span><span class="n">ppassword</span> <span class="n">databasename</span> <span class="o">|</span> <span class="n">gzip</span> <span class="o">&gt;</span> <span class="n">backupfile</span><span class="p">.</span><span class="n">sql</span><span class="p">.</span><span class="n">gz</span>
</pre></div>


<p>备份MySQL数据库某个(些)表</p>
<div class="codehilite"><pre><span class="n">mysqldump</span> <span class="o">-</span><span class="n">hhostname</span> <span class="o">-</span><span class="n">uusername</span> <span class="o">-</span><span class="n">ppassword</span> <span class="n">databasename</span> <span class="n">specific_table1</span> <span class="n">specific_table2</span> <span class="o">&gt;</span> <span class="n">backupfile</span><span class="p">.</span><span class="n">sql</span>
</pre></div>


<p>同时备份多个MySQL数据库</p>
<div class="codehilite"><pre><span class="n">mysqldump</span> <span class="o">-</span><span class="n">hhostname</span> <span class="o">-</span><span class="n">uusername</span> <span class="o">-</span><span class="n">ppassword</span> <span class="err">–</span><span class="n">databases</span> <span class="n">databasename1</span> <span class="n">databasename2</span> <span class="n">databasename3</span> <span class="o">&gt;</span> <span class="n">multibackupfile</span><span class="p">.</span><span class="n">sql</span>
</pre></div>


<p>仅仅备份数据库结构</p>
<div class="codehilite"><pre><span class="n">mysqldump</span> <span class="err">–</span><span class="n">no</span><span class="o">-</span><span class="n">data</span> <span class="err">–</span><span class="n">databases</span> <span class="n">databasename1</span> <span class="n">databasename2</span> <span class="n">databasename3</span> <span class="o">&gt;</span> <span class="n">structurebackupfile</span><span class="p">.</span><span class="n">sql</span>
</pre></div>


<p>备份服务器上所有数据库</p>
<div class="codehilite"><pre><span class="n">mysqldump</span> <span class="err">–</span><span class="n">all</span><span class="o">-</span><span class="n">databases</span> <span class="o">&gt;</span> <span class="n">allbackupfile</span><span class="p">.</span><span class="n">sql</span>
</pre></div>


<p>还原</p>
<p>还原MySQL数据库的命令</p>
<div class="codehilite"><pre><span class="n">mysql</span> <span class="o">-</span><span class="n">hhostname</span> <span class="o">-</span><span class="n">uusername</span> <span class="o">-</span><span class="n">ppassword</span> <span class="n">databasename</span> <span class="o">&lt;</span> <span class="n">backupfile</span><span class="p">.</span><span class="n">sql</span>
<span class="n">mysql</span> <span class="o">-</span><span class="n">hhostname</span> <span class="o">-</span><span class="n">ppassword</span> <span class="n">databasename</span> <span class="n">tablename</span> <span class="o">&lt;</span> <span class="n">backuptablefile</span><span class="p">.</span><span class="n">sql</span>
</pre></div>


<p>还原压缩的MySQL数据库</p>
<div class="codehilite"><pre><span class="n">gunzip</span> <span class="o">&lt;</span> <span class="n">backupfile</span><span class="p">.</span><span class="n">sql</span><span class="p">.</span><span class="n">gz</span> <span class="o">|</span> <span class="n">mysql</span> <span class="o">-</span><span class="n">uusername</span> <span class="o">-</span><span class="n">ppassword</span> <span class="n">databasename</span>
</pre></div>


<p>将数据库转移到新服务器</p>
<div class="codehilite"><pre><span class="n">mysqldump</span> <span class="o">-</span><span class="n">uusername</span> <span class="o">-</span><span class="n">ppassword</span> <span class="n">databasename</span> <span class="o">|</span> <span class="n">mysql</span> <span class="err">–</span><span class="n">host</span><span class="o">=*</span><span class="p">.</span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="p">.</span><span class="o">*</span> <span class="o">-</span><span class="n">C</span> <span class="n">databasename</span>
</pre></div>


<p>将查询结果导入外部文件</p>
<div class="codehilite"><pre><span class="n">SELECT</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">a</span><span class="o">+</span><span class="n">b</span> 
<span class="n">FROM</span> <span class="n">test_table</span>
<span class="n">INTO</span> <span class="n">OUTFILE</span> <span class="err">&#39;</span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">result</span><span class="p">.</span><span class="n">txt</span><span class="err">&#39;</span>
<span class="n">FIELDS</span> <span class="n">TERMINATED</span> <span class="n">BY</span> <span class="sc">&#39;,&#39;</span> <span class="n">OPTIONALLY</span> <span class="n">ENCLOSED</span> <span class="n">BY</span> <span class="sc">&#39;&quot;&#39;</span>
<span class="n">LINES</span> <span class="n">TERMINATED</span> <span class="n">BY</span> <span class="sc">&#39;\n&#39;</span>

<span class="err">或者</span>

<span class="n">mysql</span> <span class="o">-</span><span class="n">u</span> <span class="n">you</span> <span class="o">-</span><span class="n">p</span> <span class="o">-</span><span class="n">e</span> <span class="s">&quot;SELECT ...&quot;</span> <span class="o">&gt;</span>  <span class="n">file_name</span>
</pre></div>


<h2>性能研究</h2>
<div class="codehilite"><pre><span class="mf">1.</span><span class="err">什么情况下无法使用索引？</span>
</pre></div>


<h2>实时监控</h2>
<p>查看mysql数据库的当前连接数</p>
<div class="codehilite"><pre><span class="err">命令：</span> <span class="n">show</span> <span class="n">processlist</span><span class="p">;</span>
<span class="err">或者</span> <span class="err">#</span> <span class="n">mysqladmin</span> <span class="o">-</span><span class="n">uroot</span> <span class="o">-</span><span class="n">p</span><span class="err">密码</span> <span class="n">processlist</span>
</pre></div>


<p>当前状态</p>
<div class="codehilite"><pre><span class="err">命令：</span> <span class="n">show</span> <span class="n">status</span><span class="p">;</span>
<span class="err">或者</span> <span class="err">#</span> <span class="n">mysqladmin</span> <span class="o">-</span><span class="n">uroot</span> <span class="o">-</span><span class="n">p</span><span class="err">密码</span> <span class="n">status</span>
</pre></div>
    </section>

    <section id="copyright">
        <div class="copyright">
            版权声明：自由转载-非商用-非衍生-保持署名 | <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank" >Creative Commons BY-NC-ND 3.0</a>
        </div>
    </section>

    <section id="comments">

        <div class="comments">
            <h2>Comments !</h2>
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_identifier = "/posts/2013/08/11/mysql-base.html";
                (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://wklken.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            </div>
    </section>

</article>
        </section><!--end #main-->

            <footer class="row">
                <div class="large-12 columns">
                    <p>
                            Copyright © 2014 wklken <br>
                            Powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Social Icons by <a href="http://fortawesome.github.io/Font-Awesome/">Font-Awesome</a>.
                    </p>
                </div>
            </footer>

            </div>
        </div>

        <section id="extras" class="body">
        </section><!-- /#extras -->

    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-42275748-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>


<script src="http://upcdn.b0.upaiyun.com/libs/jquery/jquery-1.9.1.min.js"></script>

<!--
<script src="/theme/js/instantclick.min.js" data-no-instant></script>
<script data-no-instant>InstantClick.init(50);</script>
-->


</body>
</html>