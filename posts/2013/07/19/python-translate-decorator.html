<!DOCTYPE html>
<html lang="en">

<!--[if IE 8]> <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

<head>
    <meta name="google-site-verification" content="SzE6WCs23qFevgBzRIuG9vcfLU0lW_Vd5hFT-cJOLBE" />
    <title>[翻译]理解python中的装饰器</title>
    <meta charset="utf-8" />
    <meta name="description" content="">
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

        <link rel="shortcut icon" href="/favicon.ico"/>
        <link rel="stylesheet" href="/theme/css/styles.css" media="all" />
        <link rel="stylesheet" href="/theme/css/tab.min.css" media="all" />
        <link rel="stylesheet" href="/theme/css/jquery-ui.min.css" media="all" />

        <link rel="stylesheet" href="/theme/css/font-awesome.min.css">
        <!--
        <link rel="stylesheet" href="http://apps.bdimg.com/libs/fontawesome/4.2.0/css/font-awesome.min.css">
        -->
        <!--[if IE 7]>
            <link rel="stylesheet" href="/theme/css/font-awesome-ie7.min.css">
        <![endif]-->

        <link href="/" type="application/atom+xml" rel="alternate" title="wklken's blog ATOM Feed" />
        <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="wklken's blog RSS Feed" />

</head>

<body id="index" class="home">
    <div id="page" class="row">
        <div class="large-8 large-centered columns">

        <header id="header">
            <div class="constraint">
                <div class="o">
                    <a href="/"><h1 class="banner">Wklken <span class="blue"> Building </span></h1></a>

                <div class="social">
                            <a href="https://github.com/wklken" target='_blank'><i class="icon-github-sign icon-2x"></i></a>
                            <a href="http://weibo.com/wklken" target='_blank'><i class="icon-weibo icon-2x"></i></a>
                            <a href="mailto:wklken@yeah.net"><i class="icon-envelope icon-2x"></i></a>
                            <a href="http://www.wklken.me/feed.xml" target='_blank'><i class="icon-rss-sign icon-2x"></i></a>
                </div>
                <div class="nav">
                            <a href="/">首页</a>
                            <a href="/categories.html">分类</a>
                            <a href="/archives.html">归档</a>
                            <a href="/pages/projects.html">项目</a>
                            <a href="/pages/aboutme.html">关于</a>

                </div>

                </div>
            </div>
        </header><!-- /#banner -->

        <section id="main">


<article id="article">
    <section id="header">
        <!--
        <div class="meta">2013年07月19日</div>
        <h1 id="title"> [翻译]理解python中的装饰器 </h1>
        -->
        <div class="meta"> &nbsp; </div>
        <h1> [翻译]理解python中的装饰器 </h1>
    </section>

        <section id="toc">
            <html><body><div id="toc"><ul><li><a class="toc-href" href="#" title="[翻译]理解python中的装饰器">[翻译]理解python中的装饰器</a><ul><li><a class="toc-href" href="#python" title="python的函数是对象">python的函数是对象</a></li><li><a class="toc-href" href="#_1" title="函数引用">函数引用</a></li><li><a class="toc-href" href="#_2" title="手工装饰器">手工装饰器</a></li><li><a class="toc-href" href="#_3" title="装饰器阐述">装饰器阐述</a></li><li><a class="toc-href" href="#_4" title="最后回答问题">最后回答问题</a><ul><li><a class="toc-href" href="#_5" title="向装饰器函数传递参数">向装饰器函数传递参数</a></li><li><a class="toc-href" href="#_6" title="装饰方法">装饰方法</a></li><li><a class="toc-href" href="#_7" title="向装饰器传递参数">向装饰器传递参数</a></li><li><a class="toc-href" href="#_8" title="练习：一个装饰装饰器的装饰器">练习：一个装饰装饰器的装饰器</a></li></ul></li><li><a class="toc-href" href="#_10" title="装饰器使用最佳实践">装饰器使用最佳实践</a><ul><li><a class="toc-href" href="#_11" title="装饰器为何那么有用">装饰器为何那么有用</a></li></ul></li></ul></li></ul></div></body></html>
        </section>
    <section id="content">
        <p>有人翻译过了，很多转载，暂时没找到原文，各个地方的排版不一样，排版（代码格式），代码注解等都不怎么好</p>
<p>练练手，顺手一翻吧，权当加深理解</p>
<p>来源stackoverflow上的问题  <a href="http://stackoverflow.com/questions/739654/how-can-i-make-a-chain-of-function-decorators-in-python/1594484#1594484">链接</a></p>
<p>很长哦(应该是巨长...分了三次搞完)，要有耐心看完</p>
<hr/>
<h2 id="python">python的函数是对象</h2>
<p>要理解装饰器，首先，你必须明白，在python中，函数是对象. 这很重要.</p>
<p>简单例子来理解为什么</p>
<div class="codehilite"><pre>def shout(word="yes"):
    return word.capitalize()+"!"

print shout()
# outputs : 'Yes!'

# 作为一个对象，你可以讲函数赋值给另一个对象
scream = shout

# 注意到这里我们并没有使用括号：我们不是调用函数，而是将函数'shout'赋给变量'scream'
# 这意味着，你可以通过'scream'调用'shout'

print scream()
# outputs : 'Yes!'

# 不仅如此，你可以删除老的名称'shout'，但是通过'scream'依旧可以访问原有函数

del shout
try:
    print shout()
except NameError, e:
    print e
    #outputs: "name 'shout' is not defined"

print scream()
# outputs: 'Yes!'
</pre></div>
<p>好了，记住这点，我们将会很快用到它.</p>
<p>Python函数另一个有趣的特性是，函数可以被定义在另一个函数里面</p>
<div class="codehilite"><pre>def talk():
    # 你可以定义一个函数
    def whisper(word="yes"):
        return word.lower()+"..."

    # ... 并且立刻调用
    print whisper()

# 每次当你调用"talk", 都会定义"whisper"
# 并且在"talk"中被调用
talk()
# outputs:
# "yes..."

#但是在"talk"外部，函数"whisper"不存在！
try:
    print whisper()
except NameError, e:
    print e
    #outputs : "name 'whisper' is not defined"*
</pre></div>
<h2 id="_1">函数引用</h2>
<p>好了，到这里了，接下来是有意思的部分，我们刚才看到 函数是对象，然后:</p>
<p>1.函数可以赋值给一个变量</p>
<p>2.函数可以定义在另一个函数内部</p>
<p>即，这也意味着一个函数可以返回另一个函数:-）,让我们来看另一段代码</p>
<div class="codehilite"><pre><span class="nx">def</span> <span class="nx">getTalk</span><span class="p">(</span><span class="nx">type</span><span class="o">=</span><span class="s2">"shout"</span><span class="p">)</span><span class="o">:</span>

    <span class="err">#</span> <span class="nx">定义函数</span>
    <span class="nx">def</span> <span class="nx">shout</span><span class="p">(</span><span class="nx">word</span><span class="o">=</span><span class="s2">"yes"</span><span class="p">)</span><span class="o">:</span>
        <span class="k">return</span> <span class="nx">word</span><span class="p">.</span><span class="nx">capitalize</span><span class="p">()</span><span class="o">+</span><span class="s2">"!"</span>

    <span class="nx">def</span> <span class="nx">whisper</span><span class="p">(</span><span class="nx">word</span><span class="o">=</span><span class="s2">"yes"</span><span class="p">)</span> <span class="o">:</span>
        <span class="k">return</span> <span class="nx">word</span><span class="p">.</span><span class="nx">lower</span><span class="p">()</span><span class="o">+</span><span class="s2">"..."</span><span class="p">;</span>

    <span class="err">#</span> <span class="nx">返回函数</span>
    <span class="k">if</span> <span class="nx">type</span> <span class="o">==</span> <span class="s2">"shout"</span><span class="o">:</span>
        <span class="err">#</span> <span class="nx">没有使用</span><span class="s2">"()"</span><span class="p">,</span> <span class="nx">并不是要调用函数</span><span class="err">，</span><span class="nx">而是要返回函数对象</span>
        <span class="k">return</span> <span class="nx">shout</span>
    <span class="k">else</span><span class="o">:</span>
        <span class="k">return</span> <span class="nx">whisper</span>

<span class="err">#</span> <span class="nx">如何使用</span><span class="err">？</span>

<span class="err">#</span> <span class="nx">将函数返回值赋值给一个变量</span>
<span class="nx">talk</span> <span class="o">=</span> <span class="nx">getTalk</span><span class="p">()</span>

<span class="err">#</span> <span class="nx">我们可以打印下这个函数对象</span>
<span class="nx">print</span> <span class="nx">talk</span>
<span class="err">#</span><span class="nx">outputs</span> <span class="o">:</span> <span class="o">&lt;</span><span class="kd">function</span> <span class="nx">shout</span> <span class="nx">at</span> <span class="mh">0xb7ea817c</span><span class="o">&gt;</span>

<span class="err">#</span> <span class="nx">这个对象是函数的返回值</span>
<span class="nx">print</span> <span class="nx">talk</span><span class="p">()</span>
<span class="err">#</span><span class="nx">outputs</span> <span class="o">:</span> <span class="nx">Yes</span><span class="o">!</span>

<span class="err">#</span> <span class="nx">不仅如此</span><span class="err">，</span><span class="nx">你还可以直接使用之</span>
<span class="nx">print</span> <span class="nx">getTalk</span><span class="p">(</span><span class="s2">"whisper"</span><span class="p">)()</span>
<span class="err">#</span><span class="nx">outputs</span> <span class="o">:</span> <span class="nx">yes</span><span class="p">...</span>
</pre></div>
<p>但是稍等，如果你可以返回一个函数，那么你也可以将函数作为参数传递</p>
<div class="codehilite"><pre><span class="nx">def</span> <span class="nx">doSomethingBefore</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">print</span> <span class="s2">"I do something before then I call the function you gave me"</span>
    <span class="nx">print</span> <span class="nx">func</span><span class="p">()</span>

<span class="nx">doSomethingBefore</span><span class="p">(</span><span class="nx">scream</span><span class="p">)</span>
<span class="err">#</span><span class="nx">outputs</span><span class="o">:</span>
<span class="err">#</span><span class="nx">I</span> <span class="k">do</span> <span class="nx">something</span> <span class="nx">before</span> <span class="nx">then</span> <span class="nx">I</span> <span class="nx">call</span> <span class="nx">the</span> <span class="kd">function</span> <span class="nx">you</span> <span class="nx">gave</span> <span class="nx">me</span>
<span class="err">#</span><span class="nx">Yes</span><span class="o">!</span>
</pre></div>
<p>好了，现在你已经了解要理解装饰器的每件事.</p>
<p>装饰器就是封装器，可以让你在被装饰函数之前或之后执行代码，而不必修改函数本身</p>
<h2 id="_2">手工装饰器</h2>
<p>如何书写一个装饰器</p>
<div class="codehilite"><pre><span class="err">#</span> <span class="nx">装饰器是一个以另一个函数为参数的函数</span>
<span class="nx">def</span> <span class="nx">my_shiny_new_decorator</span><span class="p">(</span><span class="nx">a_function_to_decorate</span><span class="p">)</span><span class="o">:</span>

    <span class="err">#</span> <span class="nx">在这里</span><span class="err">，</span><span class="nx">装饰器定义一个函数</span><span class="err">：</span> <span class="nx">包装器</span><span class="p">.</span>
    <span class="err">#</span> <span class="nx">这个函数将原始函数进行包装</span><span class="err">，</span><span class="nx">以达到在原始函数之前</span><span class="err">、</span><span class="nx">之后执行代码的目的</span>
    <span class="nx">def</span> <span class="nx">the_wrapper_around_the_original_function</span><span class="p">()</span><span class="o">:</span>

        <span class="err">#</span> <span class="nx">将你要在原始函数之前执行的代码放到这里</span>
        <span class="nx">print</span> <span class="s2">"Before the function runs"</span>

        <span class="err">#</span> <span class="nx">调用原始函数</span><span class="p">(</span><span class="nx">需要带括号</span><span class="p">)</span>
        <span class="nx">a_function_to_decorate</span><span class="p">()</span>

        <span class="err">#</span> <span class="nx">将你要在原始函数之后执行的代码放到这里</span>
        <span class="nx">print</span> <span class="s2">"After the function runs"</span>

    <span class="err">#</span> <span class="nx">代码到这里</span><span class="err">，</span><span class="nx">函数</span><span class="err">&lsquo;</span><span class="nx">a_function_to_decorate</span><span class="err">&rsquo;</span><span class="nx">还没有被执行</span>
    <span class="err">#</span> <span class="nx">我们将返回刚才创建的这个包装函数</span>
    <span class="err">#</span> <span class="nx">这个函数包含原始函数及要执行的附加代码</span><span class="err">，</span><span class="nx">并且可以被使用</span>
    <span class="k">return</span> <span class="nx">the_wrapper_around_the_original_function</span>

<span class="err">#</span> <span class="nx">创建一个函数</span>
<span class="nx">def</span> <span class="nx">a_stand_alone_function</span><span class="p">()</span><span class="o">:</span>
    <span class="nx">print</span> <span class="s2">"I am a stand alone function, don't you dare modify me"</span>

<span class="nx">a_stand_alone_function</span><span class="p">()</span>
<span class="err">#</span><span class="nx">outputs</span><span class="o">:</span> <span class="nx">I</span> <span class="nx">am</span> <span class="nx">a</span> <span class="nx">stand</span> <span class="nx">alone</span> <span class="kd">function</span><span class="p">,</span> <span class="nx">don</span><span class="s1">'t you dare modify me</span>

<span class="s1"># 好了，在这里你可以装饰这个函数，扩展其行为</span>
<span class="s1"># 将函数传递给装饰器，装饰器将动态地将其包装在任何你想执行的代码中，然后返回一个新的函数</span>
<span class="s1">a_stand_alone_function_decorated = my_shiny_new_decorator(a_stand_alone_function)</span>

<span class="s1"># 调用新函数，可以看到装饰器的效果</span>
<span class="s1">a_stand_alone_function_decorated()</span>
<span class="s1">#outputs:</span>
<span class="s1">#Before the function runs</span>
<span class="s1">#I am a stand alone function, don'</span><span class="nx">t</span> <span class="nx">you</span> <span class="nx">dare</span> <span class="nx">modify</span> <span class="nx">me</span>
<span class="err">#</span><span class="nx">After</span> <span class="nx">the</span> <span class="kd">function</span> <span class="nx">runs</span>
</pre></div>
<p>到这里，或许你想每次调用a_stand_alone_function都使用a_stand_alone_function_decorated替代之
很简单，只需要将a_stand_alone_function用my_shiny_new_decorator装饰返回</p>
<div class="codehilite"><pre><span class="nx">a_stand_alone_function</span> <span class="o">=</span> <span class="nx">my_shiny_new_decorator</span><span class="p">(</span><span class="nx">a_stand_alone_function</span><span class="p">)</span>
<span class="nx">a_stand_alone_function</span><span class="p">()</span>
<span class="err">#</span><span class="nx">outputs</span><span class="o">:</span>
<span class="err">#</span><span class="nx">Before</span> <span class="nx">the</span> <span class="kd">function</span> <span class="nx">runs</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">am</span> <span class="nx">a</span> <span class="nx">stand</span> <span class="nx">alone</span> <span class="kd">function</span><span class="p">,</span> <span class="nx">don</span><span class="err">'</span><span class="nx">t</span> <span class="nx">you</span> <span class="nx">dare</span> <span class="nx">modify</span> <span class="nx">me</span>
<span class="err">#</span><span class="nx">After</span> <span class="nx">the</span> <span class="kd">function</span> <span class="nx">runs</span>

<span class="err">#</span> <span class="nx">这就是装饰器做的事情</span><span class="o">!</span>
</pre></div>
<h2 id="_3">装饰器阐述</h2>
<p>前面的例子，使用装饰器语法</p>
<div class="codehilite"><pre><span class="err">@</span><span class="nx">my_shiny_new_decorator</span>
<span class="nx">def</span> <span class="nx">another_stand_alone_function</span><span class="p">()</span><span class="o">:</span>
    <span class="nx">print</span> <span class="s2">"Leave me alone"</span>

<span class="nx">another_stand_alone_function</span><span class="p">()</span>
<span class="err">#</span><span class="nx">outputs</span><span class="o">:</span>
<span class="err">#</span><span class="nx">Before</span> <span class="nx">the</span> <span class="kd">function</span> <span class="nx">runs</span>
<span class="err">#</span><span class="nx">Leave</span> <span class="nx">me</span> <span class="nx">alone</span>
<span class="err">#</span><span class="nx">After</span> <span class="nx">the</span> <span class="kd">function</span> <span class="nx">runs</span>
</pre></div>
<p>是的，就是这么简单. @decorator是下面代码的简写</p>
<div class="codehilite"><pre><span class="nx">nother_stand_alone_function</span> <span class="o">=</span> <span class="nx">my_shiny_new_decorator</span><span class="p">(</span><span class="nx">another_stand_alone_function</span><span class="p">)</span>
</pre></div>
<p>装饰器只是 <a href="http://en.wikipedia.org/wiki/Decorator_pattern">装饰器模式</a>的python实现</p>
<p>python代码中还存在其他几个经典的设计模式，以方便开发，例如迭代器iterators</p>
<p>当然，你可以累加装饰器</p>
<div class="codehilite"><pre>def bread(func):
    def wrapper():
        print "<span class="err">&lt;</span>/''''''\&gt;"
        func()
        print "<span class="err">&lt;</span>\______/&gt;"
    return wrapper

def ingredients(func):
    def wrapper():
        print "#tomatoes#"
        func()
        print "~salad~"
    return wrapper

def sandwich(food="--ham--"):
    print food

sandwich()
#outputs: --ham--

#累加两个装饰器
sandwich = bread(ingredients(sandwich))
sandwich()
#outputs:
#<span class="err">&lt;</span>/''''''\&gt;
# #tomatoes#
# --ham--
# ~salad~
#<span class="err">&lt;</span>\______/&gt;
</pre></div>
<p>使用python装饰器语法</p>
<div class="codehilite"><pre>@bread
@ingredients
def sandwich(food="--ham--"):
    print food

sandwich()
#outputs:
#&lt;/''''''\&gt;
# #tomatoes#
# --ham--
# ~salad~
#&lt;\______/&gt;
</pre></div>
<p>装饰器位置的顺序很重要</p>
<div class="codehilite"><pre>@ingredients
@bread
def strange_sandwich(food="--ham--"):
    print food

    strange_sandwich()
#outputs:
##tomatoes#
#&lt;/''''\&gt;
# --ham--
#&lt;\______/&gt;
# ~salad~'
</pre></div>
<h2 id="_4">最后回答问题</h2>
<div class="codehilite"><pre># bold装饰器
def makebold(fn):
    def wrapper():
        # 在前后加入标签
        return "<span class="nt">&lt;b&gt;</span>" + fn() + "<span class="nt">&lt;/b&gt;</span>"
    return wrapper

# italic装饰器
def makeitalic(fn):
    def wrapper():
        # 加入标签
        return "<span class="nt">&lt;i&gt;</span>" + fn() + "<span class="nt">&lt;/i&gt;</span>"
    return wrapper

@makebold
@makeitalic
def say():
    return "hello"

print say()
#outputs: <span class="nt">&lt;b&gt;&lt;i&gt;</span>hello<span class="nt">&lt;/i&gt;&lt;/b&gt;</span>

# 等价的代码
def say():
    return "hello"
say = makebold(makeitalic(say))

print say()
#outputs: <span class="nt">&lt;b&gt;&lt;i&gt;</span>hello<span class="nt">&lt;/i&gt;&lt;/b&gt;</span>
</pre></div>
<p>好了，到这里你可以高兴地离开了，或者来看下一些装饰器高级的用法</p>
<h3 id="_5">向装饰器函数传递参数</h3>
<div class="codehilite"><pre><span class="err">#</span> <span class="nx">这不是黑魔法</span><span class="err">，</span><span class="nx">你只需要让包装传递参数</span><span class="o">:</span>

<span class="nx">def</span> <span class="nx">a_decorator_passing_arguments</span><span class="p">(</span><span class="nx">function_to_decorate</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">def</span> <span class="nx">a_wrapper_accepting_arguments</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">)</span><span class="o">:</span>
            <span class="nx">print</span> <span class="s2">"I got args! Look:"</span><span class="p">,</span> <span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span>
            <span class="nx">function_to_decorate</span><span class="p">(</span><span class="nx">arg1</span><span class="p">,</span> <span class="nx">arg2</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">a_wrapper_accepting_arguments</span>

<span class="err">#</span> <span class="nx">当你调用装饰器返回的函数</span><span class="err">，</span><span class="nx">实际上是调用包装函数</span><span class="err">，</span><span class="nx">所以给包装函数传递参数即可将参数传给装饰器函数</span>

<span class="err">@</span><span class="nx">a_decorator_passing_arguments</span>
<span class="nx">def</span> <span class="nx">print_full_name</span><span class="p">(</span><span class="nx">first_name</span><span class="p">,</span> <span class="nx">last_name</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">print</span> <span class="s2">"My name is"</span><span class="p">,</span> <span class="nx">first_name</span><span class="p">,</span> <span class="nx">last_name</span>

<span class="nx">print_full_name</span><span class="p">(</span><span class="s2">"Peter"</span><span class="p">,</span> <span class="s2">"Venkman"</span><span class="p">)</span>
<span class="err">#</span> <span class="nx">outputs</span><span class="o">:</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">got</span> <span class="nx">args</span><span class="o">!</span> <span class="nx">Look</span><span class="o">:</span> <span class="nx">Peter</span> <span class="nx">Venkman</span>
<span class="err">#</span><span class="nx">My</span> <span class="nx">name</span> <span class="nx">is</span> <span class="nx">Peter</span> <span class="nx">Venkman</span>
</pre></div>
<h3 id="_6">装饰方法</h3>
<p>Python中对象的方法和函数是一样的，除了对象的方法首个参数是指向当前对象的引用(self)。这意味着你可以用同样的方法构建一个装饰器，只是必须考虑self</p>
<div class="codehilite"><pre><span class="s-Atom">def</span> <span class="nf">method_friendly_decorator</span><span class="p">(</span><span class="s-Atom">method_to_decorate</span><span class="p">)</span><span class="s-Atom">:</span>
    <span class="s-Atom">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="s-Atom">self</span><span class="p">,</span> <span class="s-Atom">lie</span><span class="p">)</span><span class="s-Atom">:</span>
        <span class="s-Atom">lie</span> <span class="o">=</span> <span class="s-Atom">lie</span> <span class="o">-</span> <span class="mi">3</span> <span class="s-Atom">#</span> <span class="s-Atom">very</span> <span class="s-Atom">friendly</span><span class="p">,</span> <span class="s-Atom">decrease</span> <span class="s-Atom">age</span> <span class="s-Atom">even</span> <span class="nf">more</span> <span class="o">:-</span><span class="p">)</span>
        <span class="s-Atom">return</span> <span class="nf">method_to_decorate</span><span class="p">(</span><span class="s-Atom">self</span><span class="p">,</span> <span class="s-Atom">lie</span><span class="p">)</span>
    <span class="s-Atom">return</span> <span class="s-Atom">wrapper</span>

<span class="s-Atom">class</span> <span class="nv">Lucy</span><span class="p">(</span><span class="s-Atom">object</span><span class="p">)</span><span class="s-Atom">:</span>

    <span class="s-Atom">def</span> <span class="k">__</span><span class="nf">init__</span><span class="p">(</span><span class="s-Atom">self</span><span class="p">)</span><span class="s-Atom">:</span>
        <span class="s-Atom">self</span><span class="p">.</span><span class="s-Atom">age</span> <span class="o">=</span> <span class="mi">32</span>

    <span class="s-Atom">@method_friendly_decorator</span>
    <span class="s-Atom">def</span> <span class="nf">sayYourAge</span><span class="p">(</span><span class="s-Atom">self</span><span class="p">,</span> <span class="s-Atom">lie</span><span class="p">)</span><span class="s-Atom">:</span>
        <span class="s-Atom">print</span> <span class="s2">"I am %s, what did you think?"</span> <span class="c1">% (self.age + lie)</span>

<span class="s-Atom">l</span> <span class="o">=</span> <span class="nv">Lucy</span><span class="p">()</span>
<span class="s-Atom">l</span><span class="p">.</span><span class="nf">sayYourAge</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
<span class="c1">#outputs: I am 26, what did you think?</span>
</pre></div>
<p>当然，你可以构造一个更加通用的装饰器，可以作用在任何函数或对象方法上，而不必关系其参数
使用</p>
<div class="codehilite"><pre>*args, **kwargs
</pre></div>
<p>如下代码</p>
<div class="codehilite"><pre><span class="nx">def</span> <span class="nx">a_decorator_passing_arbitrary_arguments</span><span class="p">(</span><span class="nx">function_to_decorate</span><span class="p">)</span><span class="o">:</span>
    <span class="err">#</span> <span class="nx">包装函数可以接受任何参数</span>
    <span class="nx">def</span> <span class="nx">a_wrapper_accepting_arbitrary_arguments</span><span class="p">(</span><span class="o">*</span><span class="nx">args</span><span class="p">,</span> <span class="o">**</span><span class="nx">kwargs</span><span class="p">)</span><span class="o">:</span>
        <span class="nx">print</span> <span class="s2">"Do I have args?:"</span>
        <span class="nx">print</span> <span class="nx">args</span>
        <span class="nx">print</span> <span class="nx">kwargs</span>
        <span class="err">#</span> <span class="nx">然后你可以解开参数</span><span class="err">，</span> <span class="o">*</span><span class="nx">args</span><span class="err">，</span><span class="o">**</span><span class="nx">kwargs</span>
        <span class="err">#</span> <span class="nx">如果你对此不是很熟悉</span><span class="err">，</span><span class="nx">可以参考</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//www.saltycrane.com/blog/2008/01/how-to-use-args-and-kwargs-in-python/</span>
        <span class="nx">function_to_decorate</span><span class="p">(</span><span class="o">*</span><span class="nx">args</span><span class="p">,</span> <span class="o">**</span><span class="nx">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">a_wrapper_accepting_arbitrary_arguments</span>

<span class="err">@</span><span class="nx">a_decorator_passing_arbitrary_arguments</span>
<span class="nx">def</span> <span class="nx">function_with_no_argument</span><span class="p">()</span><span class="o">:</span>
    <span class="nx">print</span> <span class="s2">"Python is cool, no argument here."</span>

<span class="nx">function_with_no_argument</span><span class="p">()</span>
<span class="err">#</span><span class="nx">outputs</span>
<span class="err">#</span><span class="nx">Do</span> <span class="nx">I</span> <span class="nx">have</span> <span class="nx">args</span><span class="o">?:</span>
<span class="err">#</span><span class="p">()</span>
<span class="err">#</span><span class="p">{}</span>
<span class="err">#</span><span class="nx">Python</span> <span class="nx">is</span> <span class="nx">cool</span><span class="p">,</span> <span class="nx">no</span> <span class="nx">argument</span> <span class="nx">here</span><span class="p">.</span>

<span class="err">@</span><span class="nx">a_decorator_passing_arbitrary_arguments</span>
<span class="nx">def</span> <span class="nx">function_with_arguments</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">print</span> <span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span>

<span class="nx">function_with_arguments</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="err">#</span><span class="nx">outputs</span>
<span class="err">#</span><span class="nx">Do</span> <span class="nx">I</span> <span class="nx">have</span> <span class="nx">args</span><span class="o">?:</span>
<span class="err">#</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="err">#</span><span class="p">{}</span>
<span class="err">#</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span>

<span class="err">@</span><span class="nx">a_decorator_passing_arbitrary_arguments</span>
<span class="nx">def</span> <span class="nx">function_with_named_arguments</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">platypus</span><span class="o">=</span><span class="s2">"Why not ?"</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">print</span> <span class="s2">"Do %s, %s and %s like platypus? %s"</span> <span class="o">%\</span>
    <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">,</span> <span class="nx">c</span><span class="p">,</span> <span class="nx">platypus</span><span class="p">)</span>

<span class="nx">function_with_named_arguments</span><span class="p">(</span><span class="s2">"Bill"</span><span class="p">,</span> <span class="s2">"Linus"</span><span class="p">,</span> <span class="s2">"Steve"</span><span class="p">,</span> <span class="nx">platypus</span><span class="o">=</span><span class="s2">"Indeed!"</span><span class="p">)</span>
<span class="err">#</span><span class="nx">outputs</span>
<span class="err">#</span><span class="nx">Do</span> <span class="nx">I</span> <span class="nx">have</span> <span class="nx">args</span> <span class="o">?</span> <span class="o">:</span>
<span class="err">#</span><span class="p">(</span><span class="s1">'Bill'</span><span class="p">,</span> <span class="s1">'Linus'</span><span class="p">,</span> <span class="s1">'Steve'</span><span class="p">)</span>
<span class="err">#</span><span class="p">{</span><span class="s1">'platypus'</span><span class="o">:</span> <span class="s1">'Indeed!'</span><span class="p">}</span>
<span class="err">#</span><span class="nx">Do</span> <span class="nx">Bill</span><span class="p">,</span> <span class="nx">Linus</span> <span class="nx">and</span> <span class="nx">Steve</span> <span class="nx">like</span> <span class="nx">platypus</span><span class="o">?</span> <span class="nx">Indeed</span><span class="o">!</span>

<span class="kr">class</span> <span class="nx">Mary</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">def</span> <span class="nx">__init__</span><span class="p">(</span><span class="nx">self</span><span class="p">)</span><span class="o">:</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="mi">31</span>

    <span class="err">@</span><span class="nx">a_decorator_passing_arbitrary_arguments</span>
    <span class="nx">def</span> <span class="nx">sayYourAge</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">lie</span><span class="o">=-</span><span class="mi">3</span><span class="p">)</span><span class="o">:</span> <span class="err">#</span> <span class="nx">You</span> <span class="nx">can</span> <span class="nx">now</span> <span class="nx">add</span> <span class="nx">a</span> <span class="k">default</span> <span class="nx">value</span>
        <span class="nx">print</span> <span class="s2">"I am %s, what did you think ?"</span> <span class="o">%</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">age</span> <span class="o">+</span> <span class="nx">lie</span><span class="p">)</span>

<span class="nx">m</span> <span class="o">=</span> <span class="nx">Mary</span><span class="p">()</span>
<span class="nx">m</span><span class="p">.</span><span class="nx">sayYourAge</span><span class="p">()</span>
<span class="err">#</span><span class="nx">outputs</span>
<span class="err">#</span> <span class="nx">Do</span> <span class="nx">I</span> <span class="nx">have</span> <span class="nx">args</span><span class="o">?:</span>
<span class="err">#</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">__main__</span><span class="p">.</span><span class="nx">Mary</span> <span class="nx">object</span> <span class="nx">at</span> <span class="mh">0xb7d303ac</span><span class="o">&gt;</span><span class="p">,)</span>
<span class="err">#</span><span class="p">{}</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">am</span> <span class="mi">28</span><span class="p">,</span> <span class="nx">what</span> <span class="nx">did</span> <span class="nx">you</span> <span class="nx">think</span><span class="o">?</span>
</pre></div>
<h3 id="_7">向装饰器传递参数</h3>
<p>好了，现在你或许会想是否可以向装饰器本身传递参数</p>
<p>装饰器必须使用函数作为参数，所以这看起来会有些复杂，你不能直接传递参数给装饰器本身</p>
<p>在开始处理这个问题前，看一点提醒</p>
<div class="codehilite"><pre><span class="err">#</span> <span class="nx">装饰器是普通的方法</span>
<span class="nx">def</span> <span class="nx">my_decorator</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">print</span> <span class="s2">"I am a ordinary function"</span>
    <span class="nx">def</span> <span class="nx">wrapper</span><span class="p">()</span><span class="o">:</span>
        <span class="nx">print</span> <span class="s2">"I am function returned by the decorator"</span>
        <span class="nx">func</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">wrapper</span>

<span class="err">#</span> <span class="nx">所以</span><span class="err">，</span><span class="nx">你可以不通过</span><span class="err">@</span><span class="nx">调用它</span>

<span class="nx">def</span> <span class="nx">lazy_function</span><span class="p">()</span><span class="o">:</span>
    <span class="nx">print</span> <span class="s2">"zzzzzzzz"</span>

<span class="nx">decorated_function</span> <span class="o">=</span> <span class="nx">my_decorator</span><span class="p">(</span><span class="nx">lazy_function</span><span class="p">)</span>
<span class="err">#</span><span class="nx">outputs</span><span class="o">:</span> <span class="nx">I</span> <span class="nx">am</span> <span class="nx">a</span> <span class="nx">ordinary</span> <span class="kd">function</span>

<span class="err">#</span> <span class="nx">It</span> <span class="nx">outputs</span> <span class="s2">"I am a ordinary function"</span><span class="p">,</span> <span class="nx">because</span> <span class="nx">that</span><span class="err">'</span><span class="nx">s</span> <span class="nx">just</span> <span class="nx">what</span> <span class="nx">you</span> <span class="k">do</span><span class="o">:</span>

<span class="err">#</span> <span class="nx">调用一个函数</span><span class="err">，</span><span class="nx">没有什么特别</span>
<span class="err">@</span><span class="nx">my_decorator</span>
<span class="nx">def</span> <span class="nx">lazy_function</span><span class="p">()</span><span class="o">:</span>
    <span class="nx">print</span> <span class="s2">"zzzzzzzz"</span>

<span class="err">#</span><span class="nx">outputs</span><span class="o">:</span> <span class="nx">I</span> <span class="nx">am</span> <span class="nx">a</span> <span class="nx">ordinary</span> <span class="kd">function</span>
</pre></div>
<p>上面两个形式本质上是相同的， "my_decorator" 被调用.所以当你使用"@my_decorator",告诉python一个函数被变量"my_decorator"标记
这十分重要,因为你提供的标签直接指向装饰器...或者不是，继续</p>
<div class="codehilite"><pre><span class="err">#</span> <span class="nx">声明一个用于创建装饰器的函数</span>
<span class="nx">def</span> <span class="nx">decorator_maker</span><span class="p">()</span><span class="o">:</span>

    <span class="nx">print</span> <span class="s2">"I make decorators! I am executed only once: "</span><span class="o">+\</span>
          <span class="s2">"when you make me create a decorator."</span>

    <span class="nx">def</span> <span class="nx">my_decorator</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span><span class="o">:</span>
        <span class="nx">print</span> <span class="s2">"I am a decorator! I am executed only when you decorate a function."</span>

        <span class="nx">def</span> <span class="nx">wrapped</span><span class="p">()</span><span class="o">:</span>
            <span class="nx">print</span> <span class="p">(</span><span class="s2">"I am the wrapper around the decorated function. "</span>
                  <span class="s2">"I am called when you call the decorated function. "</span>
                  <span class="s2">"As the wrapper, I return the RESULT of the decorated function."</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">func</span><span class="p">()</span>

        <span class="nx">print</span> <span class="s2">"As the decorator, I return the wrapped function."</span>
        <span class="k">return</span> <span class="nx">wrapped</span>

    <span class="nx">print</span> <span class="s2">"As a decorator maker, I return a decorator"</span>
    <span class="k">return</span> <span class="nx">my_decorator</span>

<span class="err">#</span> <span class="nx">Let</span><span class="s1">'s create a decorator. It'</span><span class="nx">s</span> <span class="nx">just</span> <span class="nx">a</span> <span class="k">new</span> <span class="kd">function</span> <span class="nx">after</span> <span class="nx">all</span><span class="p">.</span>
<span class="err">#</span> <span class="nx">创建一个装饰器</span><span class="err">，</span><span class="nx">本质上只是一个函数</span>
<span class="nx">new_decorator</span> <span class="o">=</span> <span class="nx">decorator_maker</span><span class="p">()</span>
<span class="err">#</span><span class="nx">outputs</span><span class="o">:</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">make</span> <span class="nx">decorators</span><span class="o">!</span> <span class="nx">I</span> <span class="nx">am</span> <span class="nx">executed</span> <span class="nx">only</span> <span class="nx">once</span><span class="o">:</span> <span class="nx">when</span> <span class="nx">you</span> <span class="nx">make</span> <span class="nx">me</span> <span class="nx">create</span> <span class="nx">a</span> <span class="nx">decorator</span><span class="p">.</span>
<span class="err">#</span><span class="nx">As</span> <span class="nx">a</span> <span class="nx">decorator</span> <span class="nx">maker</span><span class="p">,</span> <span class="nx">I</span> <span class="k">return</span> <span class="nx">a</span> <span class="nx">decorator</span>

<span class="err">#</span> <span class="nx">使用装饰器装饰函数</span>

<span class="nx">def</span> <span class="nx">decorated_function</span><span class="p">()</span><span class="o">:</span>
    <span class="nx">print</span> <span class="s2">"I am the decorated function."</span>

<span class="nx">decorated_function</span> <span class="o">=</span> <span class="nx">new_decorator</span><span class="p">(</span><span class="nx">decorated_function</span><span class="p">)</span>
<span class="err">#</span><span class="nx">outputs</span><span class="o">:</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">am</span> <span class="nx">a</span> <span class="nx">decorator</span><span class="o">!</span> <span class="nx">I</span> <span class="nx">am</span> <span class="nx">executed</span> <span class="nx">only</span> <span class="nx">when</span> <span class="nx">you</span> <span class="nx">decorate</span> <span class="nx">a</span> <span class="kd">function</span><span class="p">.</span>
<span class="err">#</span><span class="nx">As</span> <span class="nx">the</span> <span class="nx">decorator</span><span class="p">,</span> <span class="nx">I</span> <span class="k">return</span> <span class="nx">the</span> <span class="nx">wrapped</span> <span class="kd">function</span>

<span class="err">#</span> <span class="nx">调用被装饰函数</span>
<span class="nx">decorated_function</span><span class="p">()</span>
<span class="err">#</span><span class="nx">outputs</span><span class="o">:</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">am</span> <span class="nx">the</span> <span class="nx">wrapper</span> <span class="nx">around</span> <span class="nx">the</span> <span class="nx">decorated</span> <span class="kd">function</span><span class="p">.</span> <span class="nx">I</span> <span class="nx">am</span> <span class="nx">called</span> <span class="nx">when</span> <span class="nx">you</span> <span class="nx">call</span> <span class="nx">the</span> <span class="nx">decorated</span> <span class="kd">function</span><span class="p">.</span>
<span class="err">#</span><span class="nx">As</span> <span class="nx">the</span> <span class="nx">wrapper</span><span class="p">,</span> <span class="nx">I</span> <span class="k">return</span> <span class="nx">the</span> <span class="nx">RESULT</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">decorated</span> <span class="kd">function</span><span class="p">.</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">am</span> <span class="nx">the</span> <span class="nx">decorated</span> <span class="kd">function</span><span class="p">.</span>
</pre></div>
<p>我们跳过中间变量，做同样的事情</p>
<div class="codehilite"><pre><span class="nx">def</span> <span class="nx">decorated_function</span><span class="p">()</span><span class="o">:</span>
    <span class="nx">print</span> <span class="s2">"I am the decorated function."</span>
<span class="nx">decorated_function</span> <span class="o">=</span> <span class="nx">decorator_maker</span><span class="p">()(</span><span class="nx">decorated_function</span><span class="p">)</span>
<span class="err">#</span><span class="nx">outputs</span><span class="o">:</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">make</span> <span class="nx">decorators</span><span class="o">!</span> <span class="nx">I</span> <span class="nx">am</span> <span class="nx">executed</span> <span class="nx">only</span> <span class="nx">once</span><span class="o">:</span> <span class="nx">when</span> <span class="nx">you</span> <span class="nx">make</span> <span class="nx">me</span> <span class="nx">create</span> <span class="nx">a</span> <span class="nx">decorator</span><span class="p">.</span>
<span class="err">#</span><span class="nx">As</span> <span class="nx">a</span> <span class="nx">decorator</span> <span class="nx">maker</span><span class="p">,</span> <span class="nx">I</span> <span class="k">return</span> <span class="nx">a</span> <span class="nx">decorator</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">am</span> <span class="nx">a</span> <span class="nx">decorator</span><span class="o">!</span> <span class="nx">I</span> <span class="nx">am</span> <span class="nx">executed</span> <span class="nx">only</span> <span class="nx">when</span> <span class="nx">you</span> <span class="nx">decorate</span> <span class="nx">a</span> <span class="kd">function</span><span class="p">.</span>
<span class="err">#</span><span class="nx">As</span> <span class="nx">the</span> <span class="nx">decorator</span><span class="p">,</span> <span class="nx">I</span> <span class="k">return</span> <span class="nx">the</span> <span class="nx">wrapped</span> <span class="kd">function</span><span class="p">.</span>

<span class="err">#</span> <span class="nx">最后</span><span class="o">:</span>
<span class="nx">decorated_function</span><span class="p">()</span>    
<span class="err">#</span><span class="nx">outputs</span><span class="o">:</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">am</span> <span class="nx">the</span> <span class="nx">wrapper</span> <span class="nx">around</span> <span class="nx">the</span> <span class="nx">decorated</span> <span class="kd">function</span><span class="p">.</span> <span class="nx">I</span> <span class="nx">am</span> <span class="nx">called</span> <span class="nx">when</span> <span class="nx">you</span> <span class="nx">call</span> <span class="nx">the</span> <span class="nx">decorated</span> <span class="kd">function</span><span class="p">.</span>
<span class="err">#</span><span class="nx">As</span> <span class="nx">the</span> <span class="nx">wrapper</span><span class="p">,</span> <span class="nx">I</span> <span class="k">return</span> <span class="nx">the</span> <span class="nx">RESULT</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">decorated</span> <span class="kd">function</span><span class="p">.</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">am</span> <span class="nx">the</span> <span class="nx">decorated</span> <span class="kd">function</span><span class="p">.</span>
</pre></div>
<p>使用装饰器语法，更简短</p>
<div class="codehilite"><pre><span class="err">@</span><span class="nx">decorator_maker</span><span class="p">()</span>
<span class="nx">def</span> <span class="nx">decorated_function</span><span class="p">()</span><span class="o">:</span>
    <span class="nx">print</span> <span class="s2">"I am the decorated function."</span>
<span class="err">#</span><span class="nx">outputs</span><span class="o">:</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">make</span> <span class="nx">decorators</span><span class="o">!</span> <span class="nx">I</span> <span class="nx">am</span> <span class="nx">executed</span> <span class="nx">only</span> <span class="nx">once</span><span class="o">:</span> <span class="nx">when</span> <span class="nx">you</span> <span class="nx">make</span> <span class="nx">me</span> <span class="nx">create</span> <span class="nx">a</span> <span class="nx">decorator</span><span class="p">.</span>
<span class="err">#</span><span class="nx">As</span> <span class="nx">a</span> <span class="nx">decorator</span> <span class="nx">maker</span><span class="p">,</span> <span class="nx">I</span> <span class="k">return</span> <span class="nx">a</span> <span class="nx">decorator</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">am</span> <span class="nx">a</span> <span class="nx">decorator</span><span class="o">!</span> <span class="nx">I</span> <span class="nx">am</span> <span class="nx">executed</span> <span class="nx">only</span> <span class="nx">when</span> <span class="nx">you</span> <span class="nx">decorate</span> <span class="nx">a</span> <span class="kd">function</span><span class="p">.</span>
<span class="err">#</span><span class="nx">As</span> <span class="nx">the</span> <span class="nx">decorator</span><span class="p">,</span> <span class="nx">I</span> <span class="k">return</span> <span class="nx">the</span> <span class="nx">wrapped</span> <span class="kd">function</span><span class="p">.</span>

<span class="err">#</span><span class="nx">最终</span><span class="o">:</span> 
<span class="nx">decorated_function</span><span class="p">()</span>    
<span class="err">#</span><span class="nx">outputs</span><span class="o">:</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">am</span> <span class="nx">the</span> <span class="nx">wrapper</span> <span class="nx">around</span> <span class="nx">the</span> <span class="nx">decorated</span> <span class="kd">function</span><span class="p">.</span> <span class="nx">I</span> <span class="nx">am</span> <span class="nx">called</span> <span class="nx">when</span> <span class="nx">you</span> <span class="nx">call</span> <span class="nx">the</span> <span class="nx">decorated</span> <span class="kd">function</span><span class="p">.</span>
<span class="err">#</span><span class="nx">As</span> <span class="nx">the</span> <span class="nx">wrapper</span><span class="p">,</span> <span class="nx">I</span> <span class="k">return</span> <span class="nx">the</span> <span class="nx">RESULT</span> <span class="nx">of</span> <span class="nx">the</span> <span class="nx">decorated</span> <span class="kd">function</span><span class="p">.</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">am</span> <span class="nx">the</span> <span class="nx">decorated</span> <span class="kd">function</span><span class="p">.</span>
</pre></div>
<p>到这里，我们使用@调用一个函数</p>
<p>回到问题，向装饰器本身传递参数，如果我们可以通过函数去创建装饰器，那么我们可以传递参数给这个函数，对么？</p>
<div class="codehilite"><pre><span class="nx">def</span> <span class="nx">decorator_maker_with_arguments</span><span class="p">(</span><span class="nx">decorator_arg1</span><span class="p">,</span> <span class="nx">decorator_arg2</span><span class="p">)</span><span class="o">:</span>

    <span class="nx">print</span> <span class="s2">"I make decorators! And I accept arguments:"</span><span class="p">,</span> <span class="nx">decorator_arg1</span><span class="p">,</span> <span class="nx">decorator_arg2</span>

    <span class="nx">def</span> <span class="nx">my_decorator</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span><span class="o">:</span>
        <span class="err">#</span> <span class="nx">这里能传递参数的能力</span><span class="err">，</span><span class="nx">是闭包的特性</span>
        <span class="err">#</span> <span class="nx">更多闭包的内容</span><span class="err">，</span><span class="nx">参考</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//stackoverflow.com/questions/13857/can-you-explain-closures-as-they-relate-to-python</span>
        <span class="nx">print</span> <span class="s2">"I am the decorator. Somehow you passed me arguments:"</span><span class="p">,</span> <span class="nx">decorator_arg1</span><span class="p">,</span> <span class="nx">decorator_arg2</span>

        <span class="err">#</span> <span class="nx">不要搞混了装饰器参数和函数参数</span>
        <span class="nx">def</span> <span class="nx">wrapped</span><span class="p">(</span><span class="nx">function_arg1</span><span class="p">,</span> <span class="nx">function_arg2</span><span class="p">)</span> <span class="o">:</span>
            <span class="nx">print</span> <span class="p">(</span><span class="s2">"I am the wrapper around the decorated function.\n"</span>
                  <span class="s2">"I can access all the variables\n"</span>
                  <span class="s2">"\t- from the decorator: {0} {1}\n"</span>
                  <span class="s2">"\t- from the function call: {2} {3}\n"</span>
                  <span class="s2">"Then I can pass them to the decorated function"</span>
                  <span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">decorator_arg1</span><span class="p">,</span> <span class="nx">decorator_arg2</span><span class="p">,</span>
                          <span class="nx">function_arg1</span><span class="p">,</span> <span class="nx">function_arg2</span><span class="p">))</span>
            <span class="k">return</span> <span class="nx">func</span><span class="p">(</span><span class="nx">function_arg1</span><span class="p">,</span> <span class="nx">function_arg2</span><span class="p">)</span>

        <span class="k">return</span> <span class="nx">wrapped</span>

    <span class="k">return</span> <span class="nx">my_decorator</span>

<span class="err">@</span><span class="nx">decorator_maker_with_arguments</span><span class="p">(</span><span class="s2">"Leonard"</span><span class="p">,</span> <span class="s2">"Sheldon"</span><span class="p">)</span>
<span class="nx">def</span> <span class="nx">decorated_function_with_arguments</span><span class="p">(</span><span class="nx">function_arg1</span><span class="p">,</span> <span class="nx">function_arg2</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">print</span> <span class="p">(</span><span class="s2">"I am the decorated function and only knows about my arguments: {0}"</span>
           <span class="s2">" {1}"</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">function_arg1</span><span class="p">,</span> <span class="nx">function_arg2</span><span class="p">))</span>

<span class="nx">decorated_function_with_arguments</span><span class="p">(</span><span class="s2">"Rajesh"</span><span class="p">,</span> <span class="s2">"Howard"</span><span class="p">)</span>
<span class="err">#</span><span class="nx">outputs</span><span class="o">:</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">make</span> <span class="nx">decorators</span><span class="o">!</span> <span class="nx">And</span> <span class="nx">I</span> <span class="nx">accept</span> <span class="nx">arguments</span><span class="o">:</span> <span class="nx">Leonard</span> <span class="nx">Sheldon</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">am</span> <span class="nx">the</span> <span class="nx">decorator</span><span class="p">.</span> <span class="nx">Somehow</span> <span class="nx">you</span> <span class="nx">passed</span> <span class="nx">me</span> <span class="nx">arguments</span><span class="o">:</span> <span class="nx">Leonard</span> <span class="nx">Sheldon</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">am</span> <span class="nx">the</span> <span class="nx">wrapper</span> <span class="nx">around</span> <span class="nx">the</span> <span class="nx">decorated</span> <span class="kd">function</span><span class="p">.</span> 
<span class="err">#</span><span class="nx">I</span> <span class="nx">can</span> <span class="nx">access</span> <span class="nx">all</span> <span class="nx">the</span> <span class="nx">variables</span> 
<span class="err">#</span>   <span class="o">-</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nx">decorator</span><span class="o">:</span> <span class="nx">Leonard</span> <span class="nx">Sheldon</span> 
<span class="err">#</span>   <span class="o">-</span> <span class="nx">from</span> <span class="nx">the</span> <span class="kd">function</span> <span class="nx">call</span><span class="o">:</span> <span class="nx">Rajesh</span> <span class="nx">Howard</span> 
<span class="err">#</span><span class="nx">Then</span> <span class="nx">I</span> <span class="nx">can</span> <span class="nx">pass</span> <span class="nx">them</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">decorated</span> <span class="kd">function</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">am</span> <span class="nx">the</span> <span class="nx">decorated</span> <span class="kd">function</span> <span class="nx">and</span> <span class="nx">only</span> <span class="nx">knows</span> <span class="nx">about</span> <span class="nx">my</span> <span class="nx">arguments</span><span class="o">:</span> <span class="nx">Rajesh</span> <span class="nx">Howard</span>
</pre></div>
<p>好了，that's it.参数可以设置为变量</p>
<div class="codehilite"><pre><span class="nx">c1</span> <span class="o">=</span> <span class="s2">"Penny"</span>
<span class="nx">c2</span> <span class="o">=</span> <span class="s2">"Leslie"</span>

<span class="err">@</span><span class="nx">decorator_maker_with_arguments</span><span class="p">(</span><span class="s2">"Leonard"</span><span class="p">,</span> <span class="nx">c1</span><span class="p">)</span>
<span class="nx">def</span> <span class="nx">decorated_function_with_arguments</span><span class="p">(</span><span class="nx">function_arg1</span><span class="p">,</span> <span class="nx">function_arg2</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">print</span> <span class="p">(</span><span class="s2">"I am the decorated function and only knows about my arguments:"</span>
           <span class="s2">" {0} {1}"</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">function_arg1</span><span class="p">,</span> <span class="nx">function_arg2</span><span class="p">))</span>

<span class="nx">decorated_function_with_arguments</span><span class="p">(</span><span class="nx">c2</span><span class="p">,</span> <span class="s2">"Howard"</span><span class="p">)</span>
<span class="err">#</span><span class="nx">outputs</span><span class="o">:</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">make</span> <span class="nx">decorators</span><span class="o">!</span> <span class="nx">And</span> <span class="nx">I</span> <span class="nx">accept</span> <span class="nx">arguments</span><span class="o">:</span> <span class="nx">Leonard</span> <span class="nx">Penny</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">am</span> <span class="nx">the</span> <span class="nx">decorator</span><span class="p">.</span> <span class="nx">Somehow</span> <span class="nx">you</span> <span class="nx">passed</span> <span class="nx">me</span> <span class="nx">arguments</span><span class="o">:</span> <span class="nx">Leonard</span> <span class="nx">Penny</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">am</span> <span class="nx">the</span> <span class="nx">wrapper</span> <span class="nx">around</span> <span class="nx">the</span> <span class="nx">decorated</span> <span class="kd">function</span><span class="p">.</span> 
<span class="err">#</span><span class="nx">I</span> <span class="nx">can</span> <span class="nx">access</span> <span class="nx">all</span> <span class="nx">the</span> <span class="nx">variables</span> 
<span class="err">#</span>   <span class="o">-</span> <span class="nx">from</span> <span class="nx">the</span> <span class="nx">decorator</span><span class="o">:</span> <span class="nx">Leonard</span> <span class="nx">Penny</span> 
<span class="err">#</span>   <span class="o">-</span> <span class="nx">from</span> <span class="nx">the</span> <span class="kd">function</span> <span class="nx">call</span><span class="o">:</span> <span class="nx">Leslie</span> <span class="nx">Howard</span> 
<span class="err">#</span><span class="nx">Then</span> <span class="nx">I</span> <span class="nx">can</span> <span class="nx">pass</span> <span class="nx">them</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">decorated</span> <span class="kd">function</span>
<span class="err">#</span><span class="nx">I</span> <span class="nx">am</span> <span class="nx">the</span> <span class="nx">decorated</span> <span class="kd">function</span> <span class="nx">and</span> <span class="nx">only</span> <span class="nx">knows</span> <span class="nx">about</span> <span class="nx">my</span> <span class="nx">arguments</span><span class="o">:</span> <span class="nx">Leslie</span> <span class="nx">Howard</span>
</pre></div>
<p>你可以看到，你可以使用像其它函数一样使用这个方法向装饰器传递参数.如果你愿意你甚至可以使用 <em>arg </em>*kwargs.</p>
<p>但是记住，装饰器仅在Python代码导入时被调用一次,之后你不能动态地改变参数.当你使用"import x",函数已经被装饰，所以你不能改变什么</p>
<h3 id="_8">练习：一个装饰装饰器的装饰器</h3>
<p>作为奖励，我将展示创建可以处理任何参数的装饰器代码片段. 毕竟，为了接收参数，必须使用另一个函数来创建装饰器</p>
<p>让我们来给装饰器写一个装饰器:</p>
<div class="codehilite"><pre># 装饰 装饰器 的装饰器 (好绕.....)
def decorator_with_args(decorator_to_enhance):
    """ 
    这个函数将作为装饰器使用
    它必须装饰另一个函数
    它将允许任何接收任意数量参数的装饰器
    方便你每次查询如何实现
    """

    # 同样的技巧传递参数
    def decorator_maker(*args, **kwargs):

        # 创建一个只接收函数的装饰器
        # 但是这里保存了从创建者传递过来的的参数
        def decorator_wrapper(func):

            # 我们返回原始装饰器的结果
            # 这是一个普通的函数，返回值是另一个函数
            # 陷阱：装饰器必须有这个特殊的签名，否则不会生效
            return decorator_to_enhance(func, *args, **kwargs)

        return decorator_wrapper

    return decorator_maker
</pre></div>
<p>使用：</p>
<div class="codehilite"><pre><span class="err">#</span> <span class="nx">你创建这个函数是作为一个装饰器</span><span class="err">，</span><span class="nx">但是给它附加了一个装饰器</span>
<span class="err">#</span> <span class="nx">别忘了</span><span class="err">，</span><span class="nx">函数签名是</span><span class="err">：</span> <span class="s2">"decorator(func, *args, **kwargs)"</span>
<span class="err">@</span><span class="nx">decorator_with_args</span> 
<span class="nx">def</span> <span class="nx">decorated_decorator</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="o">*</span><span class="nx">args</span><span class="p">,</span> <span class="o">**</span><span class="nx">kwargs</span><span class="p">)</span><span class="o">:</span> 
    <span class="nx">def</span> <span class="nx">wrapper</span><span class="p">(</span><span class="nx">function_arg1</span><span class="p">,</span> <span class="nx">function_arg2</span><span class="p">)</span><span class="o">:</span>
        <span class="nx">print</span> <span class="s2">"Decorated with"</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">kwargs</span>
        <span class="k">return</span> <span class="nx">func</span><span class="p">(</span><span class="nx">function_arg1</span><span class="p">,</span> <span class="nx">function_arg2</span><span class="p">)</span>
    <span class="k">return</span> <span class="nx">wrapper</span>

<span class="err">#</span> <span class="nx">然后</span><span class="err">，</span><span class="nx">使用这个装饰器</span><span class="p">(</span><span class="nx">your</span> <span class="nx">brand</span> <span class="k">new</span> <span class="nx">decorated</span> <span class="nx">decorator</span><span class="p">)</span>

<span class="err">@</span><span class="nx">decorated_decorator</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="mi">404</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
<span class="nx">def</span> <span class="nx">decorated_function</span><span class="p">(</span><span class="nx">function_arg1</span><span class="p">,</span> <span class="nx">function_arg2</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">print</span> <span class="s2">"Hello"</span><span class="p">,</span> <span class="nx">function_arg1</span><span class="p">,</span> <span class="nx">function_arg2</span>

<span class="nx">decorated_function</span><span class="p">(</span><span class="s2">"Universe and"</span><span class="p">,</span> <span class="s2">"everything"</span><span class="p">)</span>
<span class="err">#</span><span class="nx">outputs</span><span class="o">:</span>
<span class="err">#</span><span class="nx">Decorated</span> <span class="kd">with</span> <span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="mi">404</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span> <span class="p">{}</span>
<span class="err">#</span><span class="nx">Hello</span> <span class="nx">Universe</span> <span class="nx">and</span> <span class="nx">everything</span>

<span class="err">#</span> <span class="nx">Whoooot</span><span class="o">!</span>
</pre></div>
<p>我知道，到现在你一定会有这种感觉，就像你听一个人说&ldquo;在理解递归之前，你必须首先了解递归&rdquo;，但是现在，掌握这儿你有没有觉得很棒？</p>
<h2 id="_10">装饰器使用最佳实践</h2>
<ul>
<li>这是Python2.4的新特性，所以确保你的代码在2.4及之上的版本运行</li>
<li>装饰器降低了函数调用的性能，记住这点</li>
<li>You can not un-decorate a function. There are hacks to create decorators that can be removed but nobody uses them. So once a function is decorated, it's done. For all the code.</li>
<li>装饰器包装函数，所以很难debug</li>
</ul>
<p>Python2.5解决了最后一个问题，它提供functools模块，包含functools.wraps.这个函数会将被装饰函数的名称，模块，文档字符串拷贝给封装函数,有趣的是，functools.wraps是一个装饰器:-)</p>
<div class="codehilite"><pre><span class="c"># 调试，打印函数的名字</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">"foo"</span>

<span class="k">print</span> <span class="n">foo</span><span class="o">.</span><span class="n">__name__</span>
<span class="c">#outputs: foo</span>

<span class="c"># 但当你使用装饰器，这一切变得混乱</span>
<span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
        <span class="k">print</span> <span class="s">"bar"</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@bar</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">"foo"</span>

<span class="k">print</span> <span class="n">foo</span><span class="o">.</span><span class="n">__name__</span>
<span class="c">#outputs: wrapper</span>

<span class="c"># "functools" 可以改变这点</span>
<span class="kn">import</span> <span class="nn">functools</span>

<span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="c"># 我们所说的 "wrapper", 封装 "func"</span>
    <span class="nd">@functools.wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">():</span>
        <span class="k">print</span> <span class="s">"bar"</span>
        <span class="k">return</span> <span class="n">func</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@bar</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">print</span> <span class="s">"foo"</span>

<span class="c"># 得到的是原始的名称, 而不是封装器的名称</span>
<span class="k">print</span> <span class="n">foo</span><span class="o">.</span><span class="n">__name__</span>
<span class="c">#outputs: foo</span>
</pre></div>
<h3 id="_11">装饰器为何那么有用</h3>
<p>现在的问题是，我们用装饰器来坐什么？看起来很酷很强大，但是如果有实践的例子会更好.好了，有1000种可能。经典的用法是，在函数的外部，扩展一个函数的行为（你不需要改变这个函数），或者，为了调试的目的（我们不修改的原因是这是临时的），你可以使用装饰器扩展一些函数,而不用在这些函数中书写相同的函数实现一样的功能</p>
<p>DRY原则，例子：</p>
<div class="codehilite"><pre><span class="k">def</span> <span class="nf">benchmark</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    装饰器打印一个函数的执行时间</span>
<span class="sd">    """</span>
    <span class="kn">import</span> <span class="nn">time</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span><span class="o">-</span><span class="n">t</span>
        <span class="k">return</span> <span class="n">res</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="k">def</span> <span class="nf">logging</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    装饰器记录函数日志</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span>
        <span class="k">return</span> <span class="n">res</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="k">def</span> <span class="nf">counter</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    记录并打印一个函数的执行次数</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">wrapper</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">"{0} has been used: {1}x"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>
    <span class="n">wrapper</span><span class="o">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="nd">@counter</span>
<span class="nd">@benchmark</span>
<span class="nd">@logging</span>
<span class="k">def</span> <span class="nf">reverse_string</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>

<span class="k">print</span> <span class="n">reverse_string</span><span class="p">(</span><span class="s">"Able was I ere I saw Elba"</span><span class="p">)</span>
<span class="k">print</span> <span class="n">reverse_string</span><span class="p">(</span><span class="s">"A man, a plan, a canoe, pasta, heros, rajahs, a coloratura, maps, snipe, percale, macaroni, a gag, a banana bag, a tan, a tag, a banana bag again (or a camel), a crepe, pins, Spam, a rut, a Rolo, cash, a jar, sore hats, a peon, a canal: Panama!"</span><span class="p">)</span>

<span class="c">#outputs:</span>
<span class="c">#reverse_string ('Able was I ere I saw Elba',) {}</span>
<span class="c">#wrapper 0.0</span>
<span class="c">#wrapper has been used: 1x</span>
<span class="c">#ablE was I ere I saw elbA</span>
<span class="c">#reverse_string ('A man, a plan, a canoe, pasta, heros, rajahs, a coloratura, maps, snipe, percale, macaroni, a gag, a banana bag, a tan, a tag, a banana bag again (or a camel), a crepe, pins, Spam, a rut, a Rolo, cash, a jar, sore hats, a peon, a canal: Panama!',) {}</span>
<span class="c">#wrapper 0.0</span>
<span class="c">#wrapper has been used: 2x</span>
<span class="c">#!amanaP :lanac a ,noep a ,stah eros ,raj a ,hsac ,oloR a ,tur a ,mapS ,snip ,eperc a ,)lemac a ro( niaga gab ananab a ,gat a ,nat a ,gab ananab a ,gag a ,inoracam ,elacrep ,epins ,spam ,arutaroloc a ,shajar ,soreh ,atsap ,eonac a ,nalp a ,nam A</span>
</pre></div>
<p>装饰器意味着，你可以用正确的方法实现几乎所有的事情，而不必重写他们</p>
<div class="codehilite"><pre><span class="nd">@counter</span>
<span class="nd">@benchmark</span>
<span class="nd">@logging</span>
<span class="k">def</span> <span class="nf">get_random_futurama_quote</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">httplib</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">httplib</span><span class="o">.</span><span class="n">HTTPConnection</span><span class="p">(</span><span class="s">"slashdot.org:80"</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">"HEAD"</span><span class="p">,</span> <span class="s">"/index.html"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">conn</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span><span class="o">.</span><span class="n">getheaders</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">"x-b"</span><span class="p">)</span> <span class="ow">or</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">"x-f"</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
    <span class="k">return</span> <span class="s">"No, I'm ... doesn't!"</span>

<span class="k">print</span> <span class="n">get_random_futurama_quote</span><span class="p">()</span>
<span class="k">print</span> <span class="n">get_random_futurama_quote</span><span class="p">()</span>

<span class="c">#outputs:</span>
<span class="c">#get_random_futurama_quote () {}</span>
<span class="c">#wrapper 0.02</span>
<span class="c">#wrapper has been used: 1x</span>
<span class="c">#The laws of science be a harsh mistress.</span>
<span class="c">#get_random_futurama_quote () {}</span>
<span class="c">#wrapper 0.01</span>
<span class="c">#wrapper has been used: 2x</span>
<span class="c">#Curse you, merciful Poseidon!</span>
</pre></div>
<p>Python本身提供了一些装饰器：property,staticmethod,等等，</p>
<p>Django使用装饰器去管理缓存和权限. Twisted to fake inlining asynchronous functions calls.用途广泛</p>
<p>EDIT: 鉴于这个回答的完美，人们希望我去回答metaclass,我这样做了</p>
    </section>

    <section id="copyright">
        <div class="copyright">
            版权声明：自由转载-非商用-非衍生-保持署名 | <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank" >Creative Commons BY-NC-ND 3.0</a>
        </div>

        <div class="donation">
            <center>
            <img src="/imgs/life/donation.png"/>
            <strong> 如果你觉得我的文章或项目对你有所帮助, You can buy me a coffee:) </strong>
            </center>
        </div>
    </section>


    <section id="neighbors">
        <div>
                        <a class="left" href="http://www.wklken.me/posts/2013/07/18/python-translate-yield.html">
                            上一篇:  [翻译]Python中yield的解释
                        </a>
                        <a class="right" href="http://www.wklken.me/posts/2013/07/20/python-stackoverflow-vote-top.html">
                            下一篇: [翻译整理]stackoverflow python 百问
                        </a>
        </div>
    </section>

<section id="comments">
<div id="tabs">
    <ul>
        <li><a href="#tabs-disqus">DISQUS</a> </li>
        <li><a href="#tabs-duoshuo">多说</a> </li>
    </ul>
    <div id="tabs-disqus">
        <div class="comments">
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_identifier = "posts/2013/07/19/python-translate-decorator.html";
                (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://wklken.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            </div>
    </div>
    <div id="tabs-duoshuo">
        <!-- 多说评论框 start -->
            <div class="ds-thread" data-thread-key="[翻译]理解python中的装饰器" data-title="[翻译]理解python中的装饰器" data-url="posts/2013/07/19/python-translate-decorator.html"></div>
        <!-- 多说评论框 end -->
        <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
        <script type="text/javascript">
        var duoshuoQuery = {short_name:"wklken"};
            (function() {
                var ds = document.createElement('script');
                ds.type = 'text/javascript';ds.async = true;
                ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
                ds.charset = 'UTF-8';
                (document.getElementsByTagName('head')[0]
                || document.getElementsByTagName('body')[0]).appendChild(ds);
            })();
            </script>
        <!-- 多说公共JS代码 end -->
    </div>
</div>
<div id="tabid"></div>
    </section>
</article>
        </section><!--end #main-->

            <footer class="row">
                <div class="large-12 columns">
                    <p>
                            Copyright © 2014 wklken <br>
                            Hosted on <a href="https://www.digitalocean.com/?refcode=8ee73f2c47ce"> digitalocean </a> and <a href="https://gitcafe.com"> gitcafe (china)</a>. Powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Search Powered by <a href="https://swiftype.com/">Swiftype </a>Social Icons by <a href="http://fortawesome.github.io/Font-Awesome/">Font-Awesome</a>.
                    </p>
                </div>
            </footer>

            </div>
        </div>

        <section id="extras" class="body">
        </section><!-- /#extras -->

    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-42275748-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>



</body>
<script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="http://apps.bdimg.com/libs/jquery-scrollUp/2.1.0/jquery.scrollUp.min.js"></script>
<script src="http://apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
<script>
    $(function(){
        $.scrollUp({
              scrollText: '', // Text for element, can contain HTML
            });
    });
</script>
<script type="text/javascript">
  var Swiftype = window.Swiftype || {};
  Swiftype.searchSearchFields = {
    "page": ["title^10", "body"]
  };

  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v1/st.js','_st');

  _st('install','v6K-_DamCeHvwX6z3o2F');
</script>



<div id="share">
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":["mshare","tsina","weixin","douban","meilishuo","mogujie","youdao","sdo","mail","twi","copy","print"],"bdPic":"","bdStyle":"0","bdSize":"16"},"slide":{"type":"slide","bdImg":"5","bdPos":"right","bdTop":"96.5"},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"32"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["qzone","tsina","tqq","renren","weixin"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
</div>

<script>
$(function() {
$( "#tabs" ).tabs();
});
</script>

<script  src="http://www.wklken.me/theme/js/scroll-header.js" type="text/javascript"></script>


</html>