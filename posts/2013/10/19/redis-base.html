<!DOCTYPE html>
<html lang="en">

<!--[if IE 8]> <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

<head>
    <meta name="google-site-verification" content="SzE6WCs23qFevgBzRIuG9vcfLU0lW_Vd5hFT-cJOLBE" />
    <title>Redis基础笔记</title>
    <meta charset="utf-8" />
    <meta name="description" content="">
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

        <link rel="shortcut icon" href="/favicon.ico"/>
        <link rel="stylesheet" href="http://www.wklken.me/theme/css/styles.css" media="all" />
        <link rel="stylesheet" href="http://www.wklken.me/theme/css/tab.css" media="all" />

        <link rel="stylesheet" href="http://www.wklken.me/theme/css/font-awesome.min.css">
        <!--[if IE 7]>
            <link rel="stylesheet" href="http://www.wklken.me/theme/css/font-awesome-ie7.min.css">
        <![endif]-->

        <link href="http://www.wklken.me/" type="application/atom+xml" rel="alternate" title="wklken's blog ATOM Feed" />
        <link href="http://www.wklken.me/feed.xml" type="application/atom+xml" rel="alternate" title="wklken's blog RSS Feed" />

</head>

<body id="index" class="home">
    <div id="page" class="row">
        <div class="large-8 large-centered columns">

        <header id="header">
            <div class="constraint">
                <div class="o">
                    <a href="/"><h1 class="banner">Wklken <span class="blue"> Python</span></h1></a>

                <div class="social">
                            <a href="https://github.com/wklken" target='_blank'><i class="icon-github-sign icon-2x"></i></a>
                            <a href="http://weibo.com/wklken" target='_blank'><i class="icon-weibo icon-2x"></i></a>
                            <a href="mailto:wklken@yeah.net"><i class="icon-envelope icon-2x"></i></a>
                            <a href="http://www.wklken.me/feed.xml" target='_blank'><i class="icon-rss-sign icon-2x"></i></a>
                </div>
                <div class="nav">
                            <a href="/">首页</a>
                            <a href="/categories.html">分类</a>
                            <a href="/archives.html">归档</a>
                            <a href="/pages/projects.html">项目</a>
                            <a href="/pages/tools.html">工具</a>
                            <a href="/pages/books.html">书单</a>
                            <a href="/pages/aboutme.html">关于</a>

                </div>

                </div>
            </div>
        </header><!-- /#banner -->

        <section id="main">

<article id="article">
    <section id="header">
        <!--
        <div class="meta">2013年10月19日</div>
        <h1 id="title"> Redis基础笔记 </h1>
        -->
        <div class="meta"> &nbsp; </div>
        <h1> Redis基础笔记 </h1>
    </section>
    <section id="content">
        <h2>资源链接</h2>
<p>推荐书籍:《Redis入门指南》</p>
<blockquote>
<p>资源列表:</p>
</blockquote>
<p>redis命令速查<a href="http://redis.io/commands">command</a> |
             <a href="http://redis.cn/commands.html">CMD索引-中文</a> |
             <a href="http://redis.readthedocs.org/en/latest/">CMD树-中文</a></p>
<p>redis源码<a href="https://github.com/antirez/redis">github</a></p>
<p>下载地址<a href="http://redis.io/download">redis.io</a></p>
<p>The Little Redis book <a href="https://github.com/JasonLai256/the-little-redis-book/blob/master/cn/redis.md">入口</a></p>
<p>redis资料概要 @江南白衣 <a href="https://github.com/springside/springside4/wiki/redis">gist</a></p>
<p>redis资料汇总专题 <a href="http://blog.nosqlfan.com/html/3537.html">nosqlfan</a> (这个站有很多文章)</p>
<p>redis的设计与实现 <a href="http://www.redisbook.com/en/latest/">文档</a></p>
<p>redis2.6带注释源码 <a href="https://github.com/huangz1990/annotated_redis_source">github</a></p>
<p>redis 各种语言clients<a href="http://redis.io/clients">clients</a></p>
<p>python redis cli <a href="https://github.com/andymccurdy/redis-py">redis-py</a></p>
<p>网络文章汇总 <a href="http://www.redis.cn/article.html">入口</a></p>
<blockquote>
<p>文章列表：</p>
</blockquote>
<p>十五分钟介绍Redis数据结构  <a href="http://blog.nosqlfan.com/html/3202.html?ref=rediszt">入口</a></p>
<p>redis的订阅与发布 <a href="http://www.redisbook.com/en/latest/feature/pubsub.html">入口</a></p>
<p>redis之七种武器 <a href="http://blog.nosqlfan.com/html/2942.html?ref=rediszt">入口</a></p>
<p>使用Redis的五个注意事项 <a href="http://blog.nosqlfan.com/html/3705.html">入口</a></p>
<p>redis源码分析系列文章 <a href="http://blog.nosqlfan.com/html/2949.html?ref=rediszt">入口</a></p>
<p>Largest Redis Clusters Ever <a href="http://www.xdata.me/?p=301">入口</a> (使用场景)</p>
<p>成人网站YouPorn使用Redis之经验谈 <a href="http://blog.jobbole.com/44629/">入口</a></p>
<blockquote>
<p>相关项目</p>
</blockquote>
<p>Redis监控web工具 <a href="https://github.com/steelThread/redmon">redmon</a></p>
<h2>简介</h2>
<h3>简介</h3>
<p>Redis(REmote DIctionary Server),远程字典服务器，以字典结构存储数据，允许通过TCP协议读取字典中内容. 高性能键值对数据库</p>
<p>作用：</p>
<div class="codehilite"><pre><span class="mf">1.</span><span class="err">缓存系统：</span> <span class="err">可以为每个键设置</span><span class="n">TTL</span><span class="p">(</span><span class="n">Time</span> <span class="n">To</span> <span class="n">Live</span><span class="p">),</span><span class="err">生存时间到期后键会自动被删除</span>
             <span class="err">可限定数据占用最大内存空间，数据大道空间限制后自动按照一定规则淘汰不需要键</span>
<span class="mf">2.</span><span class="err">任务队列：</span> <span class="n">redis</span><span class="err">列表类型可以用来实现队列</span><span class="p">,</span> <span class="err">支持阻塞式读取，很容易用作高性能队列，还支持“发布</span><span class="o">/</span><span class="err">订阅“消息的模式</span>
</pre></div>


<p>其他:</p>
<div class="codehilite"><pre><span class="mf">1.</span><span class="n">Redis</span><span class="err">中</span><span class="p">,</span> <span class="err">所有数据都存储在内存中</span><span class="p">,</span> <span class="err">但提供了持久化支持</span><span class="p">,</span> <span class="err">内存中数据可以异步写入硬盘</span><span class="p">,</span> <span class="err">不影响现有服务</span>
<span class="mf">2.</span><span class="err">与</span><span class="n">memcached</span><span class="err">对比</span><span class="p">,</span> <span class="n">redis</span><span class="err">单线程模型</span><span class="p">,</span> <span class="n">memcached</span><span class="err">支持多线程</span><span class="p">.</span> <span class="err">但</span><span class="n">redis</span><span class="err">支持高级数据类型和持久化</span>
</pre></div>


<h3>安装</h3>
<p>安装</p>
<div class="codehilite"><pre><span class="mf">1.</span><span class="n">wget</span> <span class="n">http</span><span class="o">:</span><span class="c1">//download.redis.io/releases/redis-2.6.16.tar.gz</span>
<span class="mf">2.</span><span class="n">tar</span> <span class="o">-</span><span class="n">xzvf</span> <span class="n">redis</span><span class="o">-</span><span class="mf">2.6.16</span><span class="p">.</span><span class="n">tar</span><span class="p">.</span><span class="n">gz</span>
<span class="mf">3.</span><span class="n">cd</span> <span class="n">redis</span><span class="o">-</span><span class="mf">2.6.16</span>
<span class="mf">4.</span><span class="n">make</span>
<span class="mf">5.</span><span class="n">make</span> <span class="n">install</span>
</pre></div>


<p>osx</p>
<div class="codehilite"><pre><span class="n">brew</span> <span class="n">install</span> <span class="n">redis</span>
</pre></div>


<p>安装后，在/usr/local/bin下面有</p>
<div class="codehilite"><pre><span class="n">redis</span><span class="o">-</span><span class="n">server</span>     <span class="err">服务器</span><span class="p">,</span> <span class="err">重点</span>
<span class="n">redis</span><span class="o">-</span><span class="n">cli</span>        <span class="err">命令行客户端</span><span class="p">,</span> <span class="err">重点</span>

<span class="n">redis</span><span class="o">-</span><span class="n">benchmark</span>  <span class="err">性能测试工具</span>
<span class="n">redis</span><span class="o">-</span><span class="n">check</span><span class="o">-</span><span class="n">aof</span>  <span class="n">AOF</span><span class="err">文件修复工具</span>
<span class="n">redis</span><span class="o">-</span><span class="n">check</span><span class="o">-</span><span class="n">dump</span> <span class="n">RDB</span><span class="err">文件检查工具</span>
</pre></div>


<p>启动</p>
<p>直接启动</p>
<div class="codehilite"><pre><span class="n">redis</span><span class="o">-</span><span class="n">server</span> <span class="err">#默认</span><span class="mi">6379</span>
<span class="n">redis</span><span class="o">-</span><span class="n">server</span> <span class="o">--</span><span class="n">port</span> <span class="mi">6380</span>
<span class="cp"># 启动命令中配置将覆盖配置文件中同名参数</span>
<span class="n">redis</span><span class="o">-</span><span class="n">server</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">redis</span><span class="p">.</span><span class="n">conf</span> <span class="o">--</span><span class="n">loglevel</span> <span class="n">warning</span>
</pre></div>


<p>通过初始化脚本运行(生产环境)</p>
<div class="codehilite"><pre><span class="err">在安装包目录</span><span class="n">redis</span><span class="o">-</span><span class="mf">2.6.16</span><span class="o">/</span><span class="n">utils</span><span class="o">/</span><span class="n">redis_init_script</span>

<span class="mf">1.</span><span class="err">将脚本复制到</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="p">.</span><span class="n">d</span><span class="err">目录下，文件名为</span> <span class="n">redis_</span><span class="err">端口号</span><span class="p">,</span> <span class="err">修改文件第六行</span> <span class="n">REDISPORT</span><span class="err">为相同端口号</span>
<span class="mf">2.</span><span class="err">建立目录</span>
    <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">redis</span>           <span class="err">存放配置文件</span>
    <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">redis</span><span class="o">/</span><span class="err">端口号</span>    <span class="err">存放持久化文件</span>
<span class="mf">3.</span><span class="err">修改配置文件</span>
    <span class="err">将配置文件</span><span class="n">redis</span><span class="o">-</span><span class="mf">2.6.16</span><span class="o">/</span><span class="n">redis</span><span class="p">.</span><span class="n">conf</span> <span class="err">复制到</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">redis</span><span class="err">目录下，以端口号命名</span> <span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span>  <span class="mf">6379.</span><span class="n">conf</span>
    <span class="err">修改配置文件中部分参数</span>
        <span class="n">daemonize</span>   <span class="n">yes</span>                         <span class="err">使</span><span class="n">redis</span><span class="err">以守护进程模式运行</span>
        <span class="n">pidfile</span>     <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">redis_</span><span class="err">端口号</span><span class="p">.</span><span class="n">pid</span>   <span class="err">设置</span><span class="n">redis</span><span class="err">的</span><span class="n">PID</span><span class="err">文件按位置</span>
        <span class="n">port</span>        <span class="err">端口号</span>                      <span class="err">设置监听的端口号</span>
        <span class="n">dir</span>         <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">redis</span><span class="o">/</span><span class="err">端口号</span>           <span class="err">设置持久化文件存放位置</span>
</pre></div>


<p>停止</p>
<div class="codehilite"><pre><span class="n">redis</span><span class="o">-</span><span class="n">cli</span> <span class="n">SHUTDOWN</span>
<span class="c1">//server断开所有客户端连接, 根据配置执行持久化, 最后退出</span>
</pre></div>


<p>Redis命令行客户端</p>
<div class="codehilite"><pre><span class="err">发送命令：</span>
    <span class="n">redis</span><span class="o">-</span><span class="n">cli</span> <span class="o">-</span><span class="n">h</span> <span class="mf">127.0.0.1</span> <span class="o">-</span><span class="n">p</span> <span class="mi">6379</span>
    <span class="n">redis</span><span class="o">-</span><span class="n">cli</span> <span class="n">PING</span>
    <span class="n">redis</span><span class="o">-</span><span class="n">cli</span>
<span class="err">命令返回值</span>
    <span class="err">状态回复，</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span>  <span class="o">&gt;</span><span class="n">PING</span>
    <span class="err">错误恢复</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span>  <span class="o">&gt;</span><span class="n">ECMD</span>
    <span class="err">整数回复</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span>  <span class="o">&gt;</span><span class="n">INCR</span> <span class="n">foo</span>
    <span class="err">字符串回复，</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span> <span class="o">&gt;</span><span class="n">GET</span> <span class="n">foo</span>   <span class="o">&gt;</span><span class="n">GET</span> <span class="n">notexists</span><span class="err">`</span>
    <span class="err">多行字符串回复，</span><span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span> <span class="o">&gt;</span><span class="n">KEYS</span> <span class="o">*</span>
</pre></div>


<h2>五种数据类型及相应命令</h2>
<p>基础命令(redis-cli)</p>
<ul>
<li>返回符合规则的键名列表</li>
</ul>
<p>pattern支持通配符, ? * [] 等, 会遍历所有键, 当键的数量较多时影响性能</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">KEYS</span> <span class="n">pattern</span>
</pre></div>


<p>e.g.</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SET</span> <span class="n">bar</span> <span class="mi">1</span>
<span class="o">&gt;</span><span class="n">KEYS</span> <span class="o">*</span>
</pre></div>


<ul>
<li>判断一个键是否存在</li>
</ul>
<p>返回，0不存在，1存在</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">EXISTS</span> <span class="n">key</span>
</pre></div>


<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">EXISTS</span> <span class="n">bar</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">1</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">EXISTS</span> <span class="n">foo</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">0</span>
</pre></div>


<ul>
<li>删除键</li>
</ul>
<p>可以删除多个键, 返回删除的个数</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">DEL</span> <span class="n">key</span> <span class="p">[</span><span class="n">key</span> <span class="p">...]</span>
</pre></div>


<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">DEL</span> <span class="n">bar</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">1</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">DEL</span> <span class="n">bar</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">0</span>
</pre></div>


<ul>
<li>获取键值的数据类型</li>
</ul>
<p>返回string,hash(散列),list(列表),set(集合),zset(有序集合)</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">TYPE</span> <span class="n">key</span>
</pre></div>


<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">SET</span> <span class="n">bar</span> <span class="mi">1</span>
<span class="n">OK</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">TYPE</span> <span class="n">bar</span>
<span class="n">string</span>
</pre></div>


<h3>1. 字符串类型</h3>
<p>最基本类型, 能存储任何形式/编码字符串, 包括二进制. 允许存储最大容量是512M</p>
<ul>
<li>
<p>赋值和取值命令</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SET</span> <span class="n">key</span> <span class="n">value</span>
<span class="o">&gt;</span><span class="n">GET</span> <span class="n">key</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">SET</span> <span class="n">hi</span> <span class="s">&quot;hello world&quot;</span>
<span class="n">OK</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">GET</span> <span class="n">hi</span>
<span class="s">&quot;hello world&quot;</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">GET</span> <span class="n">abc</span>
<span class="p">(</span><span class="n">nil</span><span class="p">)</span>
</pre></div>


<ul>
<li>
<p>递增数字(当存储的字符串是整数形式时)</p>
<div class="codehilite"><pre><span class="err">当操作键不存在时，默认值</span><span class="mi">0</span><span class="err">，第一次递增后结果</span><span class="mi">1</span><span class="err">，当键值不是整数时，报错</span>
<span class="o">&gt;</span><span class="n">INCR</span> <span class="n">key</span>
<span class="err">原子操作，可用于类似访问量统计</span><span class="p">,</span> <span class="err">自增</span><span class="n">id</span>

<span class="o">&gt;</span><span class="n">INCRBY</span> <span class="n">key</span> <span class="n">increment</span>
<span class="o">&gt;</span><span class="n">INCRBY</span> <span class="n">bar</span> <span class="mi">2</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">INCR</span> <span class="n">abc</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">1</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">GET</span> <span class="n">abc</span>
<span class="s">&quot;1&quot;</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">INCRBY</span> <span class="n">abc</span> <span class="mi">2</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">3</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">GET</span> <span class="n">abc</span>
<span class="s">&quot;3&quot;</span>
</pre></div>


<ul>
<li>
<p>减少数字</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">DECR</span> <span class="n">key</span>
<span class="o">&gt;</span><span class="n">DECRBY</span> <span class="n">key</span> <span class="n">decrement</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">DECR</span> <span class="n">abc</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">2</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">DECRBY</span> <span class="n">abc</span> <span class="mi">2</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">0</span>
</pre></div>


<ul>
<li>
<p>浮点数</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">INCRBYFLOAT</span> <span class="n">key</span> <span class="n">increment</span>
<span class="o">&gt;</span><span class="n">INCRBYFLOAT</span> <span class="n">bar</span> <span class="mf">2.7</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">GET</span> <span class="n">bar</span>
<span class="s">&quot;1&quot;</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">INCRBYFLOAT</span> <span class="n">bar</span> <span class="mf">1.5</span>
<span class="s">&quot;2.5&quot;</span>
</pre></div>


<ul>
<li>
<p>向尾部追加</p>
<div class="codehilite"><pre><span class="err">返回追加字符串长度</span>

<span class="o">&gt;</span><span class="n">APPEND</span> <span class="n">key</span> <span class="n">value</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SET</span> <span class="n">key</span> <span class="n">hello</span>
<span class="o">&gt;</span><span class="n">APPEND</span> <span class="n">key</span> <span class="s">&quot;world&quot;</span>
</pre></div>


<ul>
<li>
<p>获取字符串长度</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">STRLEN</span> <span class="n">key</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">GET</span> <span class="n">hi</span>
<span class="s">&quot;hello world&quot;</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">STRLEN</span> <span class="n">hi</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">11</span>
</pre></div>


<ul>
<li>
<p>同时设置，获取多个键值</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">MGET</span> <span class="n">key</span> <span class="p">[</span><span class="n">key</span> <span class="p">...]</span>
<span class="o">&gt;</span><span class="n">MSET</span> <span class="n">key</span> <span class="n">value</span> <span class="p">[</span><span class="n">key</span> <span class="n">value</span> <span class="p">...]</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">MSET</span> <span class="n">k1</span> <span class="n">v1</span> <span class="n">k2</span> <span class="n">v2</span>
<span class="n">OK</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">GET</span> <span class="n">k1</span>
<span class="s">&quot;v1&quot;</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">MGET</span> <span class="n">k1</span> <span class="n">k2</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;v1&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;v2&quot;</span>
</pre></div>


<ul>
<li>
<p>位操作</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">GETBIT</span> <span class="n">key</span> <span class="n">offset</span>
<span class="o">&gt;</span><span class="n">SETBIT</span> <span class="n">key</span> <span class="n">offset</span> <span class="n">value</span>

<span class="o">&gt;</span><span class="n">BITCOUNT</span> <span class="n">key</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="p">[</span><span class="n">end</span><span class="p">]</span> <span class="err">#获取值为</span><span class="mi">1</span><span class="err">的二进制位个数</span>

<span class="o">&gt;</span><span class="n">BITOP</span> <span class="n">operation</span> <span class="n">destkey</span> <span class="n">key</span> <span class="p">[</span><span class="n">key</span> <span class="p">...]</span> <span class="err">#对多个字符串类型键进行位运算</span><span class="p">,</span> <span class="err">并将结果存储到</span><span class="n">destkey</span>
<span class="n">e</span><span class="p">.</span><span class="n">g</span><span class="p">.</span> <span class="n">BITOP</span> <span class="n">OR</span> <span class="n">res</span> <span class="n">fol</span> <span class="n">fo2</span>
    <span class="n">GET</span> <span class="n">res</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="n">a</span>  <span class="mi">97</span> <span class="mo">01100001</span>

<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">SET</span> <span class="n">k</span> <span class="sc">&#39;a&#39;</span>
<span class="n">OK</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">GET</span> <span class="n">k</span>
<span class="s">&quot;a&quot;</span>

<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">GETBIT</span> <span class="n">k</span> <span class="mi">0</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">0</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">GETBIT</span> <span class="n">k</span> <span class="mi">1</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">1</span>

<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">BITCOUNT</span> <span class="n">k</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">3</span>
</pre></div>


<p>BP: redis对键的命名，  对象类型:对象id:对象属性</p>
<h3>2. 散列类型</h3>
<p>一种字典结构，其存储了字段(field)和字段值映射，但字段值只能是字符串，不支持其他数据类型(即散列类型不支持数据类型嵌套)</p>
<p>散列类型适合存储对象</p>
<div class="codehilite"><pre><span class="err">对象类型</span><span class="o">:</span><span class="n">id</span> <span class="o">-</span> <span class="err">对象属性</span> <span class="o">-</span> <span class="err">对象属性值</span>
</pre></div>


<ul>
<li>
<p>基本命令</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">HSET</span> <span class="n">key</span> <span class="n">field</span> <span class="n">value</span>
<span class="o">&gt;</span><span class="n">HGET</span> <span class="n">key</span> <span class="n">field</span>
<span class="cp">#HSET不区分插入更新</span>

<span class="o">&gt;</span><span class="n">HMSET</span> <span class="n">key</span> <span class="n">field</span> <span class="n">value</span> <span class="p">[</span><span class="n">field</span> <span class="n">value</span> <span class="p">...]</span>
<span class="o">&gt;</span><span class="n">HMGET</span> <span class="n">key</span> <span class="n">field</span> <span class="p">[</span><span class="n">field</span> <span class="p">...]</span>

<span class="o">&gt;</span><span class="n">HGETALL</span> <span class="n">key</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">HSET</span> <span class="n">car</span> <span class="n">name</span> <span class="n">bmw</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">1</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">HGET</span> <span class="n">car</span> <span class="n">name</span>
<span class="s">&quot;bmw&quot;</span>

<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">HMSET</span> <span class="n">car</span> <span class="n">price</span> <span class="mi">100</span> <span class="n">score</span> <span class="mi">50</span>
<span class="n">OK</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">HMGET</span> <span class="n">car</span> <span class="n">name</span> <span class="n">price</span> <span class="n">score</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;bmw&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;100&quot;</span>
<span class="mi">3</span><span class="p">)</span> <span class="s">&quot;50&quot;</span>

<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">HGETALL</span> <span class="n">car</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;name&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;bmw&quot;</span>
<span class="mi">3</span><span class="p">)</span> <span class="s">&quot;price&quot;</span>
<span class="mi">4</span><span class="p">)</span> <span class="s">&quot;100&quot;</span>
<span class="mi">5</span><span class="p">)</span> <span class="s">&quot;score&quot;</span>
<span class="mi">6</span><span class="p">)</span> <span class="s">&quot;50&quot;</span>
</pre></div>


<ul>
<li>
<p>判断字段是否存在</p>
<div class="codehilite"><pre><span class="cp">#存在返回1，否则返回0</span>
<span class="o">&gt;</span><span class="n">HEXISTS</span> <span class="n">key</span> <span class="n">field</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">HEXISTS</span> <span class="n">car</span> <span class="n">name</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">1</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">HEXISTS</span> <span class="n">car</span> <span class="n">model</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">0</span>
</pre></div>


<ul>
<li>
<p>当字段不存在时赋值</p>
<div class="codehilite"><pre><span class="cp">#已存在不进行任何操作, 不存在赋值</span>
<span class="o">&gt;</span><span class="n">HSETNX</span> <span class="n">key</span> <span class="n">field</span> <span class="n">value</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">HSETNX</span> <span class="n">car</span> <span class="n">name</span>  <span class="n">abc</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">0</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">HGET</span> <span class="n">car</span> <span class="n">name</span>
<span class="s">&quot;bmw&quot;</span>

<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">HEXISTS</span> <span class="n">car</span> <span class="n">model</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">0</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">HSETNX</span> <span class="n">car</span> <span class="n">model</span> <span class="mi">1</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">1</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">HGET</span> <span class="n">car</span> <span class="n">model</span>
<span class="s">&quot;1&quot;</span>
</pre></div>


<ul>
<li>
<p>增加数字</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">HINCRBY</span> <span class="n">key</span> <span class="n">field</span> <span class="n">increment</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">HINCRBY</span> <span class="n">person</span> <span class="n">score</span> <span class="mi">60</span>
</pre></div>


<ul>
<li>
<p>删除字段</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">HDEL</span> <span class="n">key</span> <span class="n">field</span> <span class="p">[</span><span class="n">field</span> <span class="p">...]</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="n">HDEL</span> <span class="n">car</span> <span class="n">price</span>
</pre></div>


<ul>
<li>
<p>只获取字段名或字段值</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">HKEYS</span> <span class="n">key</span>
<span class="o">&gt;</span><span class="n">HVALS</span> <span class="n">key</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">HKEYS</span> <span class="n">car</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;name&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;price&quot;</span>
<span class="mi">3</span><span class="p">)</span> <span class="s">&quot;score&quot;</span>
<span class="mi">4</span><span class="p">)</span> <span class="s">&quot;model&quot;</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">HVALS</span> <span class="n">car</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;bmw&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;100&quot;</span>
<span class="mi">3</span><span class="p">)</span> <span class="s">&quot;50&quot;</span>
<span class="mi">4</span><span class="p">)</span> <span class="s">&quot;1&quot;</span>
</pre></div>


<ul>
<li>
<p>获取字段数量</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">HLEN</span> <span class="n">key</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">HLEN</span> <span class="n">car</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">4</span>
</pre></div>


<h3>3. 列表类型</h3>
<p>List, 可以存储一个有序的字符串列表, 列表内元素非唯一性，可以向两端加入元素，或者获得列表的某一个片段</p>
<p>内部使用双向链表实现,两端添加元素复杂度O(1), 通过索引访问的速度较慢</p>
<p>可以用在分页, 新鲜事, 记录日志等</p>
<ul>
<li>
<p>向列表两端增加元素(可同时增加多个)</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">LPUSH</span> <span class="n">key</span> <span class="n">value</span> <span class="p">[</span><span class="n">value</span> <span class="p">...]</span>
<span class="o">&gt;</span><span class="n">RPUSH</span> <span class="n">key</span> <span class="n">value</span> <span class="p">[</span><span class="n">value</span> <span class="p">...]</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">LPUSH</span> <span class="n">num</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">3</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">RPUSH</span> <span class="n">num</span> <span class="mi">0</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">4</span>
<span class="cp"># 3 2 1 0</span>
</pre></div>


<ul>
<li>从列表两端弹出元素</li>
</ul>
<p>先移除一个元素，然后返回之</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">LPOP</span> <span class="n">key</span>
<span class="o">&gt;</span><span class="n">RPOP</span> <span class="n">key</span>
</pre></div>


<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">LPOP</span> <span class="n">num</span>
<span class="s">&quot;3&quot;</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">RPOP</span> <span class="n">num</span>
<span class="s">&quot;0&quot;</span>
</pre></div>


<ul>
<li>
<p>获取元素个数</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">LLEN</span> <span class="n">key</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">LLEN</span> <span class="n">num</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">2</span>
</pre></div>


<ul>
<li>
<p>获取片段(同python切片，-1表最后一个, stop超出返回最右边元素, start大于stop返回空)</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">LRANGE</span> <span class="n">key</span> <span class="n">start</span> <span class="n">stop</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">LPUSH</span> <span class="n">test</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">e</span> <span class="n">f</span> <span class="n">g</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">7</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">LRANGE</span> <span class="n">test</span> <span class="mi">0</span> <span class="mi">2</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;g&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;f&quot;</span>
<span class="mi">3</span><span class="p">)</span> <span class="s">&quot;e&quot;</span>
</pre></div>


<ul>
<li>
<p>删除列表中指定值的元素</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">LREM</span> <span class="n">key</span> <span class="n">count</span> <span class="n">value</span>

<span class="err">删除列表中前</span><span class="n">count</span><span class="err">个值为</span><span class="n">value</span><span class="err">的元素，返回值为实际删除元素的个数</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span> <span class="err">所有</span>
                  <span class="o">&gt;</span> <span class="mi">0</span> <span class="err">从左边开始删</span><span class="n">count</span><span class="err">个</span>
                  <span class="o">&lt;</span> <span class="mi">0</span> <span class="err">从右边开始删</span><span class="o">|</span><span class="n">count</span><span class="o">|</span><span class="err">个</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">LRANGE</span> <span class="n">test</span> <span class="mi">0</span> <span class="mi">2</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;g&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;f&quot;</span>
<span class="mi">3</span><span class="p">)</span> <span class="s">&quot;e&quot;</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">LREM</span> <span class="n">test</span> <span class="mi">0</span> <span class="n">f</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">1</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">LRANGE</span> <span class="n">test</span> <span class="mi">0</span> <span class="mi">2</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;g&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;e&quot;</span>
<span class="mi">3</span><span class="p">)</span> <span class="s">&quot;d&quot;</span>
</pre></div>


<ul>
<li>
<p>设置指定索引元素值</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">LINDEX</span> <span class="n">key</span> <span class="n">index</span>
<span class="o">&gt;</span><span class="n">LSET</span> <span class="n">key</span> <span class="n">index</span> <span class="n">value</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">LPUSH</span> <span class="n">lt</span> <span class="mi">3</span> <span class="mi">2</span> <span class="mi">1</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">3</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">LINDEX</span> <span class="n">lt</span> <span class="mi">0</span>
<span class="s">&quot;1&quot;</span>

<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">LSET</span> <span class="n">lt</span> <span class="mi">0</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">OK</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">LINDEX</span> <span class="n">lt</span> <span class="mi">0</span>
<span class="s">&quot;-1&quot;</span>
</pre></div>


<ul>
<li>
<p>只保留列表指定片段</p>
<div class="codehilite"><pre><span class="err">删除指定索引范围之外的所有元素</span>
<span class="o">&gt;</span><span class="n">LTRIM</span> <span class="n">key</span> <span class="n">start</span> <span class="n">end</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">LRANGE</span> <span class="n">la</span> <span class="mi">0</span> <span class="mi">99</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;6&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;5&quot;</span>
<span class="mi">3</span><span class="p">)</span> <span class="s">&quot;4&quot;</span>
<span class="mi">4</span><span class="p">)</span> <span class="s">&quot;3&quot;</span>
<span class="mi">5</span><span class="p">)</span> <span class="s">&quot;2&quot;</span>
<span class="mi">6</span><span class="p">)</span> <span class="s">&quot;1&quot;</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">LTRIM</span> <span class="n">la</span> <span class="mi">0</span> <span class="mi">2</span>
<span class="n">OK</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">LRANGE</span> <span class="n">la</span> <span class="mi">0</span> <span class="mi">99</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;6&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;5&quot;</span>
<span class="mi">3</span><span class="p">)</span> <span class="s">&quot;4&quot;</span>
</pre></div>


<ul>
<li>
<p>向列表中插入元素</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">LINSERT</span> <span class="n">key</span> <span class="n">BEFORE</span><span class="o">|</span><span class="n">AFTER</span> <span class="n">pivot</span> <span class="n">value</span>
<span class="err">从左到右查找值为</span><span class="n">pivot</span><span class="err">的元素，然后根据</span><span class="n">BEFORE</span><span class="o">/</span><span class="n">AFTER</span><span class="err">决定将</span><span class="n">value</span><span class="err">插入该元素前面还是后面</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">LRANGE</span> <span class="n">la</span> <span class="mi">0</span> <span class="mi">99</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;6&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;5&quot;</span>
<span class="mi">3</span><span class="p">)</span> <span class="s">&quot;4&quot;</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">LINSERT</span> <span class="n">la</span> <span class="n">AFTER</span> <span class="mi">5</span> <span class="mi">3</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">4</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">LRANGE</span> <span class="n">la</span> <span class="mi">0</span> <span class="mi">99</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;6&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;5&quot;</span>
<span class="mi">3</span><span class="p">)</span> <span class="s">&quot;3&quot;</span>
<span class="mi">4</span><span class="p">)</span> <span class="s">&quot;4&quot;</span>
</pre></div>


<p>将元素从一个列表转到另一个列表</p>
<div class="codehilite"><pre><span class="n">RPOPLPUSH</span> <span class="n">source</span> <span class="n">destination</span>
<span class="cp">#RPOP，然后LPUSH，返回每个元素值，e.g.循环测试网址的可用性</span>
</pre></div>


<h3>4. 集合类型</h3>
<p>无序，无重复(唯一)，可以存储最多2^32 - 1 个字符串</p>
<ul>
<li>增加删除元素</li>
</ul>
<p>返回操作成功的个数</p>
<div class="codehilite"><pre>    <span class="o">&gt;</span><span class="n">SADD</span> <span class="n">key</span> <span class="n">member</span> <span class="p">[</span><span class="n">member</span> <span class="p">...]</span>
    <span class="o">&gt;</span><span class="n">SREM</span> <span class="n">key</span> <span class="n">member</span> <span class="p">[</span><span class="n">member</span> <span class="p">...]</span>
</pre></div>


<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">SADD</span> <span class="n">letters</span> <span class="n">a</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">1</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">SADD</span> <span class="n">letters</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">2</span>
</pre></div>


<ul>
<li>
<p>获得集合中的所有元素</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SMEMBERS</span> <span class="n">key</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">SMEMBERS</span> <span class="n">letters</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;c&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;a&quot;</span>
<span class="mi">3</span><span class="p">)</span> <span class="s">&quot;b&quot;</span>
</pre></div>


<ul>
<li>
<p>判断元素是否在集合中(复杂度O(1))</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SISMEMBER</span> <span class="n">key</span> <span class="n">member</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">SISMEMBER</span> <span class="n">letters</span> <span class="n">a</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">1</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">SISMEMBER</span> <span class="n">letters</span> <span class="n">d</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">0</span>
</pre></div>


<ul>
<li>
<p>集合间运算</p>
<div class="codehilite"><pre><span class="cp"># 差集</span>
<span class="o">&gt;</span><span class="n">SDIFF</span> <span class="n">key</span> <span class="p">[</span><span class="n">key</span> <span class="p">...]</span>
<span class="cp"># 交集</span>
<span class="o">&gt;</span><span class="n">SINTER</span> <span class="n">key</span> <span class="p">[</span><span class="n">key</span> <span class="p">...]</span>
<span class="cp"># 并集</span>
<span class="o">&gt;</span><span class="n">SUNION</span> <span class="n">key</span> <span class="p">[</span><span class="n">key</span> <span class="p">...]</span>
</pre></div>


</li>
<li>
<p>进行集合运算并将结果存储</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SDIFFSTORE</span> <span class="n">destination_key</span> <span class="n">key</span> <span class="p">[</span><span class="n">key</span> <span class="p">...]</span>
<span class="o">&gt;</span><span class="n">SINTERSTORE</span> <span class="n">destination_key</span> <span class="n">key</span> <span class="p">[</span><span class="n">key</span> <span class="p">...]</span>
<span class="o">&gt;</span><span class="n">SUNIONSTORE</span> <span class="n">destination_key</span> <span class="n">key</span> <span class="p">[</span><span class="n">key</span> <span class="p">...]</span>
</pre></div>


</li>
<li>
<p>获得集合中元素个数</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SCARD</span> <span class="n">key</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">SCARD</span> <span class="n">letters</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">3</span>
</pre></div>


<ul>
<li>
<p>随机获取集合中元素</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SRANDMEMBER</span> <span class="n">key</span> <span class="p">[</span><span class="n">count</span><span class="p">]</span>
<span class="n">count</span><span class="err">，正数，获取</span><span class="n">count</span><span class="err">个不重复的元素</span>
<span class="n">count</span><span class="p">,</span> <span class="err">负数，获取</span><span class="o">|</span><span class="n">count</span><span class="o">|</span><span class="err">个，可能重复</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">SRANDMEMBER</span> <span class="n">letters</span>
<span class="s">&quot;b&quot;</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">SRANDMEMBER</span> <span class="n">letters</span> <span class="mi">2</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;a&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;c&quot;</span>

<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">SRANDMEMBER</span> <span class="n">letters</span> <span class="o">-</span><span class="mi">2</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;b&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;b&quot;</span>
</pre></div>


<ul>
<li>
<p>弹出一个元素</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SPOP</span> <span class="n">key</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">SPOP</span> <span class="n">letters</span>
<span class="s">&quot;c&quot;</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">SCARD</span> <span class="n">letters</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">2</span>
</pre></div>


<h3>5. 有序集合</h3>
<p>sorted set,集合中每个元素都关联一个分数(不同元素分数可以相同)，可以根据分数进行排序(最高/最低N个)，进行有序相关的操作(分数可以相同)</p>
<p>有序集合使用散列表和跳跃表实现, 读取复杂度更低, 更耗费内存</p>
<p>按点击量排序，按时间排序等等，时间轴操作</p>
<ul>
<li>
<p>增加元素</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">ZADD</span> <span class="n">key</span> <span class="n">score</span> <span class="n">member</span> <span class="p">[</span><span class="n">score</span> <span class="n">member</span><span class="p">]</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">ZADD</span> <span class="n">scoreboard</span> <span class="mi">89</span> <span class="n">tom</span> <span class="mi">67</span> <span class="n">peter</span> <span class="mi">100</span> <span class="n">david</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">3</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">ZADD</span> <span class="n">scoreboard</span> <span class="mi">70</span> <span class="n">peter</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">0</span>
</pre></div>


<ul>
<li>
<p>获取元素分数</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">ZSCORE</span> <span class="n">key</span> <span class="n">member</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">ZSCORE</span> <span class="n">scoreboard</span> <span class="n">peter</span>
<span class="s">&quot;70&quot;</span>
</pre></div>


<ul>
<li>获取排名在某个范围内的元素列表</li>
</ul>
<p>分数相同，按字典序排,中文的话，取决于编码方式</p>
<div class="codehilite"><pre><span class="cp">#分数从小到大排，返回索引从 start-stop之间的所有元素，包含两端元素, WITHSCORES同时获得元素分数</span>
<span class="o">&gt;</span><span class="n">ZRANGE</span> <span class="n">key</span> <span class="n">start</span> <span class="n">stop</span> <span class="p">[</span><span class="n">WITHSCORES</span><span class="p">]</span>
<span class="o">&gt;</span><span class="n">ZREVRANGE</span> <span class="n">key</span> <span class="n">start</span> <span class="n">stop</span> <span class="p">[</span><span class="n">WITHSCORES</span><span class="p">]</span>
</pre></div>


<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">ZRANGE</span> <span class="n">scoreboard</span> <span class="mi">0</span> <span class="mi">2</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;peter&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;tom&quot;</span>
<span class="mi">3</span><span class="p">)</span> <span class="s">&quot;david&quot;</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">ZRANGE</span> <span class="n">scoreboard</span> <span class="mi">0</span> <span class="mi">2</span> <span class="n">WITHSCORES</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;peter&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;70&quot;</span>
<span class="mi">3</span><span class="p">)</span> <span class="s">&quot;tom&quot;</span>
<span class="mi">4</span><span class="p">)</span> <span class="s">&quot;89&quot;</span>
<span class="mi">5</span><span class="p">)</span> <span class="s">&quot;david&quot;</span>
<span class="mi">6</span><span class="p">)</span> <span class="s">&quot;100&quot;</span>

<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">ZREVRANGE</span> <span class="n">scoreboard</span> <span class="mi">0</span> <span class="mi">2</span> <span class="n">WITHSCORES</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;david&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;100&quot;</span>
<span class="mi">3</span><span class="p">)</span> <span class="s">&quot;tom&quot;</span>
<span class="mi">4</span><span class="p">)</span> <span class="s">&quot;89&quot;</span>
<span class="mi">5</span><span class="p">)</span> <span class="s">&quot;peter&quot;</span>
<span class="mi">6</span><span class="p">)</span> <span class="s">&quot;70&quot;</span>
</pre></div>


<ul>
<li>
<p>获取指定分数范围的元素</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">ZRANGEBYSCORE</span> <span class="n">key</span> <span class="n">min</span> <span class="n">max</span> <span class="p">[</span><span class="n">WITHSCORES</span><span class="p">]</span> <span class="p">[</span><span class="n">LIMIT</span> <span class="n">offset</span> <span class="n">count</span><span class="p">]</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">ZRANGEBYSCORE</span> <span class="n">scoreboard</span> <span class="mi">80</span> <span class="mi">100</span> <span class="n">WITHSCORES</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;tom&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;89&quot;</span>
<span class="mi">3</span><span class="p">)</span> <span class="s">&quot;david&quot;</span>
<span class="mi">4</span><span class="p">)</span> <span class="s">&quot;100&quot;</span>
</pre></div>


<p>希望不包含端点值</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">ZRANGEBYSCORE</span> <span class="n">scoreboard</span> <span class="mi">80</span> <span class="p">(</span><span class="mi">100</span>
<span class="err">正负无穷大</span> <span class="o">+</span><span class="n">inf</span> <span class="o">-</span><span class="n">inf</span>
</pre></div>


<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">ZRANGEBYSCORE</span> <span class="n">scoreboard</span> <span class="mi">80</span> <span class="p">(</span><span class="mi">100</span> <span class="n">WITHSCORES</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;tom&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;89&quot;</span>

<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">ZRANGEBYSCORE</span> <span class="n">scoreboard</span> <span class="mi">80</span> <span class="o">+</span><span class="n">inf</span> <span class="n">WITHSCORES</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;tom&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;89&quot;</span>
<span class="mi">3</span><span class="p">)</span> <span class="s">&quot;david&quot;</span>
<span class="mi">4</span><span class="p">)</span> <span class="s">&quot;100&quot;</span>

<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">ZRANGEBYSCORE</span> <span class="n">scoreboard</span> <span class="mi">80</span> <span class="o">+</span><span class="n">inf</span> <span class="n">WITHSCORES</span> <span class="n">LIMIT</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;tom&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;89&quot;</span>
</pre></div>


<ul>
<li>
<p>增加某个元素分数</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">ZINCRBY</span> <span class="n">key</span> <span class="n">increment</span> <span class="n">member</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">ZSCORE</span> <span class="n">scoreboard</span> <span class="n">tom</span>
<span class="s">&quot;89&quot;</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">ZINCRBY</span> <span class="n">scoreboard</span> <span class="mi">2</span> <span class="n">tom</span>
<span class="s">&quot;91&quot;</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">ZSCORE</span> <span class="n">scoreboard</span> <span class="n">tom</span>
<span class="s">&quot;91&quot;</span>
</pre></div>


<ul>
<li>
<p>获得集合中元素数量</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">ZCARD</span> <span class="n">key</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">ZCARD</span> <span class="n">scoreboard</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">3</span>
</pre></div>


<ul>
<li>
<p>获得指定分数范围内的元素个数</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">ZCOUNT</span> <span class="n">key</span> <span class="n">min</span> <span class="n">max</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">ZCOUNT</span> <span class="n">scoreboard</span> <span class="mi">80</span> <span class="mi">100</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">2</span>
</pre></div>


<ul>
<li>
<p>删除一个或多个元素</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">ZREM</span> <span class="n">key</span> <span class="n">member</span> <span class="p">[</span><span class="n">member</span> <span class="p">...]</span>
</pre></div>


</li>
<li>
<p>按照排名范围删除元素</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">ZREMRANGEBYRANK</span> <span class="n">key</span> <span class="n">start</span> <span class="n">stop</span>
</pre></div>


</li>
<li>
<p>按照分数范围删除</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">ZREMRANGEBYSCORE</span> <span class="n">key</span> <span class="n">min</span> <span class="n">max</span>
</pre></div>


</li>
<li>
<p>获得元素排名</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">ZRANK</span> <span class="n">key</span> <span class="n">member</span> <span class="err">#从小到大</span>
<span class="o">&gt;</span><span class="n">ZREVRANK</span> <span class="n">key</span> <span class="n">member</span> <span class="err">#相反</span>
</pre></div>


</li>
</ul>
<p>e.g.</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">ZRANK</span> <span class="n">scoreboard</span> <span class="n">tom</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">1</span>
</pre></div>


<ul>
<li>
<p>计算有序集合的交集</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">ZINTERSTORE</span> <span class="n">destination</span> <span class="n">numkeys</span> <span class="n">key</span> <span class="p">[</span><span class="n">key</span> <span class="p">...]</span> <span class="p">[</span><span class="n">WEIGHTS</span> <span class="n">weight</span> <span class="p">[</span><span class="n">weight</span> <span class="p">...]]</span> <span class="p">[</span><span class="n">AGGREGATE</span> <span class="n">SUM</span><span class="o">|</span><span class="n">MIN</span><span class="o">|</span><span class="n">MAX</span><span class="p">]</span>

<span class="cp">#返回值为destination中元素个数</span>
<span class="cp">#AGGREGATE sum默认值，destination键中元素分数是每个参与计算的集合中该元素分数的和</span>
        <span class="n">min</span><span class="err">取最小值</span>
        <span class="n">max</span><span class="err">取最大值</span>
<span class="cp">#WEIGHTS 设置每个集合的权重，每个集合在参与计算时分数会被乘以权重</span>
</pre></div>


</li>
</ul>
<h2>其他</h2>
<h3>事务</h3>
<p>Redis中事务是一组命令的集合, 一个事务中的命令要么都执行, 要么都不执行</p>
<div class="codehilite"><pre><span class="o">&gt;</span> <span class="n">MULTI</span>
<span class="o">&gt;</span> <span class="n">SADD</span> <span class="n">k1</span> <span class="n">v1</span>
<span class="o">&gt;</span> <span class="n">SADD</span> <span class="n">k2</span> <span class="n">v2</span>
<span class="o">&gt;</span> <span class="n">EXEC</span>
</pre></div>


<p>注意, 不支持回滚功能</p>
<h3>SORT</h3>
<p>可以对列表/集合/有序集合进行排序</p>
<p>最强大最复杂, 用不好可能成为性能瓶颈 O(n + mlogm) n为排序个数, m为返回个数</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SORT</span> <span class="n">key</span> <span class="err">#从小到大</span>
<span class="o">&gt;</span><span class="n">SORT</span> <span class="n">key</span> <span class="n">DESC</span> <span class="err">#从大到小</span>
</pre></div>


<p>SORTBY</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">LPUSH</span> <span class="n">sortbylist</span>  <span class="mi">2</span> <span class="mi">1</span> <span class="mi">3</span>
<span class="p">(</span><span class="n">integer</span><span class="p">)</span> <span class="mi">3</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">SET</span> <span class="n">itemscore</span><span class="o">:</span><span class="mi">1</span> <span class="mi">50</span>
<span class="n">OK</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">SET</span> <span class="n">itemscore</span><span class="o">:</span><span class="mi">2</span> <span class="mi">100</span>
<span class="n">OK</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">SET</span> <span class="n">itemscore</span><span class="o">:</span><span class="mi">3</span> <span class="o">-</span><span class="mi">10</span>
<span class="n">OK</span>
<span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">SORT</span> <span class="n">sortbylist</span> <span class="n">BY</span> <span class="n">itemscore</span><span class="o">:*</span> <span class="n">DESC</span>
<span class="mi">1</span><span class="p">)</span> <span class="s">&quot;2&quot;</span>
<span class="mi">2</span><span class="p">)</span> <span class="s">&quot;1&quot;</span>
<span class="mi">3</span><span class="p">)</span> <span class="s">&quot;3&quot;</span>
</pre></div>


<p>SORTBY GET</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">SORT</span> <span class="n">sortbylist</span> <span class="n">BY</span> <span class="n">itemscore</span><span class="o">:*</span> <span class="n">DESC</span> <span class="n">GET</span> <span class="n">POST</span><span class="o">:*-&gt;</span><span class="n">title</span> <span class="n">GET</span> <span class="n">POST</span><span class="o">:*-&gt;</span><span class="n">time</span>
</pre></div>


<p>SOTRBY GET STORE</p>
<div class="codehilite"><pre><span class="mf">127.0.0.1</span><span class="o">:</span><span class="mi">6379</span><span class="o">&gt;</span> <span class="n">SORT</span> <span class="n">sortbylist</span> <span class="n">BY</span> <span class="n">itemscore</span><span class="o">:*</span> <span class="n">DESC</span> <span class="n">GET</span> <span class="n">POST</span><span class="o">:*-&gt;</span><span class="n">title</span> <span class="n">GET</span> <span class="n">POST</span><span class="o">:*-&gt;</span><span class="n">time</span> <span class="n">STORE</span> <span class="n">new_key</span>
</pre></div>


<h3>生存时间</h3>
<p>TTL, time to live</p>
<p>时效数据，过一定时间删除这些数据</p>
<div class="codehilite"><pre><span class="cp">#设置</span>
<span class="o">&gt;</span><span class="n">EXPIRE</span> <span class="n">key</span> <span class="n">seconds</span>
<span class="mi">1</span><span class="err">表示设置成功</span><span class="p">,</span> <span class="mi">0</span><span class="err">表键不存在或设置失败</span>

<span class="cp">#查询</span>
<span class="o">&gt;</span><span class="n">TTL</span> <span class="n">key</span>
<span class="err">键不存在返回</span><span class="o">-</span><span class="mi">1</span> <span class="n">or</span> <span class="err">没有设置生存时间</span>

<span class="cp">#去除时效</span>
<span class="o">&gt;</span><span class="n">PERSIST</span> <span class="n">key</span>

<span class="cp">#SET/GETSET为键赋值会同时清除键的生存时间</span>
</pre></div>


<h3>任务队列</h3>
<p>一般队列</p>
<div class="codehilite"><pre><span class="err">生产者</span> <span class="n">LPUSH</span>
<span class="err">消费者</span> <span class="n">RPOP</span>

<span class="n">BRPOP</span> <span class="err">和</span><span class="n">RPOP</span><span class="err">类似，但是当列表中没有元素时，</span><span class="n">BRPOP</span><span class="err">会一直阻塞住链接，直到有新元素加入</span>
</pre></div>


<p>优先队列</p>
<div class="codehilite"><pre><span class="n">BLPOP</span> <span class="n">key</span> <span class="p">[</span><span class="n">key</span> <span class="p">...]</span> <span class="n">timeout</span><span class="p">,</span><span class="err">同时检测多个键，如果所有键都没有元素则阻塞，如果其中有一个键有元素，则从该键中弹出元素</span>
<span class="err">如果都有，则从左到右的顺序取第一个键中的一个元素</span>

<span class="n">BLPOP</span> <span class="n">queue</span><span class="o">:</span><span class="mi">1</span> <span class="n">queue</span><span class="o">:</span><span class="mi">2</span> <span class="n">queue</span><span class="o">:</span><span class="mi">3</span> <span class="mi">0</span>
</pre></div>


<h3>发布/订阅模式</h3>
<p>进程间消息传递</p>
<p>订阅者：订阅者可以订阅一个或多个频道</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SUBSCRIBE</span> <span class="n">channel1</span>
</pre></div>


<p>发布者：可以向指定的频道发送消息，所有订阅此频道的订阅者都会受到此消息</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">PUBLISH</span> <span class="n">channel1</span> <span class="n">helloworld</span>
</pre></div>


<h3>Python中使用Redis</h3>
<p>官方推荐<a href="https://github.com/andymccurdy/redis-py">redis-py</a></p>
<p>安装</p>
<div class="codehilite"><pre><span class="n">sudo</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">redis</span>
<span class="n">sudo</span> <span class="n">easy_install</span> <span class="n">redis</span>
</pre></div>


<p>使用</p>
<div class="codehilite"><pre><span class="n">redis</span><span class="o">-</span><span class="n">py</span><span class="err">提供两个类</span><span class="n">Redis</span><span class="err">和</span><span class="n">StrictRedis</span><span class="err">用于实现</span><span class="n">Redis</span><span class="err">的命令，</span>
<span class="n">StrictRedis</span><span class="err">用于实现大部分官方的命令，并使用官方的语法和命令（比如，</span><span class="n">SET</span><span class="err">命令对应与</span><span class="n">StrictRedis</span><span class="p">.</span><span class="n">set</span><span class="err">方法）</span>
<span class="n">Redis</span><span class="err">是</span><span class="n">StrictRedis</span><span class="err">的子类，用于向后兼容旧版本的</span><span class="n">redis</span><span class="o">-</span><span class="n">py</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">import</span> <span class="n">redis</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="p">.</span><span class="n">StrictRedis</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="err">&#39;</span><span class="n">localhost</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="err">&#39;</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">bar</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="err">&#39;</span><span class="n">foo</span><span class="err">&#39;</span><span class="p">)</span>
<span class="err">&#39;</span><span class="n">bar</span><span class="err">&#39;</span>
</pre></div>


<p>connection pool</p>
<div class="codehilite"><pre><span class="err">管理对一个</span><span class="n">redis</span> <span class="n">server</span><span class="err">的所有连接，避免每次建立、释放连接的开销。</span>
<span class="err">默认，每个</span><span class="n">Redis</span><span class="err">实例都会维护一个自己的连接池。可以直接建立一个连接池，然后作为参数</span><span class="n">Redis</span><span class="err">，这样就可以实现多个</span><span class="n">Redis</span><span class="err">实例共享一个连接池。</span>

<span class="n">pool</span> <span class="o">=</span> <span class="n">redis</span><span class="p">.</span><span class="n">ConnectionPool</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="err">&#39;</span><span class="mf">127.0.0.1</span><span class="err">&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="p">.</span><span class="n">Redis</span><span class="p">(</span><span class="n">connection_pool</span><span class="o">=</span><span class="n">pool</span><span class="p">)</span>
</pre></div>


<p>pipeline机制</p>
<div class="codehilite"><pre><span class="err">可以在一次请求中执行多个命令，这样避免了多次的往返时延</span>
<span class="err">当一组命令中每条命令都不依赖于之前的执行结果</span><span class="p">,</span> <span class="err">可以使用</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">pipeline</span><span class="p">()</span>
<span class="n">pipe</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="err">&#39;</span><span class="n">one</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">first</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">pipe</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="err">&#39;</span><span class="n">two</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">second</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">pipe</span><span class="p">.</span><span class="n">execute</span><span class="p">()</span>

<span class="n">pipeline</span><span class="err">中的操作是原子的，要改变这种方式，可以传入</span><span class="n">transaction</span><span class="o">=</span><span class="n">False</span>

<span class="n">pipe</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">pipeline</span><span class="p">(</span><span class="n">transaction</span><span class="o">=</span><span class="n">False</span><span class="p">)</span>
</pre></div>


<h3>实际实例</h3>
<p>什么应用，都用什么方式处理的</p>
<p>1.一般的缓存</p>
<p>用字符串类型足矣,
e.g.注册时得用户名冲突,在线用户</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SET</span> <span class="n">key</span> <span class="n">value</span>
<span class="o">&gt;</span><span class="n">GET</span>
</pre></div>


<p>2.计数,访问量统计，自增id等</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">INCR</span> <span class="n">key</span>
</pre></div>


<p>3.存储对象实例</p>
<div class="codehilite"><pre><span class="err">用散列</span>
<span class="o">&gt;</span><span class="n">HSET</span> <span class="n">key</span> <span class="n">field</span> <span class="n">value</span>
<span class="o">&gt;</span><span class="n">HGET</span> <span class="n">key</span> <span class="n">field</span>
</pre></div>


<p>4.存列表，队列相关</p>
<p>文章分类列表，评论列表等</p>
<div class="codehilite"><pre><span class="err">用列表</span>
<span class="o">&gt;</span><span class="n">LPUSH</span> <span class="n">key</span> <span class="n">value</span>
<span class="o">&gt;</span><span class="n">RPUSH</span> <span class="n">key</span> <span class="n">value</span>

<span class="o">&gt;</span><span class="n">LPOP</span> <span class="n">key</span>
<span class="o">&gt;</span><span class="n">RPOP</span> <span class="n">key</span>
</pre></div>


<p>5.集合相关的</p>
<p>标签云等</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">SADD</span> <span class="n">key</span> <span class="n">member</span>
<span class="o">&gt;</span><span class="n">SREM</span> <span class="n">key</span> <span class="n">member</span>
</pre></div>


<p>6.排序相关</p>
<p>访问量排序,点击量等</p>
<div class="codehilite"><pre><span class="err">用有序结合</span>
<span class="o">&gt;</span><span class="n">ZADD</span> <span class="n">key</span> <span class="n">score</span> <span class="n">member</span>
</pre></div>


<p>7.访问频率控制</p>
<p>设置key的失效时间
用 INCR
访问时检查次数, 若超过阈值, 走限制逻辑</p>
<p>or 记录次数, 超过阈值, 检查与最早一个相差是不是1分钟, 是, 走限制逻辑, 不是, 现有时间加入列表, 同时删除最早元素</p>
<h3>管理</h3>
<p>重启后数据不丢失, 两种方式, 可单独使用或者结合使用</p>
<p>持久化：</p>
<p>RDB</p>
<div class="codehilite"><pre><span class="err">快照</span><span class="p">,</span><span class="err">符合一定条件时，将内存中的所有数据进行快照并存储到硬盘上</span>
<span class="err">快照的条件可以在配置文件中配置</span><span class="p">,</span> <span class="err">两个参数</span><span class="o">:</span> <span class="err">时间和改动的键的个数</span>
<span class="n">Redis</span><span class="err">默认采用的持久化方式</span>

<span class="err">过程</span>
<span class="mf">1.</span> <span class="n">Redis</span><span class="err">使用</span><span class="n">fork</span><span class="err">函数复制一份当前进程</span><span class="p">(</span><span class="err">父进程</span><span class="p">)</span><span class="err">的副本</span><span class="p">(</span><span class="err">子进程</span><span class="p">)</span> <span class="p">(</span><span class="err">存的是</span><span class="n">fork</span><span class="err">时刻的数据</span><span class="p">)</span>
   <span class="err">写时复制</span><span class="n">copy</span><span class="o">-</span><span class="n">on</span><span class="o">-</span><span class="n">write</span> <span class="err">开始时父子共享同一内存数据</span><span class="p">,</span> <span class="err">当父进程修改某片数据</span><span class="p">,</span> <span class="err">操作系统复制一份以保证子进程数据不受影响</span>
<span class="mf">2.</span> <span class="err">父进程继续接收命令</span><span class="p">,</span> <span class="err">子进程开始将内存中数据写入硬盘中临时文件</span>
<span class="mf">3.</span> <span class="err">写入结束后</span><span class="p">,</span> <span class="err">替换旧的</span><span class="n">RDB</span><span class="err">文件</span>

<span class="err">任意时刻</span><span class="n">rdb</span><span class="err">文件都是完整地</span><span class="p">,</span> <span class="err">可以用于备份</span>

<span class="err">可以手动发</span><span class="n">SAVE</span> <span class="o">/</span> <span class="n">BGSAVE</span> <span class="err">让</span><span class="n">redis</span><span class="err">执行快照</span><span class="p">(</span><span class="err">前者由主进程进行快照操作</span><span class="p">,</span><span class="err">阻塞其他请求</span><span class="p">,</span> <span class="err">后者</span><span class="n">fork</span><span class="err">子进程</span><span class="p">)</span>
</pre></div>


<p>AOF</p>
<div class="codehilite"><pre><span class="err">每次执行一条会修改</span><span class="n">Redis</span><span class="err">中数据的命令，</span><span class="n">Redis</span><span class="err">会将该命令写到硬盘中的</span><span class="n">AOF</span><span class="err">文件</span>
<span class="err">开启</span><span class="p">,</span> <span class="err">设置</span> <span class="n">appendonly</span> <span class="n">yes</span>
<span class="err">默认文件名</span> <span class="n">appendonly</span><span class="p">.</span><span class="n">aof</span> <span class="err">可以通过</span><span class="n">appendfilename</span><span class="err">设置</span>

<span class="err">纯文本文件</span><span class="p">,</span> <span class="err">每当达到一定条件时可以进行重写</span>
<span class="k">auto</span><span class="o">-</span><span class="n">aof</span><span class="o">-</span><span class="n">rewrite</span><span class="o">-</span><span class="n">percentage</span> <span class="mi">100</span> <span class="err">#超过上一次百分比</span>
<span class="k">auto</span><span class="o">-</span><span class="n">aof</span><span class="o">-</span><span class="n">rewrite</span><span class="o">-</span><span class="n">min</span><span class="o">-</span><span class="n">size</span> <span class="mi">64</span><span class="n">mb</span> <span class="err">#允许重写的最小</span><span class="n">aof</span><span class="err">文件大小</span>

<span class="err">默认</span><span class="mi">30</span><span class="n">s</span><span class="p">,</span> <span class="err">执行的命令同步到</span><span class="n">aof</span>
<span class="err">可以配置</span>
<span class="n">appendfsync</span> <span class="n">everysec</span> <span class="err">#</span> <span class="err">每秒一次</span>
</pre></div>


<p>Redis可以配置主从数据库</p>
<p>redis-server --port 6380 --slaveof 127.0.0.1 6379</p>
<p>复制原理: 从数据库启动, 向主库发SYNC, 主库后台开始保存快照(RDB), 并将保存期间的命令缓存起来. 快照完成后, 将快照文件和缓存的命令发送给从库,
从库收到后载入快照文件并执行命令. 不支持断点续传</p>
<p>读写分离: 主库禁用持久化, 从库启用. 从库崩溃, 重启自动更新. 主库崩溃, 从库提升为主库再修复</p>
<p>常用查看命令</p>
<p>telnet连接</p>
<div class="codehilite"><pre><span class="o">&gt;</span><span class="n">telnet</span> <span class="mf">127.0.0.1</span> <span class="mi">6379</span>
</pre></div>


<p>设定最大可用内存</p>
<p>如果服务器内存有限, 大量使用缓存且生存时间设置过长会导致Redis占满内存. or 为了防止占用内存过大而将生存时间设太短导致命中率过低</p>
<p>可以限制redis使用的最大内存, 按照一定规则淘汰不需要的键</p>
<div class="codehilite"><pre><span class="err">配置文件</span> 
<span class="n">maxmemory</span> <span class="err">限制最大可用内存大小</span><span class="p">(</span><span class="err">单位字节</span><span class="p">)</span>
<span class="n">maxmemory</span><span class="o">-</span><span class="n">policy</span> <span class="err">超过限制时的删除策略，一直删除直到小于指定内存</span>

<span class="k">volatile</span><span class="o">-</span><span class="n">lru</span>  <span class="err">使用</span><span class="n">LRU</span><span class="err">算法删除一个键，只对设置了生存时间的</span>
<span class="n">allkeys</span><span class="o">-</span><span class="n">lru</span>   <span class="err">使用</span><span class="n">LRU</span><span class="err">算法删除一个键</span>
<span class="k">volatile</span><span class="o">-</span><span class="n">random</span> <span class="err">随机，只对设置了生存时间的</span>
<span class="n">allkeys</span><span class="o">-</span><span class="n">random</span>
<span class="k">volatile</span><span class="o">-</span><span class="n">ttl</span>    <span class="err">删除生存时间最近的</span>
<span class="n">noeviction</span>      <span class="err">不删除键，返回错误</span>
</pre></div>


<p>耗时命令日志</p>
<div class="codehilite"><pre><span class="o">&gt;</span> <span class="n">SLOWLOG</span> <span class="n">GET</span>
</pre></div>


<h3>其他</h3>
<p>批量删除</p>
<div class="codehilite"><pre><span class="cp">#删除 /test/*开始的</span>
<span class="p">.</span><span class="o">/</span><span class="n">redis</span><span class="o">-</span><span class="n">cli</span> <span class="o">-</span><span class="n">a</span> <span class="n">password</span> <span class="o">-</span><span class="n">n</span> <span class="mi">0</span> <span class="n">keys</span> <span class="s">&quot;/test/*&quot;</span> <span class="o">|</span> <span class="n">xargs</span> <span class="p">.</span><span class="o">/</span><span class="n">redis</span><span class="o">-</span><span class="n">cli</span> <span class="o">-</span><span class="n">a</span> <span class="n">password</span> <span class="o">-</span><span class="n">n</span> <span class="mi">0</span> <span class="n">del</span>
</pre></div>


<p>精简键名和键值, 最直观的减少内存占用的方式</p>
<hr />
<p>The end! To be continue ....</p>
    </section>

    <section id="copyright">
        <div class="copyright">
            版权声明：自由转载-非商用-非衍生-保持署名 | <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank" >Creative Commons BY-NC-ND 3.0</a>
        </div>
    </section>


    <section id="neighbors">
        <div>
                        <a class="left" href="http://www.wklken.me/posts/2013/10/15/blog-todo-list.html">
                            上一篇:  博客程序TODO列表
                        </a>
                        <a class="right" href="http://www.wklken.me/posts/2013/11/17/the-art-of-procrastination.html">
                            下一篇: 读书笔记-拖拉一点也无妨
                        </a>
        </div>
    </section>

    <section id="comments">

        <div class="comments">
            <h2>Comments!</h2>
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_identifier = "posts/2013/10/19/redis-base.html";
                (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://wklken.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            </div>
    </section>

</article>
        </section><!--end #main-->

            <footer class="row">
                <div class="large-12 columns">
                    <p>
                            Copyright © 2014 wklken <br>
                            Hosted on <a href="https://www.digitalocean.com/?refcode=8ee73f2c47ce"> digitalocean </a>. Powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Social Icons by <a href="http://fortawesome.github.io/Font-Awesome/">Font-Awesome</a>.
                    </p>
                </div>
            </footer>

            </div>
        </div>

        <section id="extras" class="body">
        </section><!-- /#extras -->

    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-42275748-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>



</body>
<script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="http://apps.bdimg.com/libs/jquery-scrollUp/2.1.0/jquery.scrollUp.min.js"></script>
<script>
    $(function(){
        $.scrollUp();
    });
</script>




</html>